### 【第7回】プロンプトの組み立て術 〜最高の「脚本」を書くために〜

皆さん、こんにちは。「プロンプトエンジニアリング入門」第7回へようこそ。

前回は、RAGと要約というテクニックを使って、プロンプトのための最高の「食材」、つまり動的コンテンツを集める方法を学びました。

さて、最高のレシピである「静的コンテンツ」と、最高の食材である「動的コンテンツ」、この二つが私たちの手元に揃いました。いよいよ、これらを一つの皿に美しく盛り付け、至高の料理、つまり一本の完璧なプロンプトを完成させる時が来ました。

ただ材料を放り込むだけでは、最高の料理にはなりません。そこには、プロの料理人のような、緻密な「組み立て」の技術が必要です。今回は、AIの能力を120%引き出すための、プロンプトの組み立て術について、詳しく学んでいきましょう。

まずは、最終的な目標、つまり「理想的なプロンプト」がどのような構造をしているのか、その設計図を見てみましょう。適切に構築されたプロンプトは、単なる情報の羅列ではありません。モデルを正しく導き、最高のパフォーマンスを発揮させるための、計算され尽くした構造を持っているのです。

理想的なプロンプトは、大きく分けて4つのパートで構成されています。

* **パート1：導入部**
これは、料理でいう「今日のコースのテーマは、旬の食材を活かしたフレンチです」と宣言するようなものです。これからどのような種類のドキュメントが始まるのかをモデルに明確に伝え、思考の方向性を設定します。例えば「これは、ある顧客への書籍の推薦に関する分析レポートです」と始めることで、モデルは最初から「書籍推薦モード」に入り、関連する情報に集中することができます。

* **パート2：コンテキスト**
ここがメインディッシュです。前回までに集めた、静的コンテンツや動的コンテンツといった、問題解決に必要な具体的な情報を配置します。

* **パート3：リフォーカス**
長いコンテキストが続いた後、モデルの注意が散漫になっている可能性があります。そこで、プロンプトの最後に、改めて「本題の質問はこれでしたよね？」と注意を喚起してあげます。これがリフォーカスです。多くのプロンプトエンジニアは、重要な指示をプロンプトの最初と最後に配置する「サンドイッチ手法」を好んで使います。

* **パート4：移行**
そして最後が、モデルに行動を促す「移行」です。問題の説明はここまで、ここからはあなたの出番ですよ、とAIの背中を押してあげる合図です。「以上の情報に基づき、最適な解決策は…」のように、回答の冒頭部分を少しだけ書いてあげることで、モデルはスムーズに回答生成へと移行できるのです。

この4つのパートからなる設計図の中で、特にパート2の「コンテキスト」を配置する際には、絶対に知っておかなければならない、LLMの記憶のクセがあります。それが、**「無関心の谷（Valley of Meh）」**と呼ばれる現象です。

人間でも、長い話を聞いていると、最初と最後の部分はよく覚えていても、真ん中の内容は忘れてしまいがちですよね。実は、LLMも全く同じなのです。

LLMは、プロンプトの**冒頭**と**末尾**にある情報にはよく注意を払いますが、その**中間**に埋め込まれた情報は、うまく活用するのが苦手で、忘れがちになる傾向があります。この、プロンプトの中間部分に存在する、モデルの注意が届きにくい領域こそが、「無関心の谷」です。

この特性から導き出される、プロンプト設計の黄金律は非常にシンプルです。
**「最も重要な情報は、プロンプトの最初か、一番最後に置くこと」**
この原則を知っているだけで、あなたのプロンプトの品質は劇的に向上するでしょう。

さて、理想的な構造と注意点が分かったところで、次なる疑問は「どのようなドキュメント形式でプロンプトを作るべきか」です。

ここで、第1回で学んだ重要な心構え、**「赤ずきんの原則」**を思い出してみましょう。「LLMが知っている道、つまりトレーニングデータでよく見た形式で話しかけるのが一番」でしたね。

つまり、**LLMがその膨大なトレーニングデータの中で、何度も目にしてきたであろう、一般的なドキュメント形式を模倣する**のが、最も安全で効果的なのです。

ここでは、プロンプトエンジニアがよく使う、3つの代表的な「道」、つまりドキュメント形式をご紹介します。

**形式1：アドバイスの会話形式**
これは、私たちがChatGPTと対話する時のような、質問者と回答者のやり取りを模した形式です。これはチャットモデルに最適なのはもちろん、補完モデルでも非常にうまく機能します。人間にとっても自然で考えやすく、複数回のやり取りや、後ほど学ぶツール連携との相性も抜群です。

**形式2：分析レポート形式**
ビジネスレポートや学術論文のように、客観的な分析や構造的な出力が欲しい場合に強力な形式です。この形式を使う際は、**Markdown**で記述することを強くお勧めします。見出しで階層構造を明確にしたり、コードブロックを綺麗に表示したりできるため、モデルが内容を非常に理解しやすくなります。

**形式3：構造化ドキュメント形式**
これは、XMLやYAMLといった、プログラムが解釈しやすい厳密な形式でプロンプトを記述する方法です。モデルからの出力を、後工程でプログラムが自動的に処理する必要がある場合に最適です。出力の形式を厳密に制御できるため、信頼性が求められるアプリケーションで重宝されます。

それでは、それぞれの形式を使いこなすための、ちょっとしたコツを見ていきましょう。

まず **「会話形式」**では、「インセプション」というテクニックが有効です。これは、モデルに回答させる部分の「書き出し」を、こちらで先に書いてしまうテクニックです。例えば、「アシスタント：承知いたしました。あなたにおすすめの本は…」とプロンプトを終えることで、モデルは自分がそのアシスタントであると認識し、自然にその続きを生成してくれます。

次に **「レポート形式」**でMarkdownを使う場合、特に強力なのが **「目次」**の活用です。プロンプトの冒頭に、これから記述する内容の目次を書いておくことで、モデルはレポートの全体構造を把握しやすくなります。さらに、この目次を使えば、モデルの思考プロセスをコントロールすることも可能です。例えば、結論の前に「# 分析」や「# アイデア」といったセクションを目次に含めておけば、モデルは結論を出す前に、まず分析やアイデア出しを行うようになり、より深く考え抜かれた回答を生成するようになります。これは思考の連鎖、CoTプロンプティングの一種とも言えますね。

最後に **「構造化ドキュメント形式」**です。例えばXMLを使う場合、`<character name="リチャード">` のように、タグを使って情報の役割を明確に定義します。これにより、モデルは各情報が何を意味するのかを正確に理解し、出力も同じ構造に従って生成するため、プログラムでの解析が非常に容易になるのです。

**ナレーター：** それでは、今回のまとめです。今回は、最高のプロンプトを組み立てるための「設計図」と、代表的な3つの「ドキュメント形式」について学びました。

理想的なプロンプトの構造は、**「導入部」「コンテキスト」「リフォーカス」「移行」**という4つのステップで構成されています。そして、コンテキストを配置する際は、LLMの記憶のクセである**「無関心の谷」**を避け、最も重要な情報はプロンプトの最初か最後に置くことが重要です。

また、プロンプトのドキュメント形式は、**「赤ずきんの原則」**に従い、LLMがよく知る一般的な形式を選ぶのが賢明です。目的に応じて、柔軟な対話が可能な**「会話形式」**、構造的な分析が得意な**「レポート形式」**、そしてプログラムとの連携に強い**「構造化ドキュメント形式」**を使い分けましょう。

これで、最高の材料を集め、それを完璧な設計図に基づいて組み立てる方法を学びました。私たちの手には、今、モデルの能力を最大限に引き出すための、強力なプロンプトが握られています。

しかし、私たちの仕事はまだ終わりではありません。プロンプトを投げた後、モデルからの「回答」をいかにして制御し、私たちが本当に望む結果だけを的確に手に入れるか。そこにもまた、プロンプトエンジニアの技術が求められます。

次回は、**「モデルの出力を制御する 〜望み通りの結果を得るコツ〜」**と題して、モデルの補完をコントロールし、その思考をさらに深く読み解くテクニックについて掘り下げていきます。