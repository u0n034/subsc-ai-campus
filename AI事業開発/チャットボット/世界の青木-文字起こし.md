***

### **講座の概要 (0:00 - 0:17)**
この講座は非エンジニア向けの講座になっております。基礎・ローコードでほとんどプログラミングを書かずに、複数の生成AIを組み合わせたり、社内文章を含めた返答ができる生成AIのチャットボットを作れるというのがDifyになるんですけども、このAIを使う方法を基礎からしっかり学習できる講座になっております。

***

### **講座の構成 (0:17 - 0:53)**
講座の構成として、実際の基本的な使い方、共通の項目などを解説した後に、実際ではチャットフローという機能がありまして、ブロックを線でつなげて処理を作るという方法がありますので、そちらの使い方を解説しつつ、さらに外部知識の登録方法や必要な前処理なども解説しまして、最後にこの外部知識の情報とチャットフローを組み合わせた簡単なチャットボットを作ってみるという内容になっております。こちらが実際のDifyの画面になるんですけども、開始ブロック、質問分類器、知識取得ブロックなど、いくつかあるブロックを線でつなげて自由に処理を作っていくということで、特にこの知識取得に関しては、これまでプログラミングの知識が必須だったんですけども、Difyの機能を使うとかなり簡単に登録ができるようになっておりますので、社内情報を読み込ませたチャットボットを簡単に作れるようになりましたので、その方法をできるだけ分かりやすく解説しております。

***

### **講座で用いる図解イメージ (0:53 - 1:16)**
講座内ではできるだけ分かりやすくしたいということで、イメージ図をたくさん盛り込んでおりまして、変数であったり、ブロックのイメージであったり、またラグのイメージや資料の登録のイメージなど、できるだけ分かりやすく食い込みで解説をしております。こちらは外部文章を活用した事例なんですけども、ラグありの方は資料に基づいて回答して、情報元も記載してあると。ラグがない場合、外部文章を使わない場合は無難な回答で情報元不明ということで、資料を活用するかどうかで回答が変わってくるというのも実際にお試ししていきます。

***

### **Difyの特長と複数のAIの組み合わせ (1:16 - 1:39)**
また、複数の生成AIを組み合わせることができる仕組みになっていて、GPTだけではなくて、アンソロピックのクラウドだったり、GoogleのGeminiなど、たくさんの生成AIを組み合わせて構築することもできます。これからますます生成AIが発展していくとともに、複数の生成AIを組み合わせてアプリを作るというスキルも必要になってくると言われていますし、生成AIを複数組み合わせるであったり、ブロックを組み合わせてプログラミングなしでチャットボットを作るというのがこれからますます需要が増えてくると予想されますので、この機会にぜひ実際に取り組んでみてください。

***

### **Difyの概要 (2:48 - 4:01)**
実際の概要を解説します。DifyはアメリカのLangGeniusという会社が提供しているオープンソースの開発サービスになります。オープンソースというのは下の方に書いてあるんですけども、プログラムコードをインターネット上でタダで公開していて、誰でも改良していいよとしているソフトウェア、開発方式のことをオープンソースと呼んでおります。で、次の特徴なんですけども、ノーコード、ローコードで生成AIアプリを作ることができます。複雑なプログラミングの知識はなくても、生成AIアプリを作ることができます。と続いて、複数のLLMを組み合わせて扱うことができます。LLMというのは大規模言語モデルの略なんですけども、有名なところはチャットGPTだったり、他にもGoogleのGeminiやアンソロピックのクロードなど複数の生成AIアプリが増えているんですけども、これらを組み合わせて扱うことができます。最近では、一つのAIではなくて、複数のAIを組み合わせて扱うということで、複合AIシステム、英語でcomposite AI systemという言葉も生まれてきていて、Difyはその一つになります。またAIだけではなくて、既存のシステムやツールと連携することもできますし、外部文書の読み込みを実現することもできます。外部サービスとの連携はAPIを利用するのが大きな特徴になっています。実際のイメージ、簡単なものを作っているんですけども、真ん中に置いているのが実際のDifyのアイコンですね。このDifyからLLVM、チャットGPTなどの生成AIと連携することもできるし、外部ツール、Slack、ウィキペディア、YouTubeなどたくさんの外部ツールありますけども、それらと連携することもできるし、外部知識を読み込ませてチャットGPTが知らない情報なども回答してもらうということもできるような仕組みになっています。一つの生成AIに依存するんではなくて、それらを組み合わせて必要なものを扱っていくということができます。外部サービスとの連携はAPIを使用するということで、こちらは追ってご紹介いたします。

***

### **Difyの年表 (4:02 - 4:39)**
続いて、実際の簡単な年表になります。上からご紹介しますと、2022年の11月にチャットGPT3.5がリリースされて、世界中で大ヒットになりました。それから数か月経って、2023年3月にDifyの開発開始になっています。一つの生成AIに依存するのではなく、これから複数の生成AIが出てくるだろうということで、それらを組み合わせる方針で開発が始まったとされております。で、同じく複数の生成AIを組み合わせるということで、LlamaIndexだったりLangChainというソフトがあるんですけども、開発当初はこれらとあまり明確な差別化がなかったんですけども、2024年の1月にLangChainとの決別+独自の道を進むことになり、4月にワークフローが発表されて、ノーコードローコードでプログラミングの知識がなくてもアプリを作れるようにするという方針で開発が進んでおります。直近ですと、収録時点の最新版としてはバージョン0.7.0ということで、こちらでご紹介していきます。

***

### **Dify関連リンク (4:39 - 5:10)**
また、実際の関連リンクということで、公式のホームページ、公式のブログ、またソースコードを一般公開しているということで、GitHubというサービスの中でプログラミングコードも自由に読むことができるようになっております。公式のホームページをクリックしますと、こういったページになっていまして、下の方に下がっていくと様々な情報が書いてありますし、一つのプラットフォームで複数のLLVMに接続できるよということ書かれておりますし、価格表だったり、マニュアルだったり、ブログなどもリンクがありますので、また追ってご紹介いたします。また、GitHubもリンクがあって、こちらをクリックすると実際のソースコードですね。こちら一般公開されていて、誰でも見ることができるということになっております。

***

### **Difyの利用環境 (5:10 - 5:33)**
それと、実際の利用環境ということで大きく2種類用意されています。クラウド環境とローカル環境。クラウド環境というのは、インターネットにつながっていればすぐに使える方法で、無料版、有料版あります。今回はこちらのクラウド環境の方でご紹介いたします。また、ローカル環境ということで、自分のパソコンにプログラムコードをダウンロードして動かすという方法もあります。こちらはDockerやGitなどの専門知識がいろいろと必要になりますので、また別の機会にご紹介したいと思っているんですけども、今回はクラウド環境、インターネットにつながっていれば使えるという方法で解説をしていきます。

***

### **Dify Web版の価格体系 (5:40 - 6:08)**
こちらもプランの変更は制限がありますが、いつでもできますとされております。今回扱う内容としてはフリープランで十分なんですけども、特にこのベクトルデータベースですね、社内情報などをアップロードしたいという場合、この5メガというのが少し物足りなくなってくる可能性もありますので、もっと容量が欲しいなとなればプロプランなどにアップデートをご検討いただければというところでございます。このDifyに関しては無料で扱うことができるんですけれども、Difyのサービスの特徴上、Difyから外部の生成AIなどに外部サービスとの連携はAPIを利用して通信する必要があります。

***

### **API料金の概要 (6:08 - 6:26)**
この通信する際にAPIという機能を使うんですけども、こちらがタダで使うことは少し難しくて、多少なりお金がかかってきます。こちらは次の動画で細かくご紹介しますけども、今回扱うのはGPT-4o miniという生成AIモデルで扱っていきます。こちらはかなりやり取りしても合計50円とかかなり安い料金で扱うことができますので、0円ではないんですけども、数百円などやり取りすることができると考えますので、多少の出費はかかってしまうということは念頭に置いておいていただければと思います。

***

### **Difyへのログイン方法 (6:26 - 7:21)**
ということで、実際にまずはDifyの登録からですね。GoogleかGitHubのアカウントで登録することができます。公式ホームページをクリックいただきますと、公式ホームページが表示されまして、CookieはAcceptをしておきましょうかね。画面の右上に始めるというボタンがあるのと、画面の真ん中あたりにも始めるという場所がありますので、まずはどちらかをクリックいただきます。そうすると続行するにはログインしてくださいということで、GitHubかGoogleのアカウントでログインすることができます。今回はGoogleのアカウントで進めることにします。クリックしますとGoogleでログインということでメールアドレスが必要になりますので、Gmailのメールアドレスを入力してください。入力したら、入力してパスワードも必要になると思いますけども、パスワードも入力してLangGeniusにログインと表示されていますので、こちらで次へを押すと、これで実際にログインすることができます。画面の右上を見ていただくとアップグレードという表示になっていまして、これが表示されているということは、現在はフリープラン、ただで使えるということになります。

***

### **OpenAI APIの登録方法 (7:17 - 7:26)**
これで実際のログインはできたということになりますので、続いてOpenAIのAPIの登録方法をご紹介していきます。

***

### **Dify v1.0の追加機能 (7:27 - 8:36)**
追加動画です。実際バージョン1.0ということでタイトルを追加しております。2025年2月末にDifyのバージョンが1にアップデートされました。これまでは0.いくつ、0.7、0.8というバージョンだったんですけども、バージョン1に変わったタイミングで、マーケットプレイスやプラグインという新しい仕組みが導入されました。こちらによって、必要な機能を自由に追加できるようになるというのが特徴になっています。これまでのバージョン0.いくつとバージョン1以降ですね。簡単なイメージ図を下に書いておきます。バージョン0の頃は、実際の本体に生成AIの言語モデルであったり、ツールというのも全てセットで一つのパッケージとして組み込まれていたというようなイメージで考えていただければと思うんですけど、バージョン1になりまして、マーケットプレイスという電子市場の場所が用意されて、その中にプラグインとして拡張ソフトですね。自由にダウンロードできるソフトとして用意されたと。その中に生成AIのモデルやツールも選べるようになったということで、これまでは言語モデルやツールが全て一つのパッケージになっていたと、全てまとまっていたのを分離させたというようなイメージになります。分離させたことで、もし実際Difyにバグや機能追加などがあればDify単体でアップデートできますし、モデルやツールはそれぞれ個別でアップデートがされるということで、分離してより使いやすくなったということになります。また、このマーケットプレイス、プラグインの特徴として、第三者、Difyではない他の人が作成したプラグインもアップロードしてダウンロードして使えるようにもなっていて、これも少しずつ増えてくるかなと予想されております。この第三者が作ったプラグインというのはしっかり審査もされるようです。ということで、バージョン1以降ですね。言語モデルやツールを追加する必要が出てくるということです。

***

### **マーケットプレイスとプラグインの解説 (8:36 - 9:50)**
こちらがマーケットプレイスの実際の画面なんですけども、実際にログインした状態にプラグインというアイコンというかボタンが追加されています。こちらがマーケットプレイスの実際のページなんですけども、全て、モデル、道具というのはツールですね。他にエージェント戦略、拡張機能、バンドルと選択肢があるんですけども、他エージェント戦略、拡張機能バンドルと選択肢があるんですけども、その中で言語モデルであったり、ツールをインストールしてから使うというような流れになっています。実際の画面でも確認します。こちらが新規登録した状態ですね。Difyのバージョンが1になっている状態で、まだ何も設定していない状態の画面になります。で、マーケットプレイス、プラグインなんですけども、画面の右上のプラグインですね。こちらのボタンをクリックしていただきますと、プラグインであったりマーケットプレイスを探索するということで選択肢が出てきています。OpenAIに関しては初めから設定されていたんですけども、もしこのOpenAIがない場合はマーケットプレイスから追加する必要があるということですね。マーケットプレイスを探索しますと、様々なツールや言語モデルが表示されます。例えばモデルの方をクリックしますとOpenAIですね。この講座としてはOpenAI、チャットGPTを使っていきますので、こちらをインストールする必要がありまして、こちらをインストールしておいてください。また、他にも言語モデル様々ありますので、必要に応じて追加インストールしてから使うということですね。また、それと道具の方、ツールですけども、この講座としてはDALL-Eさんと扱っていたと思いますので、DALL-E 3もインストールしておく必要があります。実際に手元で試したいという場合は、この第3のプラグイン、ツールもインストールしておいていただければと思います。他にもGoogleであったり、Power BIだったり、一度リサーチ等々ありますので、必要に応じて追加してから使えるようになるということですね。

***

### **ツールとモデルプロバイダーの設定確認 (9:50 - 10:11)**
今追加しましたので、画面上の、例えばツールの方を見ますと、DALL-Eさんが含まれているというのが確認できますし、あとモデルですね。モデルに関しては、動画でも解説しますけども、画面右上のアイコンの設定ですね。設定のモデルプロバイダーという箇所で言語モデルの設定をする必要がありますので、もしこちらで表示されていない場合は、先ほどのマーケットプレイスでモデルをインストールする必要があるということを知っておいていただければと思います。というところで、マーケットプレイスとプラグインの解説を終わります。引き続き動画の視聴をお願いいたします。

***

### **OpenAI APIキーの取得方法 (10:19 - 10:40)**
前回の動画でDifyにログインできましたので、続いてOpenAIのAPIキーを取得する方法をご紹介いたします。APIというのはアプリケーションプログラミングインターフェースの略なんですけども、外部からサービスを扱える方法になっております。この外部というのは、今回でいくとDifyからOpenAIに接続しますので、Difyが外部ですね。外部からOpenAIに接続して生成AIを扱うということで、APIの機能を使って利用していきます。

***

### **API利用の前提条件 (10:40 - 11:04)**
APIによって認証不要なものと、認証必要なものがあるんですけども、今回扱うOpenAIに関しては認証が必要になります。ユーザー登録なりログインをしまして、必要があればクレジットカード登録。今回のOpenAIの場合はカード登録が必要になります。カード登録しまして、APIのキーを発行して、これをDify側に設定することで扱うことができる、通信できるようになります。今回は社内文書を読み込ませるということもあって、この社内文書を読み込ませるためにOpenAIのAPIを使う必要がありますので、このOpenAIのAPIでまとめてご紹介していきます。

***

### **API料金とトークンの概念 (11:04 - 12:23)**
で、肝心の料金なんですけども、扱うモデルによってかなり料金が異なりまして、今回扱っていくGPT-4o miniというモデルの場合は合計料金51円という日で計算しております。こちら条件として1ドル150円、1日5回利用、30日、1回あたりの入力と出力が3000ということもちろん使う回数によってこの金額は変わってくるんですけども、言語モデルの中でもかなり安い方になるかなというところでございます。もちろんこのモデルもどんどん更新されていって、もっと安いモデルが出てくる可能性もありますので、その時のコスパがいいモデルを選択していただければというところでございます。このトークンというのが少し分かりづらいので、先にご紹介しておきますと、日本語、英語など言語により情報量が変わるため、文字数ではなく、トークン（token）で判断していると、トークンという単位で計算されております。トークン、テキストを構成する最小単位、こちらにはトークンを確認する方法がありますので、OpenAIが公開しているページなんですけども、こちらを見ますとトークナイザーということで、いくつトークン使ってるんだというのを確認することができます。例えばおはようございますですね。こちらの文章をコピーして、先ほどのページに設定してみますと、おはようございますはトークン数が6ということですので、6で計算されるというこちらGPT-3.5やカミングスーンとなっているので、またこの計算結果が異なる可能性もありますけども、この収録時点ではおはようございますはトークン数6ということで確認することはできます。英語より日本語の方が漢字などもあるので、トークン数は増えがちですね。

***

### **API料金の補足 (12:23 - 12:29)**
というのも踏まえて、この表を改めて見ますと、30日あたりが3000なので、ざっくり1000文字から1500文字ぐらいですかね。を入力して、出力で返ってくる情報もそれぐらいだとしても50円ほどで安く扱うことができるのではなかろうかというところでございます。

***

### **OpenAI APIキーの発行手順 (12:29 - 14:34)**
というのを踏まえて、改めてOpenAIのAPIキーの発行の方法になります。まずはこちらにURL貼っておりますので、このURLでブラウザ入力いただきますと、OpenAPIというページが表示されます。画面の真ん中あたりにサインアップというボタンがありますので、こちらをクリックいただくとOpenAIのアカウントですね。メールアドレスなどで登録するか、Gmailでもログインできますので、今回はGmailで進めることにします。Gmailをクリックしまして、アカウントが表示されていたり、他のメールアドレスやパスワードなどですね。を設定いただきまして、OpenAIにログインしますと。そうしますとOpenAIのAPIの設定画面などが表示されます。いくつか設定が必要なんですけども、画面の右上の歯車のマークがセッティング、設定ですね。こちらで左側に行きますと、ビリングというのが支払い関係の情報になります。こちらで、あとペイメントディティールですかね。これは個人か会社かということで選択肢があるんですけども、今回は個人ということでインディビジュアルの方を選択していきます。そうするとカード情報を設定する必要がありますので、カード番号だったり、カードの名前とかですね、この辺を登録いただければと思います。僕の方ではすでに別のアカウントで登録しておりますので、登録済みの画面になるんですけども、登録が済みますとこういう画面になりまして、オートリチャージis offとなっていて、自動的に入金するかしないかということですね。こちらも設定で変更することができます。また、こちらにも書いてあるんですけども、クレジット額が0円の場合はAPIが止まりますということで、事前に入金しておく必要があります。画面の真ん中あたりにAdd to Credit Balanceというボタンがありまして、こちらをクリックすると入金することができますので、一番安いのが5ドルカラーとなっておりますので、まずは5ドル設定いただいて、カードを選んでコンティニューとして入金をするようにお願いいたします。その後は必要に応じて、0円になる前に適宜追加していくということですね。また、ペイメントメソッドとありますけども、こちらをクリックすると登録されているカードの情報などもありますので、こちらでカードの情報も変更いただくといったところですかね。カードが登録できましたら、画面左上のダッシュボードのリンクをクリックいただくと設定画面が出てくるんですけども、ダッシュボードからさらに画面の左側のAPI Keysというリンクがありますので、こちらをクリックしてください。そうすると、ここでAPIのキーを発行することができます。画面の右上にクリエイトシークレットキーとありますので、こちらをクリックしますと名前ですね。今回はMOD Difyテストなど自由に作成いただければと思うんですけども、Difyテストとしておきますかね。これでクリエイトシークレットキーとしますと、OpenAIの鍵が発行されます。で、この鍵なんですけども、一度ダンを押してこの表示を消しますと、もう見ることができないので、必ずコピーして必要な場所に記録しておくことをお勧めいたします。コピーしてメモ帳なり必要な場所に保存していただければと思います。

***

### **DifyでのAPIキー設定 (14:34 - 15:31)**
これでAPIのキーは発行できましたので、続いてDify側に設定する必要があります。Difyのページに移動しまして、こちらは既に使っているアカウントなんですけども、画面の右上のアイコンをクリックして設定という箇所がありますので、この設定をクリックします。設定をクリックしましたら、上の方にモデルプロバイダーというメニューがありますので、こちらをクリックしてください。こちらで生成AIのモデルなど様々選ぶことができるんですけども、今回はOpenAIですね。こちらにAPIキーのセットアップという箇所があるので、こちらをクリックいただいて、APIキーを先ほど取得したものを設定してください。これでOpenAIと連携することができるようになります。さらにもう少し手間があるんですけども、画面の右上にシステムモデル設定というボタンがありまして、こちらでどのモデルを基本として使うかというのを設定することができますので、こちらをクリックしてあげてください。システム推論モデルとあって、この収録時点ではGPT-4ominiが一番コスパがいいと思っているんですけども、クリックしまして、先ほどのキーが認証されていたら複数モデルを選ぶことができますので、GPT-4ominiですね、このあたりのモデルを選んで保存としておいてください。これでDifyとOpenAIのAPIのキーの設定ができて、連携するということですので、引き続きAIの操作方法などを解説していきます。

***

### **Difyの初期設定と画面構成 (15:37 - 17:24)**
DifyにログインしてOpenAIのAPIキーを発行して設定している状態から進めていきます。こちらにはすでにDifyにログインした状態で、僕の場合はプロプランで登録しているチャンネルなんですけども、もちろんフリープランでも問題ないような解説にしていきます。まずはじめにいくつか設定項目についてご紹介いたします。画面右上のアイコンの箇所をクリックしますと設定項目が出てきますけども、他にもサポート、フィードバック、コミュニティ等々ありますが、今回はこの設定の方を確認していきます。設定を確認しまして、上から順番にご紹介しますと、モデルプロバイダーというのが生成AIをはじめとする外部サービスとの連携ですね。それぞれもし接続したい場合はクリックして、GoogleのGeminiが使いたいということであればこちらからセットアップをしてAPIキーを設定していくという流れになっています。Anthropicが使いたいのであれば、こちらからセットアップをしてAPIのキーを設定していくという流れになっています。外部のサービスごとにAPIキーが別途必要になりますので、必要に応じて登録して使っていただければというところですね。続いてメンバーというのは、こちらのアカウントにログインしてチャットボットなりサービスを作れるメンバーになります。フリープランの場合はここは1人ですね。続いて請求がプランの内容だったり、メンバーアプリの数、ベクトル、データベースのスペースなどですね。設定情報です。また、請求の情報などもこちらから確認することができます。続いてデータソースというのは外部知識ですね。これは後ほどご紹介しますけども、チャットGPTが知らない情報などを読み込ませようとした際にこの辺りを見ることもありますと。API拡張なんですけども、こちらは開発向けの機能になるので今回は割愛します。続いてカスタマイズですね。チャットボットを表示した際に、このDifyというロゴマークが表示されるようになって、もしこれを削除したい場合はプロプラン以上に上げる必要があるんですけども、プロプラン以上であればこのアイコンをカスタマイズすることもできます。続いてアカウントのマイアカウントというのがユーザー名だったりメールアドレスの項目になります。投稿という箇所はログインですね。GoogleかGitHubでログインしていれば、こちらで接続しているというのが分かります。あと最後言語なんですけども、基本的には日本語の設定になっていると思いますけども、もしこちらが英語などで表示されていた場合は、この設定画面から日本語に変更するようにしてください。それとタイムゾーンというのは時間なんですけども、アメリカと日本では当然時差がありますので、もし日本のタイムゾーンに合わせるという場合であれば、プラス9時間の場所に東京という項目がありますので、下の方に下がっていただくと、ここですね。プラス9時間でJAPANタイムというものがありますので、こちらに設定しておいていただければと思います。ということで、引き続きDifyの解説をしていきます。

***

### **AIアプリの作成方法 (17:29 - 19:17)**
設定項目の確認ができたところで、改めてDifyを使った生成AIアプリの作り方をご紹介していきます。こちらが実際にログインした画面なんですけども、画面の上の方にいくつかメニューがあります。この真ん中あたりのスタジオというのが生成AIアプリを作る場所になります。画面上の選択項目がスタジオになっている状態で、画面の左側を見ていただくとアプリを作成するという箇所があって、その中に最初から作成、テンプレートから作成、DSLファイルインポートということで3種類の項目があります。基本的には最初から作成していくことが多いと思うんですけど、続いてさらにいくつか選択項目がありますので、追ってご紹介します。先にテンプレートの方をご紹介しますと、テンプレートというのはDify側が用意しているお手本のようなもので、こちらのテンプレートから作成をクリックしますと、左側と右側とが用意しているテンプレートですね。例えばブックトランスレーション、なんとなく日本語の翻訳だったり、長文を作成するであったり、Eメールのアシスタントなどですね。さまざまなあらかじめ用意されているものがあって、画像の生成などもありますので、画像のテンプレートを元に変えたり、アイコンを変えたりすることもできるので、テンプレートからスタートするということもできます。ただ、このテンプレートはすべて英語になっていますので、そこは少し注意が必要なところですね。次に、DSLファイルというのは、このファイルで作ったワークフロー、後ほどご紹介しますけども、作ったワークフローなどをファイルとして外に吐き出すことができる、保存することができるようになっていて、それを受け取ったものをインポートして使うということもできたりします。今回はこのDSLファイルは特に扱わないので、ここまでの解説とします。改めてこのアプリ作成の最初から作成ですね。最初から作成の方の項目を押しますと、どのタイプのアプリを作成しますかということで、チャットボット、テキストジェネレーター、エージェント、ワークフローということで4つの方法で作成することができます。チャットボット、テキストジェネレーター、エージェント、ワークフローですね。また、チャットボットの中にさらに基本とチャットフローという二つの種類があります。基本の方が初心者向け、あとでチャットフローに切り替えることができます。チャットフローの方は上級ユーザー向けということで、まずは基本の方で作っていくことにします。名前やアイコンは自由に付けていただければと思うんですけど、今回はチャットボットアンダーバーの基本というまんまですね。そのままの名前で、アイコンもロボットのアイコンでもいいですし、自由にアイコンを選んでいただければと思います。この辺は適当に選んでおりますが、アプリのアイコンと名前をつけて、説明の箇所はなくてもOKですね。画面右下の作成するボタンを押しますと、チャットボットの基本の方ですね。この方にこういう画面が表示されますので、引き続きこの設定項目についてご紹介していきます。

***

### **チャットボット基本設定画面の解説 (19:23 - 20:37)**
前回の動画で、スタジオの最初から作成からチャットボットの基本のチャットボットの作成画面が開きますので、こちらの内容を確認していきます。画面がいくつか分かれているんですけど、左側のオーケストレーション、一部で自動化というような意味になっておりまして、この中でチャットボットの設定をすることができます。いくつも設定があるんですけども、先に右側のこのモデルの方からご紹介いたします。実際はGPTに限らず、様々な生成AIモデル接続することができるということで、こちらのモデルの箇所をクリックするとモデルを選択することができます。現在はOpenAIのAPIを登録しているだけなんですけども、例えばGoogleのGeminiだったり、Azure OpenAI、それらの設定項目がこちらにも表示されるようになります。今回はGPT-4o miniですね。こちらのモデルを選んであげます。続いてパラメータということで、どういう出力にするかというパラメータについてもう少し後でご紹介したいんですけども、このプリセットという箇所を押しますと、クリエイティブ、バランスということで、このパラメータを調整することもできます。こちらも後でご紹介しますが、ここで調整することができると。続いて右側、デバッグとプレビューというメニューがありまして、こちらに何か文章を入力すると選んでいるモデルですね。今回はGPT-4o miniのAPIを叩いて、その返答が返ってくるという内容になっております。まずは適当に入力してみることにします。社内向けのチャットボットのアイデアを教えてとかですね。簡単な文章を入力するとして、これで送信ボタンを押しましたら、こちらは返答がとてもスピードが速いというのと、GPT-3にですね、特徴似てますけども、ざっとこう返事が返ってきます。FAQボット、タスク管理ボット、ザッと出てきます。で、返ってきましたら、返答の時間だったりトークン消費というところでいくつトークン使ったんだということも表示されるようになっております。

***

### **公開機能とURL共有 (20:37 - 21:46)**
また、画面の右上に公開するというボタンがあるんですけども、こちらを押しますと更新と更新というボタンがあって、こちらを押しますと設定内容を反映するとアップデートすることができます。また、アプリを実行の箇所をクリックすると自動的にURLが生成されまして、このURLを社内の別の人に教えたりですね、教えてその人が使うということもできます。これが実際に他のユーザーからも見えるということで、例えば別のブラウザを表示したりしまして、このURLを叩けばそのまま他のユーザーが操作するように確認することもできます。スタートチャットで先ほどと同じような内容ですね。社内向けのチャットボットのアイデアを教えてあげますと、先ほどと回答変わる可能性はもちろんあるんですけども、ざっとこう返事が返ってきまして、こちらの場合は返答の時間だったりトークン数などは表示されないので、少し出力が変わってくるというのをは知っておきたいところでございます。ということで、簡単に公開することができますし、他のユーザーに社内向けにこのURLを共有すれば、他の人も簡単に扱うことができます。また、画面右側の公開するからサイトに埋め込むという箇所もありますので、WordPressなどのホームページに埋め込むためのコードが表示することができます。これは実際にホームページを触れる方であれば、このスクリプトタグなどをホームページに貼り付ければ、このチャットボットをホームページ上で表示することも知っておいてください。引き続き、設定側のについて解説をしていきます。

***

### **チャットボット基本機能の紹介 (0:00 - 0:10)**
引き続きチャットボット基本の機能の内容をご紹介いたします。続いては手順の箇所になるんですけども、手順に関しては少し生成AIの歴史がありますので、そちらを先にご紹介いたします。

***

### **プロンプトの基本と歴史 (0:10 - 1:00)**
チャットGPTやGoogleのGeminiなどの生成AIは文章で情報や指示を渡す必要があります。この生成AIに指示を渡すことをプロンプトと呼びまして、プロンプトを作って情報を渡す必要がありますと。で、以前は毎回文章を1から作って送信していたんですけども、どうしてもこの精度を高めようとすると文章の内容が増えがちになります。20行とか30行とか、どうしても文章が増えがちだし、それを毎回書いてるとそれもなかなか大変だよねという意見がありまして、2023年の7月ですね。こちらチャットGPTなんですけども機能が追加されてカスタムインストラクションという機能が追加されました。毎回プロンプトを全部作っておくのではなくて、ある程度事前に設定しておいてですね、例えば文章は300文字とかリスト形式や表形式で出力してほしいということで、事前に設定を伝えておいた上で生成AIに他で聞きたいことがあれば聞いていくと、事前に設定したものはあらかじめ反映しておいてということで、このプロンプトにも種類が分かれるようになったんですね。今回のDifyの手順と書かれている箇所も機能的にはチャットGPTに後から追加になったこのカスタムインストラクションという機能と同じものになります。

***

### **Difyの「手順」機能の概要 (1:00 - 1:32)**
ということで事前に設定する内容ということですね。事前情報や出力方法を調整できる機能になります。またユーザーには表示されない、実際にチャットボットを扱ってるユーザーには表示されないで、裏側であらかじめ設定している内容ということになります。これを細かく作り込むほどに思ったような返答が返ってきやすくなるということになります。またこの手順なんですけども、追加でプロンプト生成器というものもありまして、これはこの指示文ですね、プロンプトを手助けしてくれるということでとても便利な機能ではあるんですけども、自動で変数や他の機能も変更されてしまうので少し使うのには慣れが必要になってきます。今回の講座としては変数や他の機能のことも話してから改めてこのプロンプト生成のところも試していこうかなと思っております。ということで、まずはこの手順の方ですね、簡単な内容を書いてみることにします。

***

### **「手順」のサンプルと関連講座の案内 (1:32 - 1:53)**
手順のサンプルということで分かりやすいのが箇条書きだったり表形式で書くように指示しておくと、それに沿って書いてくれるので簡単に動きを試すことができるかなと思っております。またこのプロンプト生成AIの指示文に関しては関連講座ということで、Udemyとしては4つですね、すでにリリースしておりますので、もっと深掘りしたいという方はこちらの講座もぜひご活用いただければ幸いでございます。というのも踏まえて簡単な内容ですね。表形式で出力してというところを少し試して動作確認してみることにします。

***

### **Difyでの「手順」設定の実演 (1:53 - 2:40)**
Difyのチャットボット基本の手順の箇所で表形式で出力してと書いておくことにします。これが事前の設定ですね。で、画面右上の公開するから更新をしてあげると、この今設定した内容が反映されてるはずですので、改めて何か適当にチャットを書いてみることにします。夏休みに子供と遊ぶアイデアをくださいとか適当に内容を書いてますけども、これで実行とすると、事前に表形式で出力してというのもすでに伝えているということになりますので、これで実行すると表形式で出してくれるということになります。ま、こちらで事前に書いておくか、チャットのやり取りする中で書くか、どっちで書くかって話なんですけども、実際に使うユーザーとしてはですね、なるべくこの内容は少なくしたいはずなので、事前に設定しておくというのもとても便利な機能ではありますと。またこの右上の星マークの箇所、自動というリンクがありまして、こちらをクリックすると、ま、自動で、この、ま、いくつか例題もあるんですけど、プロンプトを作ってくれるという機能もあります。ただこれは先ほどお伝えした通り、変数だったり他の機能も書き換えてしまうので、また追ってご紹介したいということで、まずはこの状態で次の機能、変数について解説をしていきます。

***

### **「変数」機能の概要と比較 (2:40 - 3:21)**
続いて変数について解説をします。変数は先に少し注意がありまして、とても便利な機能ではあるんですけれど、後ほどご紹介するチャットフローでつくるパターンですね。こちらと比べると入力情報によって処理を分けづらいので若干使いづらいかなと思ってはおります。というのはこのチャットフローのイメージ図がこちらなんですけども、何か情報が入ってきてこの変数によって処理を分けるというのが、チャットフロー、ワークフローだったら簡単にできるんですけど、基本の方でやろうとするとこれを全て文章で書かないといけないということで、ま、少し使いづらいかなと思っております。ま、とはいえとても重要な機能にはなりますので、まずは機能の紹介をしつつ、改めてチャットフローを紹介する際にもご紹介したいと思っております。というのを踏まえつつ、変数の解説になります。

***

### **「変数」の基本概念 (3:21 - 4:03)**
変数の解説です。変数は箱に例えられることがよくあります。こちらにイメージ図を貼っておりますけども、箱を1つ作っておいて箱に名前を付けることができます。また箱なので箱の中身を入れ替えることができまして、例えば文字や数字などの情報を含めることができますと。で、Difyとしては3つ設定する情報がありまして、1つ目は変数の名前、箱の名前ですね。箱の名前で、こちらは処理で扱われるので、基本的には英語か数字で書いてあげる必要があります。またプログラム用語としてはキーと呼んだりもします。まずは1つ目、箱の名前、変数名が必要ですと。また箱なので箱の中身ですね、に情報を渡す必要があって、こちらが、ま、値と呼んだりバリューと呼んだりもします。一般的にはキーとバリュー、キーとバリューという関係になっています。それともう1つラベル名も設定することができて、こちらはチャットボットを扱うユーザー向けの情報になります。こちらはユーザー向けということで日本語でも書けるので、ま、性別だったり年代だったり、入力してほしい情報をラベルを付けてあげるということもできます。

***

### **「変数」の種類と設定 (4:03 - 5:05)**
で、この変数の種類がいくつかありまして、大きく4つあります。単文1行と複数行の段落。またいくつか選択肢を設定できる選択と数字ということで4つですね。で、単文と段落については文字数を設定することもできるんですけども、単文1行の方は最大256文字。段落の方は未設定であれば1000文字、設定すればもっと多く、ま、3万文字などもいけるということにはなっております。また全て必須かどうか設定可能ということで、チャットを始める時にこれらの設定をユーザーにしてもらうということができます。というのを踏まえて改めてDifyの画面も見ていきます。こちらがチャットボット基本の箇所ですね。で、画面少し下がりまして変数の箇所があって追加のボタンを押しますと、こちらで単文、段落、選択、数値ということで選ぶことができます。とりあえず単文という箇所を選ぶとこういう表示になるんですけども、画面の右側の歯車のマークをクリックすると、こちらがチャットフローでも扱う画面になっていて、こっちで慣れた方がいいのかなという風に思っております。まずはフィールドタイプということで先ほどの4つの選択肢があり、変数名は英数字ですね。ラベルは日本語でオッケー。文字数最大4096となってますが、256まで設定することはできます。また必須かどうかということで設定もありますと。で、段落も同じなんですけども、こちら複数行、たくさんの文章を入れる場合はこの段落にします。で、選択の箇所でいくつかですね、このオプションを追加というところで選択項目を選ぶことができるので、これはとても使いやすいかなというところですね。あと数値はその名の通り数値を入れてあげるということもできます。

***

### **「変数」の実践的な使い方 (5:05 - 7:17)**
実際に少し使ってみた方が分かりやすいと思いますので、今回はタイプとして選択を選びますと。で、変数名タイプとしておいて、ラベル名を相談相手としておきます。選択項目をいくつか設定できるので、今回は高校生ギャル、ベテラン営業マン、このあたりは適当なんですけれども、2つ選択項目を設定してあげることにします。こちらも必須にしますと。で、手順が事前の設定ですね。で、この手順の中に先ほど設定した変数を含めることはできます。こちらはスラッシュを押すと変数名を選択できるというショートカットがあるんですけども、スラッシュを押してこのタイプという先ほど作ったものを選んであげると。あなたはタイプですとすると、高校生ギャルかベテラン営業マン、ま、どっちかってことですね。どっちかの情報が入ってくる。で、それらの口調を想定して返事を返してほしいということでこちらのサンプルを流してみることにします。変数の箇所ですね。変数の箇所を選び、選択ですね。変数名、今回はタイプとしておりますが、特に変更していただいても大丈夫です。ラベル名が相談相手としておきます。オプションが先ほどこのプラスで追加したんですけども、高校生ギャルとかベテラン営業マンとかですね。ここももちろん自由に変更していただいて大丈夫なんですが、設定して保存をしたとしますと。そうすると変数の中にタイプという箇所が増えているということですね。これで変数ができました。で、変数作りましたら画面上の手順の箇所でスラッシュを入れてあげますと、1回消してスラッシュですね。スラッシュを押すと先ほど作った変数を選ぶことができます。タイプとすればこれが変数、箱ですね。箱になって、この中身には高校生ギャルかベテラン営業マンが入ってくるということになります。というのを踏まえつつ、先ほどの方ですね。あなたはタイプです。口調を想定してという箇所を丸っとコピーしてDifyのこの手順の箇所に貼り付けてみることにします。こうですね。あなたは高校生ギャルかベテラン営業マン、ま、どちらかになるんですけど、その口調を想定してくださいということです。画面の右側にリフレッシュという箇所も表示されましたので、リフレッシュしつつ念のため更新のボタンも押しておくことにします。で、そうするとユーザー入力フィールドということで、このチャットを開始する前に相談相手を選ぶという必要が出てきます。今回は選択で選んでるので、どちらかってことですね。どちらかをチャット開始時に選んでもらうと、例えば、ま、ギャルだとしますと。で、文章は何でもいいんですけど、夏休みの宿題が全然終わってないよとかですね。適当に相談したいことを叩いてみると、高校生ギャルっぽい口調で返事してほしいということで、「え、マジで？」ってことで返ってきてますと。これがギャルっぽい言葉なのかどうかっていうのはちょっと悩ましいところなんですが、こういう口調で返ってくることになっておりますと。で、続いてですね、一旦リフレッシュしますかね。一旦リフレッシュして、次は営業マンですね。営業マンとして改めて相談してみます。夏休みの宿題が終わってないよ。ま、問いかけはそのままでこれで実行してみますと、ベテラン営業マン的な口調ということで、さっきと比べるとしっかりした文章になっているかなというところですね。また公開するの方も確認しておきます。

***

### **アプリの公開と動作確認 (7:17 - 8:05)**
公開するでアプリの実行の箇所ですね。こちらを見ますと、チャットを始める前に相談相手ということで選択項目が出るようになっています。で、先にこの変数で設定した内容を選んでもらってからスタートすると、すでにベテラン営業マンというのが設定されてる状態ってことですね。それで夏休みの宿題が終わってないよとか、ま、適当に入力しますと営業マン的な文章が返ってくると、具体的なタスクを書き出そうとですね。このあたりが出てきます。ということで、チャットボット基本の変数の解説だったんですけども、変数自体は箱です。で、箱の中に何か情報が入ってきます。さらに、入力フィールドと書いてますけども、チャットを始める状態で、ま、いくつか選択してもらうことで聞く内容などを選ぶことができるようになるという機能もありますので、この入力フィールドとしてフォームと呼んだりしますけども、フォームとして使うこともできますので、これらの機能もぜひ知っておいていただきたいと思います。またチャットフロー、ワークフローの際に改めてご紹介いたします。変数の解説が終わりましたので、その他の機能を解説していきます。

***

### **その他の機能（ビジョン、コンテキストなど） (8:05 - 11:33)**
コンテキストやビジョンなどがあるんですけど、特にこのビジョンについては選んでいるモデルによって表示されたり表示されなかったりします。例えば今はGPT-4o-miniなんですけども、これはビジョン対応、画像認識対応なんですけれど、この目のマークですね、目のマークがないもの、例えばGPT-4などを選択するとビジョンの項目は消えているというのも分かります。モデルによって表示されたり非表示になったりするということですね。今回はコスパのいいGPT-4o-miniを選んでという体で進めていきます。まずコンテキスト、上の方からいきますと、こちら外部知識をインポートする機能になりまして、追加ボタンを押して、PDFだったりCSVなどを選んで、社内のQ&Aから確認して返答するということもできるんですけども、こちらはまた追ってご紹介いたします。で、ビジョンは画像認識ですね。こちらで設定するかしないかということで画面の右側に画像のアイコンが出ていたり消えたりするんですけど、これを有効にしておくと画像を認識することができます。また下の方に機能追加というボタンがありますので、こちらを押しますとさらにいろんな機能を選択することができます。ま、複数あるんですけども、特に良く使うのは会話の開始という機能になりますので、まずはこちらをチェックして有効にしてみることにします。有効にして閉じますとチャットの強化ということで先ほどの会話開始の機能が追加になっているということですね。こちらはチャットを始めた時の歓迎文だったり選択肢をあらかじめ設定することができますので、今回は簡単な例題あった方が分かりやすいと思いましたので書いております。ここに書いた内容が最初に表示されます。どんな内容を聞きたいですかということで、営業成績の上げ方、苦手な上司との対応方法というのをあらかじめ設定しておこうということですね。で、こちらの文章をコピーして、先ほどのDifyの会話開始ですね、のオープナーとなってますけども、これが歓迎文というか最初に表示される内容でございます。で、下の方にオプションを追加ということでボタンを押しますと、現在は5つまでですね。5つまで開始質問ということで選ぶことが、設定することができますので、営業成績の上げ方と苦手な上司との対応方法というのをそれぞれ選べるようにしてみたいと思います。ま、2つ設定して保存としておきます。で、そうすると画面の右側の方に表示されてますけども、チャットを開始したタイミングで先ほど設定した文章とボタンが選べるということですね。で、もういくつか追加でまとめてご紹介しますと、フォローアップという箇所があって、これを付けておくと自動的にその他の質問を考えてくれるというか、会話を続けるような機能になっています。こちら自動的に文章が生成されるので、良し悪しなんですけども、追加でこちらもチェックしてみることにします。会話開始とフォローアップですね、この2つを付けている状態で改めて確認していくことにします。公開するのアプりの実行から見てみることにします。まずは相談相手ということで、こちらは変数で設定した内容ですね。変数で設定した内容が最初に選択項目として出てきます。で、スタートチャットを押しますと、先ほどの設定した最初の文章ですねと選択項目ということで2つ設定しておりましたので、これらが表示されます。で、このボタンをクリックしてもいいし、ここを気にせずに自由に文章を書くこともできるんですけども、ボタンをクリックしますと、この対応方法を知りたいんだってことで、自動的にわざわざ文章を入れなくてもですね、よくある質問などを書いておくと押すだけで会話が始まるということになります。また下の方ですね、Try to askということで、どう接するべきかとかストレス解消法とか、他の質問が表示されるのでこのボタンを押してもいいし、気にせずに文章を書いてもいいということですね。で、適当にボタンを押しますと、ざーっとこう返答が返ってくるような内容。で、さらにランダムで会話の内容が表示されるんですけども、この機能も良し悪しなので必要に応じて付けていただければと思います。それともう少し引用と帰属という機能がありますので、こちらの確認なんですけども、こちらはインターネット検索したり、社内文章などを検索した際にどこから情報を引っ張ってきてるかというのが分かるように、リンクを表示してくれる機能になりますので、基本的にはこちらは有効にしておくといいのかなというところでございます。それと他に音声関係もあるんですけど、こちらはですね、動画収録時点ではあまりうまくいかなくて、音声からテキストなどを付けてみるものの、ちょっとエラーが出るので、やってみますけども、「音声入力のテストです」。とするとですね、「Speech is not enabled」となっていて、うまく いかない。ま、追々こちらも動くようになるとは思うんですが、動画収録時点ではうまく機能していないので、この音声関係は外しておこうかなというところでございます。この中から選ぶとしたら会話の開始ですね。最初の歓迎文であったり、どういう風に操作すればいいんだという説明ということでこちらを付けておくと、ま、使う側としても始めがスタートしやすいので、こちらはぜひ付けていただいて、このフォローアップに関しては良し悪しあるので、必要に応じて付けていただくといいのかなというところでございます。

***

### **プロンプト生成器の使い方と注意点 (11:33 - 13:44)**
これまでの解説でチャットボット基本の一通りの解説ができましたので、改めてこの手順の中のプロンプト生成器について確認をしていくことにします。このプロンプト生成器を使ってプロンプトを作りますと、この手順の内容ももちろんなんですけど、変数だったり機能の内容なども丸っと上書きされてしまいますので、もしこれまでの設定を残しておきたいという場合は改めてチャットボットを作り直していただければと思います。今回はそのまんまプロンプト生成器でプロンプトを作り直すことにします。で、こちらの星マークの自動の箇所をクリックしますと、プロンプト生成というポップアップが表示されます。高品質で構造的に優れたプロンプトを作るための最適化を行いますということで、ま、やってほしいことをこちらで書くと、そこからさらにカスタマイズしてですね、優れたプロンプトを作ってくれるということでございます。で、こちらに色々と参考の文章がありますので、例えばExcelの式のエキスパートですね。こちらをクリックしますと、この指示文がすでに用意されていますので、「ユーザーの指示に基づき、Excel式の理解、使用、作成をサポートするチャットボット」という目的ということで書きますと。これがやりたいことなんですけれど、これをさらにクオリティを上げるということでプロンプトを作ってくれるということなので、この生成のボタンを押します。で、少し時間がかかるんですけど、しばらく待っていただきますとプロンプトが生成されますと。で、自分で書くよりもかなり内容が長いですし、さらにこのXMLと呼んだりするんですが、インストラクションというタグがあったり、下のほうにインプットだったりアウトプットだったり、ま、しっかり指定したほうが精度の高い回答が出てくると。またexampleということで、ま、こういう質問が来たらこう返してねということで回答例ですね。回答例なども自動で作ってくれると。で、さらに変数ということでユーザーが入力する場所もありますし、チャットの強化、会話開始ですね。チャットを開始した際の歓迎文ですね。そちらもずらっと書いてありますので、これで適用というボタンがありますので押してあげますと、既存の設定が上書きされますということでございます。今回はそのまま確認と押していくことにします。で、適用のボタンを押しますと適用の文章も変わりますし、変数も変わるし、会話開始の内容ですね。こちらの文章も変わっていきます。で、こちらは、この選択項目がありましたので、この2つは削除しておくことにします。ということで、実際に試してみたいんですけども、リフレッシュを押しつつ、公開から更新を念のため押しておくことにします。で、変数設定してますので、まず初めにuser_instruction、responseということで書かれていて、このままだとちょっと何を入ればいいのかというのが分かりづらいですけども、今回はもうそのままExcel、Excelと入れることにします。Excel、Excelと入れつつ、聞きたい内容ですね。18以上なら大人と表示させて、17以下なら子供と表示させる方法を教えてとかですね。Excelの関数に関連する内容を聞いてみます。で、そうするとIF文使うんですけども、こういう風に書けば作れるよということで、返答してくれていますと。ま、この会話開始の変数がですね、あまり機能してない感じがするので、ちょっともったいない気はするんですけれど、プロンプト生成器を使うことで綺麗なプロンプトはできるはしますので、ここからさらに調整していくのも慣れてくると便利な機能ですのでぜひ一度やってみてください。

***

### **その他のメニュー（APIアクセス、ログ、監視） (13:44 - 15:33)**
前回までの解説でチャットボット基本の中のオーケストレーションの内容を確認していきましたので、その他のメニューについて確認していきます。まずAPIアクセスなんですけれど、これはどちらかというと開発者向けの情報になっていて、ま、開発、接続するために必要な情報がざーっとこう解説されていたり、サンプルのコードもあったりするんですけど、今回の講座としては非エンジニア向けということで、プログラムについては最低限にとどめたいと思いますので、このページの解説は割愛させていただきます。続いてログとアナウンスというメニューがあります。ログはアプリケーションの実行状態を記録しますということで、これまでやり取りした時間であったり内容であったり、大まかなタイトルであったりメッセージ数などが表示されています。過去の箇所をクリックすると当時のやり取りが記録されているということですね。またユーザーレートということで会話の最中にいいねボタンを押すことができまして、もし、いいねボタンを押されたらこちらにもチェックが入るということになります。ま、どのユーザーがどれぐらい活用してるかというのをここで確認することもできますし、期間を選択することもできるので、過去1週間、1ヶ月、1年とかですね、このあたりで設定することもできます。それと注釈というメニューもあります。これは英語でアノテーションと呼ばれるもので、注釈を追加というボタンを押しますと、よくある質問と、この質問が来たらこういう回答をしてねというので、あらかじめ設定することができる機能になっております。ただ今回の講座としては、社内情報をCSVなどで作っておいて、それをアップロードするという方法で進めたいと思っておりますので、この注釈については必要になればまた改めてご紹介したいと思っております。続いて監視というメニューがありますので、こちらを見ますとURLだったりプレビューが表示ですね。表側でどういう風に表示されるかというのも確認できますし、下の方に下がっていきますと、やり取りしている数だったり使ってるユーザーだったり、1度あたり何回ぐらい会話してるかであったり、トークンですね、文字の量も表示されていたり、いいねが押されていればそれのパーセントですね。満足度ということでパーセントが表示されたり、会話しているとトークンを使うことになって、こちらで料金にも影響してきますので、実際にチャットボットを稼働させた後にこの監視のメニューもちょくちょく見るようにして、トークン数が問題ないかとかですね、いいねの数であったり、ま、どれぐらいのユーザーが使ってるんだというのも簡単に確認することができますので、ぜひこちらのメニューも定期的に見るようにしていただければと思います。続いて他のアプリの作り方もありますので、それらを解説していきます。

***

### **エージェント機能の紹介 (15:33 - 17:53)**
前回までの解説でチャットボット基本の作り方を解説しましたので、他のアプリの作り方を簡単にご紹介します。Difyの画面のスタジオの中で、画面左側のアプリを作成ですね。最初から作成をクリックしますと、作り方ということで4つ選択肢があって、前回まではチャットボットの基本を押しておりましたと。今回は解説の都合上、エージェントから先にご紹介することにします。エージェントをクリックしまして、名前は簡単にエージェントサンプルとしておくことにします。アイコンも適当に変えても変えなくても大丈夫でございます。適当に変えて作成するとしますと、エージェントとしてアプリを作ることができます。で、パッと見で分かると思うんですけど、前回までご紹介したチャットボット基本ですねと設定項目はほとんど同じになります。ほとんど同じなので、違うところだけ抜粋してご紹介したいと思うんですけども、画面下の方に行きますとツールという箇所が違う場所になります。このツールというのは、追加のボタンを押しますと、ツールを追加するということで、組み込み、カスタム、ワークフローとありまして、組み込みというのがDify側で用意しているものになります。で、カテゴリーもいくつかあるんですけど、検索であったり、イメージというのが画像ですね。DALL-E 3というのが画像生成のサービスになりますし、他にもStable Diffusionなどのサービスも認証が必要なものもあるんですけど、ログインしてAPIキーを発行したら連携して使うこともできるということです。また、個人的によく使うのはコードインタープリターなんですけども、すべてですね。カテゴリーをすべてにしてコードと検索するとコードインタープリター、これコードデータ分析の機能が追加できたり、あとQRコードを作るツールなども追加することができたりします。で、ちょっと注意としては検索機能でGoogleがあるんですけども、Googleを使うためにはユーザー登録してAPIキーを発行する必要がありますので、ここは少し手間がかかるかなと思います。で、認証不要で使えるものとしてこのDuckDuckGo Searchというものがありますので、こちらを使って検索することもできるということになります。で、試しにイメージのDALL-E 3などを追加してみると、このツールを使うことで画像生成ができるはずなので、こちらでツールを試してみることにします。一旦リフレッシュ更新などもしつつ、例えばなんですけど、複合AIをイメージできるような画像を生成してというプロンプトを打ってみます。で、こうしますと、ツールとしてDALL-E 3設定してますので、DALL-E 3も稼働してですね、画像を生成してくれると。今使用中ということで表示されてますけども、少し時間が経ちますと画像が生成されるはずです。少し注意としては、この画像生成は会話のやり取りするのに比べるとちょっと料金が高くなりますので、そこは注意かなと思いますが、画像が生成されたということで画像を作ることもできます。ツールを組み合わせることで生成AI以外の機能も組み合わせることができるということですね。こちらDifyのイメージなんですけども、外部ツールということで、WikipediaだったりYouTubeだったり、Stable Diffusionなど、生成AI以外の既存のツールなども組み合わせて扱うことができると。会話のやり取りだけであれば前回ご紹介したチャットボットなんですけども、この画像の生成だったり他のツールも組み合わせるという場合はエージェントから作っていくという方法もありますので、ぜひこの画像生成ですね、1枚なりやってみるとイメージがつくと思いますので、ぜひ試してみてください。

***

### **テキストジェネレーターの紹介 (17:53 - 19:12)**
新しくアプリを作成する方法としてテキストジェネレーターというものがありますので、このタイミングでご紹介します。このテキストジェネレーターは、これまで扱ってきたチャットボットやエージェントとは違ってチャットではないというのが特徴になっています。チャットではない、会話のやり取りではなくて、文章を作ったり加工するのに特化した機能になっています。またこのテキストジェネレーターの特徴としてバッチ処理というのがありますので、合わせてご紹介しますと、変数の情報をまとめたCSVファイルを作っておいて、それをインポートすることでまとめて処理を実施できると。同じようなことをやりたい時に1回ずつやるんではなくて、あらかじめファイルを作っておけば10個であれば10個まとめて処理ができるというような機能もあったりしますので、合わせてご紹介いたします。で、今回はいつから作ってもいいんですけど、テンプレートとして翻訳機能のこのテキスト生成の機能がありましたので、こちらを使って試してみることにします。Difyの画面を開いていただいて、スタジオの状態ですね。で、画面左側のアプリを作成ですね。最初から作成の下にテンプレートから作成というものがありますので、今回はテンプレートから作っていくことにします。で、たくさんあるんですけど、アシスタントの箇所ですね、アシスタントの箇所にTranslation assistantというテンプレートがあって、その下の方に小さい文字なんですけども、テキスト生成と書いてありまして、これがテキストジェネレーターの意味になります。で、このテンプレートを使うということでこのボタンを押していただいて、アプリの名前やアイコンは変更しても しなくてもOKなんですけども、このまんま作成としてあげることにします。で、そうするとチャットボットやエージェントと基本的な画面構成は同じになっています。ま、プロンプトがあって変数があって機能を追加を押しますと、ここはかなり少ないんですけども、チャットと違って1回きりのやり取りですので、必要最低限のものに絞られているという状態でございます。すでにプロンプトなども設定されていますので、今回はこのまま進めることにします。モデルも3.5Turboなんですけども、このままでいいかと思います。

***

### **テキストジェネレーターの実演 (19:12 - 21:36)**
公開するの更新を押しつつ、アプリを実行のボタンを押しますと、こういう画面になって、ま、チャットとは少し画面が違うというのが分かるかなと思います。今回は翻訳アプリということで、インプットランゲージの方を見ますと、中国語か英語ですね。ま、英語で入力したものをターゲットランゲージということで、今回は日本語に変換したい、翻訳したいということで設定をしておくことにします。で、テキストが翻訳したい内容ということで、ま、適当にgood morningとしておくことにします。これでExecute、実行と押しますと、この出力の形式をプロンプトで書いていると思うんですけども、オリジナルテキストはgood morningで、変換先はおはようございます。ということで、ま、無事に変換、翻訳できているというのが分かります。これが1回きりですね。Run Onceと書いてあって1回きり実行するんであれば、普通に変数設定して実行すればいいんですけども、この新しい機能としてRun Batchということでバッチファイルを用意しておけば、ま、10回であれば10回ですね、まとめて処理をすることができるというのが特徴になっています。で、こちらは変数を設定する必要があるんですけども、画面の下の方にDownload the template hereというリンクがありますので、こちらを先にクリックしてこのテンプレートファイルをダウンロードしておくことにします。で、ダウンロードしましたら、こちらをメモ帳などで開いていただくと、こういう表示になっていて、1行目が変数ですね。変数なんですけども、Target language, Text, Input_languageということで、設定している変数によってこの値は変わってきます。で、今回設定した内容を見ておきますと、ターゲットが日本語でインプットは英語ですね。なので、こちらに合わせて入力したいテキストなどを入れていくということで、ターゲットの方がJapaneseですよね。で、インプットの方がEnglishとなってますと。テキストの方適当なんですけども、good morningだったり、これを何度かコピーしまして文章を変えると動作確認ができるはずです。helloだったりgood byeだったり、good nightでおやすみなさいですね。このあたりで、今回は適当に4行だけ変更してますけども、もちろんやりたい内容がたくさんあればそれをCSVとしてまとめてあげればOKということでございます。で、注意が少しありまして、まず1つ目は文字コードですね。文字コードが、これはメモ帳によって書いてる場所が違うと思うんですけども、僕が触っているエディタでいきますと、この右下の方にテキストエンコーディングとありまして、UTF-8になっていればOKなんですが、もしExcelなどで開くとShift_JISになっていることが多いので、この文字コードはご注意いただきたいなというのと、あと最後に改行して、もしこの6行目が空っぽの行になってしまうんですが、こうなっているとうまく認識できないので、最後の行までしっかりと情報が入ってる状態にするように注意してください。で、こうしまして、1行目が見出しであり、変数の情報、2行目からはそれぞれの情報を入れておくとしますと。で、ファイルを作りましたら、Run Batchの方で先ほど作ったファイル、CSVですね。CSVを選んで実行すると4つ情報を入れましたので、おはようございます。こんにちは。さようなら。おやすみなさい。ということで、4つの文章をまとめて翻訳かかっているというのが分かると思います。また画面の右上の方にダウンロードというボタンもありますので、ダウンロードしましたら実行結果ですね。処理結果も見えるということになっております。さようならということで、同じような処理を何度も実行したい場合にはこのバッチ処理もとても便利かなというところですね。

***

### **「これに似たもの」機能の紹介 (21:36 - 22:33)**
あとはオリジナルの機能として、機能を追加の中に「これに似たもの」という、ちょっと不思議な日本語で設定されているんですが、この右側にこれですね、「More like this」と書かれてます。マウスを動かすと消えてしまうんですが、「More like this」という項目が追加されて、同じようなもの、似たようなものを表示することもできる機能になっています。そこまで見てあげますと、先ほどと同じ要領で「good morning」と実行すると、これですね。「More like this」というボタンが新しく追加になっていて、これを押しますと、うーん、ほぼ同じ内容になっていますけども、今回は入力した文字がシンプルなので、あまり変えようがないというところですかね。もう少し長い文章であれば別の結果が出力されるはずですので、もし別の回答も見たいなと思った場合はこのボタンも活用いただけるということですね。「良い朝です」ってことで、少しだけ内容が変わっていると出すことができます。このテキストジェネレーターに関してはチャットボットではないので、初めは少しとっつきにくいかもしれないんですけども、翻訳機能だったり文字を要約したり、ブログ記事を作ったり、やりたいことが決まっていて1回のやり取りで完結するんであればこちらの機能も便利ですので、バッチ処理使えばまとめてたくさんの処理できたりしますので、こういう作り方もあるということをぜひ知っておいてください。

***

### **セクションのまとめ (22:33 - 23:18)**
このセクションのまとめになります。このセクションでは3つのアプリ作成方法についてご紹介しました。チャットボットの基本と、チャットボットにツールを組み合わせたエージェントと、1回きりの実行やバッチ処理に特化したテキストジェネレーターということで3つの方法をご紹介しております。この3つともプロンプト、指示文をしっかり作り込むことで思ったような返答が返ってくるというのが特徴にはなるんですけれど、処理に順番を持たせたいであるとか、変数によって処理の内容を分けたい、分岐させたいと思った時にそれらを全て文章で書くのはなかなか難しいなというのが現状でございます。または複数のLLM、例えばチャットGPTとGoogleのGeminiなどを複数組み合わせるということはできないので、それらを含めた発展版ということでチャットフロー、ワークフローという機能がありますので、次のセクションでご紹介いたします。またこれまでの解説でもし分かりにくい箇所などありましたら、お気軽にQ&Aからご連絡いただければと思います。また分かりやすかったなどありましたら、高評価、口コミなどもいただければ幸いでございます。引き続き次のセクションではチャットフロー、ワークフローについて解説いたします。


***

### **チャットフローとワークフローの概要 (0:00 - 0:31)**
このセクションでは、チャットフローやワークフローについて解説をしていきます。Difyでは、チャットフロー、ワークフローという機能がありまして、こちらにサンプルの図を持ってきているんですけども、ブロックを組み合わせて処理の流れを作るノーコード、ローコードのツールが用意されています。こちらがブロックと言ったり、他のノーコードのツールだとノードと呼んだりするんですけども、ノードブロックがありまして、そのブロックを線でつないで、処理の流れを左から右の方に処理を作っていって、条件を付けて処理の分岐をさせる、処理を分けるということもできたりしますと。で、このチャットフロー、ワークフローということで2種類ありますので、まずはそちらの違いについてご紹介いたします。

***

### **チャットフローとワークフローの種類の違い (0:31 - 0:53)**
Difyの画面からスタジオの最初から作成の箇所をクリックしますと、まずチャットボットがありまして、チャットボットの作り方として2つあります。基本とチャットフローですね。こちらがチャットボットをフローで作ります。先ほどのブロックを組み立てて作るパターンということになります。それともう1つワークフローという選択肢もありまして、ワークフローをクリックすると、こちらからでも作成することができます。なので、ワークフローとチャットフローということで2種類、先ほどのブロックを組み立てるパターンがあります。

***

### **チャットフローとワークフローの機能比較 (0:53 - 1:47)**
そのチャットフロー、ワークフローの違いということで、簡単な表にしてまとめております。まず特徴ということで、チャットの方がチャットですよね。会話をするということで、前回のセクションで扱ったチャットのように、チャットの入力が必須になっております。対してワークフローは前回のセクションでいくとテキストジェネレーターのようなものなんですけども、入力はなくても実行することができるというのが特徴で、1回きりで実行するか会話ということでやり取りするかという違いがあります。用途としてこちらホームページに書かれている内容を持ってきているんですけども、今回の講座としては会話型のアプリを作りたいということで、このチャットフローの方をメインで扱っていきます。また開始ブロックなども後ほどご紹介するんですけども、開始ブロックの中のこれは変数なんですが、変数にも少し違いがあったり、他に使えるブロックということで回答ブロックと終了ブロック、1回きりで終わるので終了ブロックが使えたり、役割を返すための回答ブロックということで、少し役割が違うブロックが存在します。またメモリ、記憶領域もチャットの場合は会話が何回か続いていくということで、以前の会話の記録を残すために記憶領域が使えると。ワークフローの場合は1回きりなので、このメモリは設定できないというのが違いになっています。今回の講座としては、社内文章を読み込ませた会話型のチャットボットを作りたいということで、このチャットフローをメインにご紹介していくことにします。

***

### **チャットフローの作成開始 (1:47 - 2:30)**
まずは作成してみようということで、チャットボットからチャットフローですね。新規でアプリを作ってみて、その中身を解説していくことにします。実際の画面を選びまして、スタジオの最初から作成で、チャットボットのチャットフローですね。こちらの上級ユーザー向けと書かれておりますけども、こちらを選んでください。名前は何でもいいんですけども、今回はそのままチャットフローサンプルという名前で作っていくことにします。またアプリのアイコンも適当に自由に選んでいただければと思います。チャットなのでこの辺の会話のアイコンにしますかね。この辺りは自由に変更いただければというところです。まあ、説明は入れても入れなくてもOKなんですが、これで作成を押しますと、チャットフローから作成すると自動的に開始ブロックとLLMブロックと回答ブロックということで、これが最初からもう接続されている状態になっていますので、まずはこの画面の内容を確認していくことにします。

***

### **チャットフロー画面の基本操作 (2:30 - 4:00)**
チャットフローを選んで新しいアプリを作成した画面になります。色々と新しい要素が増えておりますので、まずはこの画面について解説をしていきます。まず左側からいきますと、オーケストレーター、APIアクセス、ログアナウンス、監視ということで、こちらは前回のセクションのチャットボットとそれ以外の要素につきまして、資料にもざーっと書いているんですけれど、なかなか文字だけでは分かりづらいと思いますので、順を追って確認をしていきます。画面上のブロックの外で右クリックするパターンと、ブロックの上で右クリックするパターンがありますので、まずはこちらの確認でございます。これらがブロックですね。左クリックでそれぞれのブロックを選ぶことができます。で、ブロックの外側にマウスを移動させた状態で右クリックをすると、こういったメニューが表示されてブロックを追加したりコメントを追加したりすることができます。ブロック、コメントを使うことが多いかなと。で、ブロックを押しますと、さらにブロックいくつか種類がありますのと、ツールということでダリだったり、コードインタープリターなどの種類を選ぶことができるんですけども、ブロックについては追って細かくご紹介いたします。それとコメントですね。コメントはこちらから設定することが多いんですけれど、処理の流れだったり、重要な内容であれば、このメモということで、作ってる最中の処理の流れなどを書いていくこともできます。このコメントは色を変えることもできまして、自由に色を変えたり、リンクを付けたりですね。著者を表示するということで、ユーザー名を書くこともできます。画面の外側ですね。コメントの外側でクリックすればこちらは消えますと。またブロックを選んでる状態で右クリックをしますと、開始ブロックにはヘルプのリンクしかないんですけれども、このLLMの箇所ですね。こちらで右クリックをすると、このステップを実行、ブロックを変更、コピー、複製、削除、リンクなどのメニューが表示されます。おいおいまたご紹介しますけども、この複製というのをやると同じブロックを丸とコピーすることができて、この線のつなぎ直しなどの際に便利な機能になりますので、この複製もしておいていただければというところです。またブロックに合わせてブロックの右上に点3つのアイコンがあるんですけども、こちらをクリックすると削除など先ほどのメニューが表示されますので、不要であれば削除することもできますということですね。ブロックの右クリックでございます。続いては画面下の内容をいくつかご紹介します。

***

### **チャットフロー画面下部のツール解説 (4:00 - 4:49)**
ブロックの下の方、この辺りですね。まずは拡大縮小ということで、クリックすればそのまま拡大したり縮小したり、あとパーセントの箇所を選択すれば100%200%などの調整もできます。続いて元に戻すやり直しですね。この辺りはコマンドのセットなどのショートカットもそのまま使うことができます。変更履歴、ブロックを追加などした場合は履歴も残っていくことになります。続いてはブロックを追加、コメントを追加ということで、先ほど右クリックで設定した内容を画面下から選ぶこともできます。あとはハンドモードとポインターモードというのがありまして、これは使い分ける必要があるんですけども、ハンドモードにすると左クリックをしながら画面を移動することができます。またブロックは1個ずつ選択ですね。複数ブロックを選ぶ場合にポインターモードこの矢印の方を選びますと、ビヨーンとこう範囲を広げて指定することができますので、まとめて選んで、このレイアウトを変えたいとした場合にはこのポインターモードも使うことがあります。これもショートカットとしてありますので、必要に応じて切り替えていただければというところですね。と、ブロックを整理という機能もありはするんですけれど、これを押しますと複雑なフローになってくるとちょっと思ってるレイアウトにならないということもよくありますので、個人的にはあまり使わないかなという機能ではあります。

***

### **チャットフロー画面右上のツール解説 (4:49 - 6:36)**
それと右上の方ですね。こちらにも色々と機能がありまして、まずは機能の箇所を見ておきますと、機能は以前チャットボットなどでもご紹介していたんですけども、チャットボットに機能を追加ということで、会話の返し、フォローアップなどの機能を追加することができますので、こちらで必要に応じて追加することができます。あとは左からいきますと、こちらはバージョン0.7で追加された会話変数というものがあって、これはまた後ほどご紹介します。その隣、環境変数というものがあって、こちらは個人情報、認証情報など、他の人には見せたくない重要な機能、DSLファイルには含めたくないような情報がもしあれば、この環境変数の中に追加することができます。Type、変数の型ということで、文字なのか数値なのかということで選んでKeyとValueですね。変数として設定することもできます。と、プレビューと押しますと、現在もうすでにブロックが接続されているんですけども、この接続に沿って実行することができます。ま、社内向けチャットボットのアイデアを出してとか、適当に入力して実行すると、このワークフローということで、開始からLLM、GPT-4を経由して回答するというフローができているので、それを実際に試すことができるという内容になっています。また実行しますと、ワークフロー処理ということで、この中身ですね、どのブロックを通っているかというのも見ることができまして、今回は開始、LLM、回答そのままなので、そのまま表示されてるんですが、例えばIF文などの分岐をかました時に、どっちのフローを通ってるんだというのを確認する時に役に立つ機能になります。ログを表示などすると、その内容ですね、ま、ちょっと細かい内容になるんですけれど、さらに細かく見たい時にはこの辺りを確認することもできます。使われているトークン数なども見ることができます。それとプレビューがありまして、その隣は実行履歴ですね。先ほど実行した内容なども残っていきます。その隣がチェックリストなんですけども、例えばブロックを組み合わせて立てながら何か必要な要素が足りてないとか、ブロックが繋がってないとか、解決しないといけない内容がもしあればこちらで表示されるので、ここが赤くなっていたりしたら確認していただければというところですね。と公開する場所はもう以前のチャットボットと同じですね。一旦公開しますと更新もありますし、アプリを実行サイトに埋め込むなどの機能も以前と同様になっておりますので、更新しつつアプリを実行すると自動的にURLが発行されて、以前のチャットボットと同じようにスタートチャットと押しまして、何か入力すれば返答が返ってくるというような仕組みになっています。ということで、一通りの画面の解説をしましたので、続いてはこのブロックについて、たくさんの種類がありますので、これらについてご紹介をしていきます。

***

### **ブロックの追加と接続方法 (6:41 - 8:13)**
チャットフローを使って新しいアプリを作成すると、開始ブロック、LLMブロック、回答ブロックということで、最初から3つのブロックが線で繋がっているような状態になっていますので、まずはこの作り方を改めて確認したいと思います。ブロックの追加方法は、画面の下のブロックを追加のボタンを押すか、ブロックの外側で右クリックをしてブロックを追加というメニューをクリックしてあげると選べるブロックが複数ありますので、今回はLLMを選ぶということでブロックを置くことができます。で、ブロックにカーソルを合わせますと、その左側、右側にプラスの表示が出まして、こちらを左クリックするとビヨーンと線が伸ばせるようになっていまして、これでブロックとブロックを繋げることができるようになっています。例えば開始ブロックからLLM2の方に線を繋げて処理をさせるということですね。また開始ブロックは1つだけなんですけども、回答ブロックは複数作ることができますので、右クリックのブロックを追加から回答ブロックですね。回答ブロックをまずは作りまして、このブロックとブロックの間、線を引くことができるので、このプラスのアイコンを左クリックしてビヨーンと伸ばしますと、開始ブロックからLLMに、LLMから回答にということで処理の流れを作ることができるということになっております。また途中でフローを変えたいとした場合に、線にカーソルを合わせますとプラスのボタンが出ますので、こちらをクリックするとこの間に作るブロックなども設定することができます。今回はLLMということで設定すると、LLMを2回通るということで、このLLMについてはまた後ほどご紹介するんですけども、複数の生成AIをかませることもできます。またブロックを削除する場合はブロックの右上の拡張ですね。削除を押してあげると削除することができるので、削除しつつ改めて線を引き直すという作業が必要になります。また前回もご紹介したんですけども、画面の右上のチェックリストの箇所を見ますと、何も接続されていないということで表示されたりしますので、もしここに印が付いていれば、これらの問題も対応していく必要があるということになります。ということで、ブロックの作り方と線の引き方になります。一旦下の方のブロックは削除しまして、改めて開始ブロックからLLMのブロックに線を引き直して最初の状態に戻したいと思います。ブロックには色々な種類があるんですけれど、共通で知っておきたい考え方がありますので、事前にご紹介いたします。

***

### **ブロックの基本イメージ (8:13 - 8:58)**
ブロックのイメージということで、簡単な図を作っているんですけれども、こちらがブロックのイメージ図になります。ブロック毎に何かしら処理があるんですけれど、その手前側で入力の情報、インプットの情報を渡すことができます。これが線で繋いでいるブロックからの情報になるんですけれど、線を繋いでいるブロックからの情報は全て変数で渡ってきます。変数で情報が入ってきまして、処理の中で渡ってきた変数を使うこともできます。また処理が終わりましたら出力ということでアウトプットということで別の変数を吐き出して、それを次のブロックに渡すことができると。ブロックの連結と書いてますけども、ブロックを線で繋いでいくんですけども、線で繋がっている間はこの変数ですね、箱なんですけども、箱の中に情報が入っていて、それを何かしら処理して、出てきた内容を元にさらに次のブロックに渡していくというような処理の仕方になっています。この変数についても改めてご紹介しますと、箱のようなもので名前を付けれるし、中身は変わりますと、変数の名前と箱の中の値を設定することができます。というのを踏まえて改めて先ほどのブロックを見ていきます。

***

### **各ブロックの役割と変数の流れ (8:58 - 9:56)**
まず開始ブロックから見ますと、開始ブロック合わせますと、事前に4つの変数が最初から設定されている状態です。このsys.queryというのがユーザーが入力した情報になります。線で繋がっているので、このこれらの変数は全てLLMブロックで扱うことができます。こちら、また後ほどご紹介しますけども、ユーザーというボックスの中でsys.queryが選ばれていると、ユーザーが入力した文字をここで使うことができるということですね。で、少し下の方に行きますと、出力変数という箇所がありまして、こちらでテキスト、ストリングと書いて、文章ですね。LLMとやり取りした出力結果をテキストという変数で次のブロックに渡すことができるということになります。次のブロックはまた線で繋がっているので回答ブロックになりますけども、この回答ブロックの中でLLMで返ってきた返答を表示させているという内容になります。こちらもスラッシュのキーを押しますと、繋がったブロックで使われている変数ですね。これらを選ぶことができまして、例えばユーザー入力はsys.queryだし、LLMから返ってきたものはLLMの中のテキストですね。こちらを書いてあげれば、出力として画面に表示することもできるということで、ブロックを線で繋ぐというのと、情報は変数ですね、変数で渡してあげる必要があるということをぜひ知っておいていただいて、改めてそれぞれのブロックの役割について確認解説をしていきます。

***

### **ブロックの追加方法と種類 (10:01 - 10:59)**
チャットフローで扱うことのできるブロックについて解説していきます。ブロックの追加方法は、ブロックの外側で右クリックをして、ブロックを追加というメニューをクリックすると設定できる作成できるブロックの一覧が表示されます。こちらもDifyのバージョンによって少しずつブロックが追加されているんですけれども、動画収録時点バージョン0.7時点でのブロックですね。こちらについて解説をしていきます。で、上から順番に解説してもいいんですけれど、ブロックによって役割が分かれておりますので、今回は一般向けとエンジニア向けということでブロックを2つに分けまして、特に一般向けの方を重点的に解説しようと思っております。まず初めにチャットフローでアプリを作成したタイミングで、開始ブロックと回答ブロックと生成AIを使うためのLLMブロックはあらかじめ用意されておりますので、この3つのブロックは必須になるかなと。それと、次のセクションで改めて扱いますけれども、外部文書、社内文書などを情報として持たせるために知識取得というブロックもありますので、これらが基本的なブロックになりますと。さらに条件によって処理を分けるIF/ELSEブロックだったり、質問分類器、またそれらをまとめる変数集約キーというブロックもあったり、こちらはバージョン0.7から追加された変数代入というブロックもありますので、この辺りをまとめて重点的に解説していきます。エンジニア向けの方は少し細かい内容になりますし、プログラミングなども入ってくるので、この講座としては簡単な紹介にとどめたいと思っております。まず初めに、この開始回答のブロックからご紹介していきます。

***

### **開始ブロックの詳細 (10:59 - 11:28)**
ブロックの種類、一般向けということで、まずは開始ブロックです。こちらは必ず1つ必要になりまして、複数作ることはできない。1つだけ最初に設定されているブロックになります。こちらはユーザーの動きを誘導するということで、前回のチャットボットと同じになるんですけども、会話開始時にユーザーに入力させる情報を設定することができます。こちらも前回と同じく1行の文章なのか、複数行なのか、選択項目なのか数値なのかということで選択することができるし、複数作ることができます。また最初からユーザーが入力した文章が入ってくる変数ということで、クエリというものもありますので、こちらもLLMで扱ったりしますので、こういうものがあるというのを知っておいていただければと思います。

***

### **開始ブロックの設定画面 (11:28 - 12:27)**
開始ブロックを左クリックで選びますと、画面の右の方に設定項目が表示されます。開始ブロック家のマークですね。こちらはブロック共通なんですけども、このブロックの名前を自由に変更することができます。開始となっておりますが、例えばスタートとか英語に変えようと思えばスタートということで表記を変えることもできたりしますので、同じようなブロックがいくつも増えてきたりした際に分かりやすい名前に変更するということもよくやりますと。説明を追加することもできますと。ということで、開始に関しては1つのブロックしかないので、書かなくてもなんですが、説明追加することもできますと。で、入力フィールドなんですけども、こちらが先ほどの変数ですね。以前の内容でいきますと、例えば選択項目を押して、タイプ相談相手ベテラン営業マンとかですね、ベテラン営業マンなどの設定を以前のセクションでしていますけども、こういう設定を追加することもできます。そうすると会話開始時に選べる内容を複数設定することができます。またシスクエリというのが実際にユーザーが入力した情報になります。この状態で画面上のプレビューを押してみますと、今組んでいるフローを試すことができまして、会話開始の段階で相談相手ということで入力今回は1つしか設定していないんですけれど、複数あれば複数表示されるということになっております。

***

### **回答（終了）ブロックの解説 (12:27 - 13:25)**
続いて、このフレームは次の動画で解説するんですけども、1つ飛ばしてこの回答ブロックの方を解説いたします。回答ブロックは処理の結果をチャット画面に表示するブロックになっております。チャットなので会話形式なんですけども、LLMから返ってきた内容をこのブロックを使わないと表側に表示できないので、この回答ブロックも必須になると。また回答の中で何かしら情報を書く必要がありますので、基本的には1つ以上の変数を設定することになります。LLMからの回答などが入ってきますので、こちらも確認しますと、これが回答ブロックを選んでいる状態ですね。回答ということで、こちらの文章が画面に表示されます。基本的には生成AIから返ってきた内容を会話の回答として表示させたいと。このやり取りに関しては、キーボードのスラッシュで叩くか、画面の右上の方にXの記号があるんですけども、こちらをクリックしても使える変数を選ぶことができます。こちらは以前もご紹介したんですけども、繋がっているブロックで扱われている変数から選ぶことができます。今回はLLMでやり取りした内容を表示したいので、LLMのテキストの箇所を書いてあげれば、生成AIに聞いて返ってきた内容をそのまま表示するということですね。なので、この変数はもちろんなんですけれど、もしこの回答の中で同じ文章を表示したいという場合はこちらに追記することもできます。生成AIからの返答になります。適当な内容なんですけども、回答の中に固定で文章を入れることもできるということですね。

***

### **回答ブロックの実演と応用 (13:25 - 14:00)**
こちらも動作確認する際は念のため更新しつつ、プレビューで相談相手を選び、「夏休みの宿題が終わってないよ」とか、この文章は適当ですし、今はやってるんですけども、これで返事しますとこうですね。頭に固定の文章を表示することができるようになります。チャットボットと同じく1回きりのやり取りというわけではなく、この返答からさらに続けることもできますので、例えば読書感想文が残ってますとか返しますと、また返答は返ってくるんですけども、一番初めですね、生成AIからの返答になります。ということで、先ほど書いた固定文が毎回表示されるということで、これも必要に応じてこの回答ブロックの中を編集いただければ、文章を固定にするということもできますので、この回答の中身ですね、こちらを加工することもできるということをぜひ知っておいてください。

***

### **LLMブロックの基本設定 (14:08 - 15:06)**
チャットフローで扱えるLLMブロックについて解説をしていきます。こちらは設定項目が色々とありますので、順を追って確認をしていきます。LLMブロックを選択しますと、ブロックの名前や説明などは自由に変更することができます。まずモデルなんですけれど、OpenAIに限らず、Googleだったり、Anthropicなど複数の会社のLLMモデルを選択することができます。モデルの登録方法は、画面右上ユーザーアイコンの設定からモデルプロバイダーの画面に設定できるモデルがたくさんありますので、それぞれAPIキーを取得して設定してあげれば使えるように、選べるようになるということになっております。で、現在はGPT-4o miniとなっておりますけども、こちらをクリックしますと画面上の方でモデルと表示されていて、現在はOpenAIのAPIなどを設定しておりますが、この中で使えるモデルを選ぶことができます。続いてパラメーターなんですけども、パラメーターの隣にプリセットの読み込みということで、クリエイティブ、バランス、正確ということで3種類設定することができます。これらを設定しますと、このパラメーター複数種類があるんですけども、自動的に調整されまして、例えばアイデア出しなどで自由な発想で出力してほしい場合はクリエイティブとしますと、これらの値が調整されると。またできるだけ発言がブレないように、正確に同じ内容で出してほしいという場合は正確としてあげると、それに沿ってこのパラメーターが調整されるということになっております。

***

### **LLMブロックのパラメータ解説 (15:06 - 15:52)**
このパラメーターの内容はなかなか細かいですけれど、簡単に表にしてまとめております。パラメーターがそれぞれありまして、設定範囲も0から1というものが多いですと。まずテンペラチャーとトップPというのはどちらも下げるほど固定的、上げるほど創造的というような内容で、一般的にはどちらかを変更すればいいとされております。と、プレゼンスペナルティ、フリークエンシーペナルティも同じ単語を何回も出してもいいか、できるだけ単語を変えた方がいいかというような設定になっていて、これも一般的にはどちらかを変更します。他にMax Tokensという箇所もあって、最大出力、ま、生成AIからの返答の文字数ですね。これはモデルにもよるんですけど、GPT-4o miniの場合、最大で1万6000という設定をすることもできます。返ってくる文字数がどうしても足りないという場合はこちらの出力を上げてあげてもいいのかなと。また他にも項目がありまして、文章で出力するかJSONで出力するかという形式を変えることもできますし、返ってくる文章がどうしても毎回違うというような設定になっていて、これも一般的にはどちらかを変更します。という設定もありまして、この辺も実際にチャットボットを作って思ったような返答にならないという場合に細かく調整をしていく箇所になっております。こちらがパラメーターですね。

***

### **コンテキスト、メモリ、その他の設定 (15:52 - 18:04)**
続きまして、コンテキストは外部知識になります。これはまた後ほどご紹介いたします。その下にシステムとユーザーとメッセージを追加という箇所を選びますと、アシスタントということで、この3種類の設定をすることができます。こちらもモデルによって変わってくると思いますが、GPTの場合ですね、システムとユーザーとアシスタントということで3通り設定することができます。まずシステムというのはAIに対する行動指針、どういう風に振る舞ってほしいかということで、会話開始時に一番初めに設定する内容になります。続いてユーザーはユーザーからの入力、AIに何をしてほしいかというのを伝える内容。アシスタントというのはAIからの回答内容をもし調整したい場合はこちらにも書いていくというような役割になっております。この3つの使い分けがなかなか初めは難しいと思いますので、基本的にはシステムかユーザーに全部まとめて書いておいて、思ったような挙動にならない場合は他の項目に分離してみるといいのかなというところでございます。今回はイメージがつきやすいように簡単なプロンプトを持ってきているんですけども、システムとして、ま、正確かつ迅速に回答してほしい。丁寧で親しみやすいシンプルな言葉でということで、こういった内容をシステムとして設定することができると。ユーザーの方はユーザーからの入力になります。続いてアシスタントは出力内容を調整したい場合に使うことができるんですけども、表形式で出力してということで書くこともできるかなということですね。で、こちらを試しにそれぞれ設定してあげることにします。システムの箇所にシステムですね、こちらの内容をずらっと書き換えまして、ユーザーのところはシステムメモリも最初から入っているんですけども、スラッシュ入れてシステムのクエリですね。これを入れてあげればユーザーから入力された文章がそのまま入っていきます。アシスタントの歌唱に表形式でということで会話が返ってきた際の、ま、制限というか制約をかけてあげると。もしこの3つの役割を分担して書こうとすればこういった役割分担になるというところでございます。それともう1つメモリについてもご紹介します。メモリはチャットメモリと書いてあるんですけども、会話の記憶になります。このメモリなんですけども、オフにすると会話の内容、これまでの履歴ですね、履歴を記録しないということになりまして、オンにしますと、過去何回分の会話、入力を保存しておくか、会話履歴を残しておくかという設定になります。3と設定すると過去3回分の情報、3回やり取りした内容を引き継いでいると、3回よりも古い情報は忘れていくということになって、これを増やせば増やすほど記憶も増えていくんですけども、やり取りするトークン数も増えていきます。初期設定はGPT-4o miniの場合は50ですね。このウィンドウサイズをチェックして値を調整することもできますと。最大で100回分の会話履歴を記録することもできるということですね。一旦50に戻しつつ、さらに後ほどご紹介するんですけども、次のバージョン0.7.0で会話変数という機能が追加されまして、こちらに情報を保存したり、こちらから情報を取得するということもできるようになっておりますので、またこの機能については後ほどご紹介したいと思います。ということで改めてこちらのLLMを試してみることにします。システムとアシスタントとユーザー3つの箇所を設定している状態ですね。

***

### **LLMブロックの動作確認と今後の展望 (18:10 - 18:40)**
この状態で念のため更新を押しまして、プレビューを押しまして、こちらを選びつつ、社内規定について教えてとか適当に文章を作って実行してみます。そうするとシステムユーザーアシスタントの内容も込みでということで、表形式で出てきますし、文章、口調なども しっかりとした内容になっているかなというところでございます。このLLMの特にパラメーターに関してはなかなか調整が難しいと思うんですけども、バランスでやり取りしながら、もし思ったような返答にならないという場合はこのパラメーターだったりシステムのプロンプトなどを変更していくことになると思います。他にもたくさんブロックがありますので、引き続きブロックの解説をしていきます。

***

### **条件分岐ブロックの概要 (18:45 - 20:00)**
引き続きDifyのブロックについてご紹介します。続いては条件によって処理を分岐させる、条件によって処理を分けるAパターン、Bパターンということで、処理を分けるブロックが2種類ありますので、それぞれご紹介します。IF/ELSEブロックと質問分類器ブロックという名前が付いてるんですけども、まずIFブロックは開始ブロックで変数を設定することができて、その中に選択ということでいくつかの中から1つを選ぶという方法がありましたが、それと相性がいいと思っております。チャットボットを使ってもらうユーザーにどれがいいかということで選択肢を作っておいて、選択肢に応じて処理を分けるということが簡単にできるので、開始ブロックの変数、特に選択と相性がいいと思っております。例えばなんですけども、社内規定を知りたい、製品情報を知りたいという選択肢を作っておいて、製品情報を知りたいんだったら製品情報側のルートに流すということですね。分岐させることができますし、またやりたいことということで、画像生成とデータ分析などありましたら、最初にどれをやりたいかというのを選んでもらうことで、処理のルートを分けることができます。またエンジニア向けの話なんですけども、外部APIと通信した際に通信がうまくいけば200 OKという数字が返ってくるんですが、200が返ってきてるかどうかというので、うまくいったか失敗かという分岐を分けることもできるということでとても使いやすいブロックになってます。対して質問分類器の方は入力された文章に対してLLM、チャットGPTなどが判断してどちらの方が適切かということで分岐させるブロックになっています。こちら例なんですけども、文章を読んでそれが返品に関する内容なのか、配送関連なのか、支払い関係なのかというのを文章を読み込んでそこからそれぞれのルートに分けるということで、しっかりと条件を付けて分類させるか、少し曖昧な内容でも生成AIに判断してもらって分けるかという違いがあります。

***

### **IF/ELSEブロックの詳細と条件設定 (20:00 - 20:45)**
まずIF/ELSEの方をもう少し深掘りしますけども、条件によって処理を分けると。信号機に例えることが分かりやすいかなと思うんですが、信号機青なら進む、黄色なら様子見、それ以外なら停止ということで3パターン動く要素があると思いますけども、こういった処理はIF/ELSEブロックで作ることができます。IFとELSEと、IFではないということで、さらに条件を付けるときにELIFという条件設定することもできるので、2つに限らずいくつも分岐させることができます。条件には変数を設定するんですけども、大きく文字列と数字で分けることができまして、さらに文字列の中にその文字、文字が同じかどうか、空かどうか、その文字が入ってるかどうかなどなどいくつか条件がありますと。数値の方は大なり小なり、イコールとかノットイコールなど、数字によって、例えば年齢だったり、200 OKかどうかとかですね、数字と条件を組み合わせることができますと。またAND条件、OR条件ということで、例えば文字列に含んでいて、さらに数字が20歳以上とかですね、複数の条件を組み合わせるということもできますと。ま、できてこちらはもうチャットボットの使い方次第になるとは思いますが、今回は簡単な例を作ってみたいと思います。

***

### **IF/ELSEブロックの実践的な使い方 (20:51 - 22:56)**
IF/ELSEブロックについてDifyの画面で実際に操作していきます。まずは開始ブロックを選んだ状態からスタートしたいんですけども、入力フィールドということで、チャット開始時に選ぶとか入力する項目を追加することができますと。で、今回は練習も兼ねて2つのパターンでご紹介いたします。まず選択の方、こちらは選択肢を選ぶんですけども、文字列としてIF/ELSEブロックで設定することができるようになります。今回は分かりやすいように画像生成するかどうかという選択肢を作ることにします。まず変数名なんですけども、こちらは英語か数字で書く必要がありますので、今回はcreateimageとしておくことにします。ラベル名はユーザー側に見える場所になりますので、画像生成という名前にしておくことにします。オプションが選択肢なんですけども、画像生成するかしないかということですね。するかしないということで、もちろん英語で書いてもいいんですが、そのまま日本語で書いておくことにします。こちらは必須にしておいて、一旦保存ということで、このcreateimageの変数を作ります。もう1つ数値の変数も作っておきます。こちらは練習用なんですけども、変数名を例えばAGEとしておいて、年齢ということで書いておくことにします。LSの選択内容を確認するために数値で作ります。で、createimageとAGE2つの変数ができましたら、続いてIF/ELSEブロックを挟んでいきます。開始ブロックから線が伸びてますけども、先にカーソルを合わせるとプラスボタンが表示されるのでこちらをクリックして追加したいブロックを選ぶことができると。今回はIFブロックを使うことにします。で、IF/ELSEブロック選びますと、画面の右の方で設定項目が色々あるんですけども、IFで条件を追加する。またIFということで、IFではないけども、次の条件、もし設定することもできますと。一旦削除しておきます。で、IF文の条件を追加ということでこちらのボタンを押しますと、この先で繋がっている上流と呼んだりしますけども、線で繋がっているブロックで設定した変数が表示されます。で、先ほどAGEを数値として作っていましたので、この英字は文字ではなくてナンバーと書かれていて、ナンバーが数字という意味になりますと。まずはこの英字を選びますと右の方にイコールとなっているんですけども、こちらの矢印を押しますと、イコールなのか、ノットイコールなのか、大なり小なりということでいくつかの条件を設定することができると。例えばイコールとしておいて、このコンスタントというのは定数、決まった数なんですけども、例えば20とか設定しておくと、この入力した数字が20だったらと、20と同じだったらという意味になります。さらに条件を追加することもできまして、もう一度エッジを押しますと、この左側の方でANDというマークが付いておりまして、クリックすると、ANDかORかということで表示が切り替わって、この真ん中のブロックの中でもANDはかつ、ORはまたはということで、2つの条件を組み合わせて判定するか、片方の条件が合っていたらということで判定を切り替えることができます。今回は数字に関してはこの表示の確認だけでしたので一旦消しますけども、このAND、OR条件なども組み合わせるとより複雑な条件も作ることができます。

***

### **IF/ELSEブロックと画像生成ツールの連携 (22:56 - 25:15)**
一旦削除しまして、改めてIF文の条件追加していきます。次はcreateimageですね。画像を作るかどうかということで、こちらは文字列、ストリングは文字という意味です。で、右側の含むという箇所をクリックするとこの文字かどうかというので選ぶことができますので、今回はであると、文字とぴったり同じかどうかという判定で書いていくことにします。このcreateimageの設定内容を改めて確認しておきますと、するかしないという文字が返ってきますので、するだったら画像を作るとするという文字だったらIF文の後のルートに行くと、そうじゃなかったら、するではなかったらエルスの方に行くということになります。画像生成するかどうかということなので、先に画像生成しないパターンで見ていきますと、このIF/ELSEのヘルスそれぞれプラスのボタンがありますので、LSの方ですね。画像生成しない方をLLMと繋げてあげることにします。画像生成しないが選ばれていたらチャットでやり取りすると画像は作らないということですね。続いてIFの方、画像を作るんであればということで、実際に画像を作れるようにしたいので、改めて右クリックのブロックを追加でいいかなと思うんですけども、ツールの中の少し下の方に下がっていくとDALL-E3という画像生成のツールがありますので、こちらを一旦置いてあげます。こちら置きましたら画面の右上のチェックリストが付いてますけども、このステップは何も接続されていません。DALL-E3プロンプト必須ですということで書かれているので、この辺りをクリアする必要がありますと。まずは線を引きますので、IFからDALL-E3にビヨーンと伸ばして線を繋いであげます。続いてDALL-E3のブロックを見ますと、入力変数ということで、プロンプトストリングはリクワイアードは必須という意味なんですけども、文字を入れないと動かないということですね。で、この文字というのは開始ブロックでチャットの初めにユーザーが入力した文章になりますので、スラッシュを入れて、sys.queryですね。これが実際にユーザーが入力した文字になるので、指示クエリを入れてあげればOKです。他にもいくつか設定項目はありますけども、今回はそのまま進めることにします。このDALL-E3からも出力の変数がありますので、こちらも確認しておくと、テキスト、ファイル、JSONとあって、ツールが生成したファイルということで、今回は画像を作るのでファイルの方も入れてあげる必要があります。というのも確認しつつ、DALL-E3さらに画面上でチャットの回答として表示したいので回答ブロックをつなげます。で、回答2となってますが、ここは自由に変更することができるので、画像生成時の回答とかですね、名前を変えることもできますと。で、この回答ですね。画面上に出てくる内容でスラッシュを付けますと、これまでの上流の変数を選ぶことができると。DALL-E3が画像なんですけども、テキストを選んであげると作った画像の説明などが表示されます。で、もう1つ、実際の肝心の画像も表示させたいのでファイルですね。ファイルの方も2つ回答の中に入れてあげればいいのかなというところでございます。ということで、一旦左から見ていきますと、まず開始ブロックがあって、クリエイトイメージが選択項目になっている。で、IF/ELSEでその選択項目がどちらかということで分岐させると。画像を作らないんであれば、GPT-4o miniの方でチャットをやり取りする。画像を作るのであればDALL-E3経由して画像を作りますというようなルートを作ることができているというのが分かると思います。

***

### **作成したチャットフローの動作確認 (25:15 - 26:13)**
実際に確認する場合は念のため更新しつつアプリ実行でもいいと思いますけども、こちらでいきますかね。アプリ実行しますと、まず画像生成の箇所ですね。こちらで画像生成するかしないかというので判定することができるので、今回はまずはするとしておきます。相談相手は必須になってたので、ここは選びつつ年齢は入れなくてもOK、必須ではないので入れなくてもOKです。で、画像生成なので作りたい画像なんですけども、例えば生成AIをイメージして画像を作ってと適当に文章を書きますと、このワーキングプロセスの中でですね、開始ブロックの後にDALL-E3が走っていると。ここで画像を作ってくれてるはずなので、画像を作りましたら、と、今回は文章が表示されなかったんですけども、文章も表示されるはずなんですが、画像を作ることができているということになります。続いてもう一度ニューチャットの方ですね。画像生成しないの方で選びます。相談相手は必須になってましたので、これでスタートします。で、改めてAIの画像を作ってと書いてみるんですけども、今回はDALL-E3通らないので申し訳ありませんが画像は作れません。ということで書かれております。チャットで会話開始する際に選択項目を作っておくことで、どっちを選択した方で、この条件を分ける側としても分かりやすいですし、それぞれで別の外部知識を読み込ませるとか、別のプロンプトを使いたい時にはとても便利なブロックですので、ぜひ実際に試してみてください。

***

### **条件分岐ブロックの概要 (0:00 - 0:19)**
前回はIF/ELSEブロックを解説しましたので、今回は質問分類器というブロックの解説になります。こちらはしっかりと条件をつけるわけではなくて、入力された文章に対してAIが判断して分岐するというような仕組みになっています。はっきりした条件付けをするのが難しい際に使えるブロックになっております。

***

### **質問分類器ブロックの詳細 (0:19 - 0:56)**
質問分類器ブロックということで、条件ですね、条件分岐をLLMにしてもらいます。こちらはLLM、生成AIに判断してもらうのでモデルの指定が必要になります。GPT-4o miniなどでモデルを指定して、入力された文章に対してどういう風に分けるかというのを判断してもらいます。また、ブロックの中にクラスという箇所がありまして、こちらに分岐する条件を書いていくことになります。今回は例として、社内規定に関する質問か、製品情報に関する質問か、それ以外の質問、上記以外の質問ということで、処理を3つに分けるということで作っていくことにします。それぞれLLMを通して回答すると、実際は外部文章なども読み込ませてから回答するんですけども、まずはLLMにつないで回答してみることにします。また、社内規定と製品情報とは全く関係ない問題、この2つに当てはまらないものは別でLLMは通さずに返答してもらおうということで3パターンに分けて処理を作っていくことにします。

***

### **質問分類器ブロックの実装 (0:56 - 1:21)**
実際にDifyの画面で解説していきますと、こちらは前回IF/ELSEブロックをつけて処理を分岐させている画像生成するかしないかというところで処理を分岐させてるんですけども、画像生成しないパターンの場合にさらに質問分類器をかませて3つのパターンで処理をしてみるということをやってみることにします。画像生成はしないの方で、また線の上の方にカーソルを合わせてプラスボタンを押します。質問の理解という箇所に質問分類器というブロックがありますので、こちらを付けてあげることにします。こういう状態ですね。で、質問分類器のブロックを選びますと画面の右側に設定項目が出てくるんですけども、入力変数というのが上流から入ってくる情報になって、sys.queryは会話開始ですね。ユーザーが入力した文章になります。

***

### **クラス設定とモデル選択 (1:21 - 2:42)**
そのまま置いておいて、続いてモデルですね。モデルはGPT-4o miniでもできますし、他のモデルを選ぶこともできますが、今回はGPT-4o miniのまま選択しておくことにします。で、その下にクラスという箇所で、クラス1にもう一つ、今回3つ作ろうと思っているので暮らす条件を書けることができます。で、今回は社内規定に関する質問だったらこちらの処理に進むと。製品情報に関する質問であれば2つ目の処理に流すと。上記以外の質問であれば3つ目の処理に流すということです。3パターンの分岐を作ってあげることにします。そうすると、ブロックの方でもプラスのボタンが3つありますので、それぞれ線をブロックにつなげていくことになります。で、まず社内規定の箇所をこれまで持ってきていたLLMの箇所と紐付けてこの流れで進めることにします。少し分かりやすくしたいので、このブロックの名前もですね、LLMのままでもいいんですが今回は社内規定という風に変更することにします。ブロックの名前を変えまして、回答の方もちょっと分かりやすくするために社内規定に関する回答ですという風にすぐに変えておくと、1つ目のルートですね。続いて2つ目、製品情報に関する箇所も作っていきたいので、このブロックと全く同じなので複製を選んであげると、同じようなブロックが作ることができます。で、2つ目の製品情報のプラスボタンからニョキっと伸ばしまして、こちらですね。こちらもブロックの名前を変えた方が分かりやすいかなと思いまして、製品情報というブロックの名前にしておくことにします。で、こちらもLLMからの返答を画面に表示したいということで、回答ブロックを付けて分かりやすいように製品情報に関する回答ですという風に書いておきます。で、スラッシュで変数を設定することができますけども、上流ですね。このブロックがつながっている上流。今回は製品情報ブロックの中のテキストになりますので、こちらを付けてあげればOKです。で、長期以外の質問というクラスもありますので、こちらはもうそのままLLM通さないで回答としておきます。こちらは該当なしというブロックの名前にしておいて、申し訳ありませんが、その質問にはお答えできませんといったような文章を作っておきます。

***

### **フローの全体像と動作確認 (2:42 - 4:14)**
こちらももう1度上から確認しますと、まず開始のブロックがあって、画像生成するかどうかですね。で、増える数で分岐が変わりますので、画像生成しない場合に続いて質問分類気に入って、この3パターンに分けると3つのパターンでルートを作りましたので、実際に試してみることにします。念のため更新をしまして、アプリを実行から確認していくことにします。まず、画像生成するかしないかの選択がありますので、今回はしないとしておきます。相談1は必須で設定してたので、年齢はオプションなのでなしですね。これでスタートとしておきます。で、例えば冷蔵庫の使い方を教えてという文章をしたとしますと、これは文章的に製品情報ではなかろうかということで、生成AIが判断してくれます。製品情報に関する回答ですということで書かれて、ワークフローのプロセスの方を確認しますと、製品情報、LLMを通して回答が返ってきているというのが分かります。また全く関係ない会話をされた時の対応も確認しておくことにします。画像生成はしない、相談相手を選んでスタートします。例えば、今日の天気を教えてとかですね。全く関係ない会話をしたとしますと、そうすると、申し訳ありませんがその質問には答えられないということで、ワークフローを確認しますと、質問分類入った後に該当なしとなっているのが分かると思います。先ほど作ったフローでいきますと、ELSEの方に流れて、で、こちらのブロックに流れているというのが分かります。条件をしっかりつければIFの方がはっきりと分けることができますし、内容によって切り替えたい場合はとても便利なブロックですので、IFと合わせてこちらの質問分類のブロックもぜひ試してみてください。

***

### **変数集約器ブロックの解説 (4:19 - 5:13)**
続いて変数集約器というブロックがありますので、こちらをご紹介いたします。集約と書いているとおり、処理を分岐した後にそれらをまとめるといった役割のブロックになっています。IF/ELSEブロックか質問分類器で処理を複数に分岐させますと、分岐させた後、それぞれの変数が分かれることになりますので、例えば前の動画で質問分類器で作った内容ですと、社内規定用のLLMが走ってその回答を返すというのと、製品情報を聞いてその返答を返すということで、2通りの流れがあったと思うんですけども、この2つの場合はそんなに影響ないんですけども、例えばこれが5個とか10個とか、たくさん分岐していきますと、毎回この回答というブロックも5個なり10個なり、複数分かれてしまいますし、そのメンテナンスも大変になりますので、分岐している変数をまとめることで、同じようなフローをまとめてすっきりと管理することができます。LLMしている変数をまとめることで、同じようなフローをまとめてすっきりと管理することができます。回答が複数ですね。今回は2つなんですけども、5でも10でも一旦この変数集約キーを使って処理をまとめると。で、LLMの場合は出力変数としてテキストが返ってきますので、それを全てまとめてこの変数集約器を使うとアウトプットという変数になりますので、それを元に回答につなげてあげると。回答ブロックとしては一つで済むということで、こちらも実際に試してみることにします。

***

### **変数集約器ブロックの実装 (5:13 - 7:28)**
実際にDifyの画面を使って解説していきますと、これは前回の質問分類器から3つのパターンに分けている状態ですね。回答ブロックが3つあるんですけども、まずはこの社内規定、製品情報のブロックを見ていきますと、どちらもLLMを使って文章を作成するんですけども、出力変数ということで、テキストの方がSTRINGなので文字列ということで、これが出てきますと。の方も同じく下の方に下がりますと、出力変数TEXT、STRINGですね。それを回答ブロックで指定して表示させている状態です。で、この回答ブロックを一つにまとめたいと思いますので、集約のブロックを作っていきます。社内規定のブロックの先の方にカーソルを合わせてプラスのボタンを押しますので、今回は変換という箇所の中の変数集約キーというブロックがありますので、こちらのブロックを使うことにします。そうすると、これが変数集約キーで、右の方に設定項目がありますと。で、変数を代入ということで、どの変数をまとめるんですかというのを選んでいくことになります。線がつながっている上流の変数を指定することができますので、こちらのプラスボタンからいきますかね。プラスボタンからいきますと、社内規定のテキストですね。LLMに聞いて返ってきた回答になりますので、こちらの変数をまず一つ指定します。それともう一つ、製品情報の方からもこちらすでに線が引かれているんですけども、製品情報の端っこから改めて線を引き直すことができますので、ピニオンと変数集約の方にくっつけてあげます。そうすると、これも最近表示されるようになったんですけども、製品情報ブロックのテキスト変数ですね。こちらを選ぶことで、2つの変数ですね、2つのブロックを一つにまとめるということができているのが分かります。社内規定と製品情報、それぞれテキスト、STRING型ですね。ということで一つにまとめます。で、まとめましたら回答ブロック少し修正しますけども、こちらにスラッシュを入れてあげると上流の変数が選ぶことができます。で、下に下がりますと変数集約キーの中にアウトプットというものがありますので、こちらを書いてあげると2つですね。一旦処理は分かれるんですけども、それらを集約して回答ブロックも一つとしてすっきりと作成することができるという状態です。回答ブロックすっきりしましたので、下の方の回答は不要になりますので、こちらのチェックリストも消えている状態になります。また、この変数集約キーはグループという機能もありまして、今回は複数の変数を一つのアウトプットにしたんですけども、グループを分けて、別のグループとしてまたさらに処理が多い場合にはこれを使って別のグループとして集約することもできます。今回はこちらは使わないでいいかなと思うんですけども、こうしてあげると、頭から見ていきますと、開始ブロックがあってIF文で画像生成しない場合に質問分類になって、製品情報、社内規定は一旦一旦分かれるけども、集約がかかって回答ブロックとしては一つで済んでいると、しない場合に質問分類になって、製品情報、社内規定は一旦分かれるけども、集約がかかって回答ブロックとしては一つで済んでいると。IF文や質問分類器を使って処理が複数になった場合に、この回答がどんどん増えてしまいがちなので、まとめるところはこの変数集約型のブロックも使ってあげるとすっきりできますので、もしその内容なども修正したい場合も一つだけ修正すれば済むということになりますので、複雑なフローになってきたら、この変数集約型のブロックもぜひ試してみてください。

***

### **変数代入ブロックと会話変数の概要 (7:32 - 8:46)**
Difyバージョン0.7.0で追加されました変数代入ブロックについて解説をします。この変数代入ブロックは合わせて画面の上部にある会話変数という機能も組み合わせて使うことになりますので、まずはこの会話変数から確認します。こちらも実際のバージョン0.7.0で追加されております。LLMで設定できるメモリとは別で、会話でやり取りしている内容を記憶することができるという変数になっております。で、使う際には、まず初めにこの会話変数を最初に登録しておく必要があります。設定する型ということで、文字なのか数字なのか、オブジェクトというのはキーとバリューという設定の方式になっていて、どちらかというとプログラムで扱える方向けなんですけども、これらの種類がありますと。で、さらに文字列であれば文字を複数、数値なら数値を複数、オブジェクトならオブジェクトを複数ということで配列形式で設定することもできて、少し難しい内容になるかなと思いますが、今回は一つの文字を入れるという想定で試してみることにします。また、デフォルト値、初期値も設定可能になります。こちらで一つ体でこの会話変数を作りまして、変数代入ブロックですね。先ほど作った変数の設定した変数の上書き、中身を上書きしたり、追加、クリアができるようになっています。で、こちら例として開始ブロックに選択としてプロダクトタイプというものを追加しつつ、変数代入ブロックで上書きして、先ほどの会話変数の内容を上書きしてからLLMに組み込んでみようかというサンプルを実際に試していきます。この機能はまだ追加されてから1週間も経ってないという状態で、なかなかまだ使用事例が上がってきてないんですけども、実際はプログラミングも組み合わせて使う機会が増えるんではなかろうかと思っております。というところで、実際にどういうものかというのをDifyの画面でも確認していくことにします。

***

### **会話変数の設定方法 (8:46 - 10:05)**
こちらが実際の画面で、前回は変数集約をしたところになっています。Difyの画面の上の方に行きますと、会話変数というものと環境変数というのが2種類変数のタイプがあります。で、環境変数の方は他の人には見せたくない情報などを設定する方ですね。で、今回扱うのは会話変数になりまして、こちらに簡単な解説あるんですけども、LLMが記憶すべき情報を保存するために使うということになっています。で、下の方に「+変数を追加」というボタンがありますので、まずは こちらのボタンを押します。で、変数の名前なんですけども、こちらは英語か数字ですね。今回は製品情報ということで、プロダクトという名前にすることにします。タイプが先ほどもお伝えした通り、文字か数字かオブジェクトということで、もしオブジェクトを選ぶとですね、キーとタイプとバリューですね、値を入力していく形になるんですけども、またアレイというのが配列なんですけども、もし配列で扱う場合にはこのデフォルト値の値を入力していく形になるんですけども、どちらかというとプログラムを書くところですね。今回は一番分かりやすいと思いますので、STRING、文字列で設定します。デフォルト値は初期値なんですけども、今回は空っぽでそのまま保存としておくことにします。これで会話変数でプロダクトというものの中に文字が入ってくると、今のところ空になっているという変数を作ることができました。続いて、この変数の中身を設定したいんですけども、今回は分かりやすいかなと思いますので、開始ブロックにもう一つ入力フィールドを追加することにします。こちらでプラスを押しまして選択を選びますと、変数名は何でもいいんですけども、プロダクトのタイプという名前にしておくことにします。製品の種類ということで、いくつか選択項目作れますので、今回は冷蔵庫とか洗濯機などですね。中身は何でもいいんですけども、こういった情報を選択するということで設定しておくことにします。

***

### **変数代入ブロックの実装 (10:05 - 11:35)**
一旦解除しまして、で、このフローを見ますと、まずIF ELSEで画像を作るかどうかという設定をしてましたので、画像は作らない方にします。で、質問分類があって、製品情報に関する質問というのがありますので、こっちに渡ってきた時に先ほどの会話変数を設定しようかなと思います。少しスペースを空けつつ2つ目ですね。製品情報に関する質問が来たらこちらのフローに流れてきますけども、ここでプラスのボタンを押しまして、変換の中の変数代入というブロックがありますと。で、こちらを押しますと、この変数代入ブロックを間に追加することができます。で、画面の右側に代入された変数ということで書かれているんですけども、こちらをクリックすると画面の上の方で会話変数を設定しましたけども、会話変数の中のどれかを選ぶことができます。今回はプロダクトしかないので、プロダクトを選ぶと。で、書き込みモードが上書きするか配列の場合追記ということができますけども、今回はそのまま上書き、空の配列に文字を入れるということになります。で、この入れる文字はということで変数設定とありますので、クリックしますと、また上流の変数のどれかということが選ぶことができて、今回は開始ブロックのプロダクトタイプですね。先ほど作った文字、冷蔵庫なり洗濯機なりの文字を会話変数の中に入れるんだということで作ってあげることにします。これが変数代入ブロックですね。これで会話変数の中身が冷蔵庫か洗濯機どちらかが入っている状態になるはずなので、そのあとで製品情報のLLMですね。こちらをクリックするとシステムということでプロンプトがざっと書いてますけども、こちらをクリックするとシステムというところでプロンプトがざっと書いてありますけども、先ほどの変数ということでスラッシュを押しますと、これまでの変数が選ぶことができるんですけども、画面の下の方に行くとカンバセーション、会話ですね。会話変数の中のプロダクトというのも選ぶことができるようになっています。実質このプロダクトタイプと同じにはなるんですが、今回は会話変数の練習ということで、こちらを選んであげますと、製品はプロダクトなので、製品が冷蔵庫か洗濯機ということですね。ということで、会話変数を実際にLLMのシステムのプロンプトに設定してあげることにします。

***

### **動作確認と応用 (11:35 - 12:28)**
この状態で更新して、アプリを実行として新しいチャットで始めていきます。そうすると製品の種類というので、冷蔵庫、洗濯機増えてますので、冷蔵庫にしますかね。で、画像生成はしないでおく必要があって、相談相手も必須にしてましたので、こういう設定にします。で、スタートしまして、製品の使い方を教えてとしますかね。特に冷蔵庫、洗濯機というのは書いていない状態ですね。書いていない状態ですけども、会話変数の中に保存されて、LLMを通して聞いてくれるはずなので、冷蔵庫の使い方についてということで、ざーっと表示がされているのが分かると思います。今回はかなりシンプルな例にしたんですけど、使い方としては、まず最初に会話変数を設定しておいて、空っぽなりデフォルト初期値なりを設定しておくと。設定して、変数代入ブロックでその情報を上書きするなど、使い方になるかなと思います。実際にはプログラミングなども入ってくると思いますけども、このLLMの中にメモリ、ウィンドウサイズというものがあって、会話の履歴を残したりもしますけども、それとは別にずっと記憶を残したいという場合に会話変数という機能もありますので、こういう機能もあるということを知っておいていただければ幸いです。

***

### **エンジニア向けブロックの紹介 (12:33 - 13:33)**
実際のチャットフローで扱えるブロックのうち、一般向けの解説を終わりましたので、続いてはエンジニア向けということで、いくつかまとめて簡単にご紹介いたします。エンジニア向けブロックはその1、その2ということで合わせて5つに分けているんですけども、まずは初めに3つのブロックをまとめてご紹介いたします。こちらは参考テンプレートがありましたので、後ほどこの参考テンプレートも扱いながら、どういう動きになっているかというのを確認していくことにします。参考テンプレートWebコンテンツサーチ＆サマライゼーション。※試す場合はTavily Search、Jina ReaderのAPI Key登録が必要とありますが、このAPI Keyについては後ほど確認しますけども、興味ある方はこちらも登録していただければと思います。まず1つ目はコードブロックなんですけども、こちらはPythonかJavaScriptでもプログラミングですね。プログラミングを書けるようなブロックになっています。で、出力形式を選ぶことができる、出力の変数を 選ぶことができるんですけども、こちらに文字や数字はもちろん、配列複数の情報だったり、オブジェクト、キーとバリューなども自由に選ぶことができます。また、コードブロックの中に高度な依存関係という場所もあったりして、こちらはライブラリ、例えばリクエストというライブラリを使うとインターネット通信した結果を取得できたりするんですけども、こういったライブラリを設定することもできます。ここは少し制限がかかっているので、何でもかんでもライブラリを追加できるというわけではないですが、代表的なところでリクエストなどを使うというところです。続いてイテレーション、これは繰り返しというような意味なんですけども、入力する変数で配列を受け取る必要がありますので、事前に配列を作っておく必要があります。こちらで配列を作る必要があるんですけども、コードなども組み合わせて扱うということで、エンジニア向けとしてまとめております。出力の選択もできます。もう一つテンプレートというブロックがありまして、こちらは上流の変数をまとめることができるブロックになります。また後ほど確認しますけども、ブロックで繋がって上から下までこう流れていきますけども、それらの変数をまとめて表示するということができます。また、こちらは神社というテンプレートを使うことができて、こちらで少しプログラミングのような書き方になるんですけども、繰り返しなども書くことができます。この神社は別でマニュアルがありますので、簡単に確認しておきますと、全て英語のマニュアルになっているんですが、このマニュアルの中で、例えばテンプレートデザイナー、ドキュメンテーションというリストオブコントロールストラクチャーですね。複数の情報を書こうと思ったら、こういう書き方ができると。このエディターの中で構文などを使って繰り返しの表現ができるというような機能になっていて、ここもどちらかというとプログラム寄りかなと思いましたので、エンジニア向けとして紹介しております。

***

### **参考テンプレートの解説 (13:33 - 15:19)**
かなりと思いましたので、エンジニア向けとして紹介しております。この3つのブロックをまとめて扱っているテンプレートがありますので、そちらを確認して内容を見ていくことにします。で、このテンプレートなんですけども、ツールも使っていまして、このIDサーチ、Jina Readerというツールも使っていて、もし実際に試したい場合は、それぞれのAPIキーの登録が必要だと思われますが、興味ある方はこちらも登録していただければと思います。ということで、実際に確認していきます。こちらがDifyの画面です。で、画面の上の方に探索というリンクがありまして、こちらをクリックするとDify側で用意しているテンプレートを見ることができます。で、画面の上の方に探索というリンクがありまして、こちらをクリックするとDify側で用意しているテンプレートを見ることができます。このおすすめの中にざーっと探していくと、こちらのWebコンテンツサマライズというワークフローがありますと。ちょっとちゃんと書いているワークフローが2つあるんで、ちょっとややこしいんですが、右側の方でワークフローWebコンテンツサーチアンドサマライゼーションとありました。で、このワークスペースに追加すると実際に作成することができるんですけども、今回はすでに作成したものをありますので、こちらでご紹介していきます。少しアップもしつつ、少し長い内容になってるんですけども、まず開始ブロックがあります。で、タビサーチというところで、これはツールなんですけども、Google検索みたいなもので情報を検索しますと。で、少し下がりますと、今回は3件ですね。3件分検索するという設定をしております。で、そのあとコードですね。こちらがコードブロックになってるんですけども、入ってくる変数を選び、Pythonでコードを書いていて、このコードに関しては今回細かく扱わないんですけども、もし興味ある方はチャットGPTなども駆使して内容を確認いただくといかなと思います。出ていく方も変数のタイプを選ぶことができて、アレイとすると配列になります。配列で複数のブロックに渡すということができます。渡しましたら、続いてイテレーションというのが繰り返しのブロックになります。繰り返しのブロックで入ってくる変数を配列、アレイ形式で渡す必要があります。また、出ていく数も基本的には複数になると思いますので、アレイで出すことが多いかなというところです。このイテレーションブロックは少し特殊で、このブロックの中のさらにブロックを繋げることができるんですね。今回の場合ですと、Jina Readerというのを使って記事の内容を確認しつつ、LLMで内容を要約ですね。サマライズは要約してるので要約しています。ここのモデルもGPT4になっていたのでminiに変えています。コストを下げたいということでminiに変えております。LLM繋ぎましたら、そのあとでこちらはテンプレートですね。テンプレートを使っていて、テンプレートはこれまで繋がっている上流のブロックの変数をいくつも設定することができますので、2つ入ってきてそれを表示させているというような流れになっています。これを3回であれば3回繰り返すというような流れになっています。3回繰り返しましたら、さらにこちらもコードブロックになってるんですけども、入ってきた配列の情報をコードで切り分けていると。このブロックの名前がスプリットURLテキストサマリなんで、URLとテキストを分割していると思われます。で、出力でアレイとして返していると。で、さらにこちらはテンプレートまだ使ってるんですけども、この縦棒のパイプだったり、表形式だったり、for文だったり、変数の書き方などは本当にプログラミングの書き方なので、今回はあまり扱わないんですけども、複数の情報を表形式で表示させるような指示になっています。そこまで設定して最後にもう一度エンドブロックですね。今回はこれワークフローになってますので回答ではなくて終了ブロックという事になります。で、実際もっと実行される場合は、このJina Readerとタビサーチですかね。こちらのAPIの登録が必要になるんですが、ここでは既に登録済みのみになるということにしてあります。

***

### **参考テンプレートの動作確認とエンジニア向けブロックの所感 (15:19 - 17:39)**
実際に、このリサーチなどが英語圏のサービスになっているので、基本的には英語で返ってくると思われるんですけども、実際に試してみることにします。例えば、社内用のチャットボットのアイデアを出してと日本語で入力しますが、返答は英語で返ってくると思われます。実行しますと、詳細トレースですかね。トレースできますと、このたどっているブロックを見ることができて、今はコードが実行されているという内容になっています。そのあとにイテレーションで、今回は3件情報を取得しているはずなので、3回分繰り返していると思われます。このイテレーションブロックもクリックすると、3イテレーションとなっていますね。こちらをクリックすると、1回目、2回目ということで、その先の進捗、どこまで進んでるかというのを確認することができます。2回目の処理が終わって、その後で精査、こちらはコードですね。Pythonが動いてるはずですと。で、その後にリザルト、表形式にして終了ですね。で、結果の方を見ますと、表形式で英語で返ってきてるんですけども、URLと記事の要約ですね。それが1件、2件、3件出ているということになります。エンジニア向けのブロックということで、どうしてもプログラムが入ってくるのが少し敷居が高いというか、またこのエンジニア向けの解説は別途やりたいなとは思っておりますが、周辺の知識もつけると、こういった処理も実行できるということで、サンプルのご紹介にさせていただきます。

***

### **エンジニア向けブロックその2の概要 (17:44 - 18:29)**
エンジニア向けブロックその2ということで、パラメータ抽出ブロックとHTTPリクエストブロックについてご紹介いたします。こちらは良いサンプルのテンプレートが無かったので、簡単なものをこちらで用意しましたので、後ほどご紹介します。説明の都合上、まず先にこのHTTPリクエストの方からご紹介したいんですけども、こちらは外部APIに接続して情報を取得するというブロックです。外部APIというのは、例えば楽天API、郵便番号API、天気予報APIなど、Difyのツールとしては用意されていないけれど、APIとして外部に情報を提供しているというサービスはたくさんありますので、それらと連携して情報を取得するという機能になっております。で、ブロックの中を見ていただくと、ヘッダー、パラメータ、ボディなどを指定することができるんですけども、この外部APIにつないで情報を取得すると、返答応答がJSON形式で返ってくることが多いので、コードのブロックを使って整形した方が本当は見やすいので、こちらもエンジニア向けのブロックとしております。簡単なサンプルがあった方が分かりやすいかなと思いましたので、今回は天気予報APIを使ってその動きを確認してみることにします。

***

### **天気予報APIの解説 (18:29 - 20:41)**
こちらは無料で登録なしで使えるAPIになっていて、こちらのリンクをクリックいただくと天気予報livedoor天気互換ということができます。下の方に行きますと簡単な使い方があるんですけども、こちらがURLですね。ベースのURLがありますと。で、このURLの後ろの方に、こちらなんですけども、フォーキャストまでがベースのURLになるんですけども、その後にハテナをつけて、CITY=400040のようなパラメータをURLの後ろにくっつけるということができるようになります。これでパラメータを付けた状態で天気予報に通信するということがですね。また、出力変数を見ておきますと、ボディだったりステータスコードという情報を出力していて、通信がうまくいったかどうかというのをこのステータスコードの方で判断します。なので、IF/ELSEのブロックを付けています。こちらでステータスコードが200かどうかということで判定をかませて、もし200ではないものが入ってきたら通信にエラーが発生しましたということで、こちらで処理を止めますと。で、ステータスコード200の場合は情報が返ってくるんですけども、そちらはJSONという形式で返ってきます。そのままだと少し読みづらいので、こちらはツールになるんですけども、ブロックを追加のツールの中のJSONのまたいくつか種類がありますが、こちらのJSON PARSEというのが抽出関係のブロックになりまして、一旦こちらを挟んでおります。入力変数が天気予報で通信してきた内容で、これはJSON形式になっているJSONフィルターというのでどの情報を取りますかということで、こちらもAPIの仕様によって変わるんですけども、返答の中のディスクリプションの中の、さらにボディテキストというところで天気予報の本文の情報が取れるということですので、こちらのディスクリプション.ボディテキストを指定しているというような書き方になっています。そのまま特に変換などなくていいということで、こちらはFALSEにしてます。FALSEにしつつ、こちらの出力としてまたテキストなどがありますので、最後に回答ブロックをつけて、このJSON PARSEで出力された変数を指定しているという作りをしております。

***

### **パラメータ抽出とHTTPリクエストのデモ (20:41 - 22:28)**
で、実際に試してみたいんですけども、天気予報のIDの情報が必要なので、今回は東京の場合130010になるので、こちらの番号を入れておきましてプレビューで試してみることにします。下記IDの今日の天気を教えてということでSHIFTしながらENTERと改行することができるんですけども、IDの情報も含めてチャットを開始します。そうすると、パラメータ抽出もしてくれて、この130010に合わせて情報を取得して、返ってきたJSONから必要な情報を抽出というこれで実行しますと、ざーっと返ってきまして、関東甲信地方は高気圧に覆われて返事がきているというような作りになっております。この外部APIを使う場合はですね、外部APIの仕様次第で、このURLのパラメータだったり、ボディだったり、JSONの抽出する場所だったりが変わってくるので、なかなか解説も難しいと思ってはおりますが、今回は一般向けということでこの辺までの解説にとどめたいと思います。また機会があればエンジニア向けということで、もっと深掘りしていきたいと思います。ということで、この講座としてはここまででの解説とさせていただきます。

***

### **ツール機能のまとめ (22:33 - 23:13)**
前回までの解説でチャットフローの中で右クリック、ブロックを追加としまして、ブロックの方ですね。ブロックの方の解説をざーっととしてきましたので、続いてもう一つのツールという選択肢がありますので、こちらを確認していきます。このツールについては、これまでもいくつか使ってきたんですけども、選択肢として全てと組み込みとカスタムとワークフローということで4つフィルターをかけることができます。全てとすると全ての情報を見ることができます。これまで解説で扱ってきたのざーっといきますと、画像生成のDALL-Eさんですね。あと、検索で認証がいらないDuckDuckGoサーチというものもあたりしますし、下の方に行きますとGoogle、こちらAPIキー登録いるんですけども、Googleの検索も使えたりします。翻訳の機能もあったりしますし、Jina Readerとかですね、他の機能もあったりしますと。また、このツールなんですけども、Dify側で用意しているものとは別で、カスタムということで自分で作ることもできます。こちら画面だけ確認しておきますと、Difyの画面の上の方にスタジオ探索などありますが、一番右の方にツールという選択肢がありまして、こちらをクリックすると先ほどのGoogleだったりBingなどが表示されておりますと。で、さらに左上の方に選択肢がありまして、組み込みとカスタムとワークフローというものがありますと。で、カスタムの方を押しますと、自分でツールを作ることができると。で、カスタムツール作成という箇所をクリックしますと、名前とスキーマというところで書かれてありまして、こちらもまあプログラム寄りになるんですけども、このスキーマというのを書いてあげると、自分でツールを作ることができますと。

***

### **カスタムツールとワークフローの活用 (23:13 - 24:32)**
画面の右の方に例ということでいくつか選択肢がありまして、例えば天気をクリックすると、このスキーマが自動設定されて、これをなかなか最初から作るのは難しいかなと思うんですけども、こういった情報を書いてあげることで、自分で自由にツールを作ることができます。これが先ほどの天気ツールですね。自分で作りましたら、スタジオの方に戻りまして、右クリック、ブロック、ツールということで、カスタムで先ほどのゲットカレントウェザーということですね。自分で作ったツールということですね。こちらも入力変数、出力変数ありますけども、先ほどのスキーマでカスタマイズができるというところで、それとワークフローもこのツールとして取り込むことができます。今作ってはないんですけども、ワークフローを読み込むということも機能としてあります。どうしても複雑にはなってくるんですけども、こういった選択肢もあるということですね。今回の講座としてはDALL-Eさんで画像生成をしましたので、こちらを改めて確認しますと、入力の変数があり、設定項目がもちろんツールによっていろいろとあるんですけども、選択項目があり、出力変数を元に次のブロックで操作するなり表示するなりしていくということができます。Dify側でたくさんのツール用意されてますし、どうしても必要になればカスタムして自分で作るということもできたりしますので、こういった機能があるということを知っておいてください。

***

### **このセクションのまとめ (24:37 - 25:33)**
このセクションのまとめになります。このセクションでは、チャットフローの機能を使い、複数のブロックをつなげて、ノーコード、ローコード、ほとんどプログラムを書くことなく処理を組み立てることができる、複数のLLMやツールを介して様々な処理ができるようになるということを解説し、実際に作りこんできました。このブロックを組み立てる際には変数の設定が重要になりますので、入ってくる変数、設定できる変数や出力する変数、出ていく方、次のブロックに渡す変数もしっかり確認しながら作っていくということが重要になります。また、条件分岐ということで、IF/ELSEや質問分類器のブロックも組み合わせることで、たくさんの条件で処理を切り分けることができますし、今回はGPT-4o miniのみ使っていたんですけども、例えばGoogleのGeminiだったり、AnthropicのClaudeなど他のLLMもAPIキー登録さえすれば使うことができますので、複数のLLMを使うこともできるし、またたくさんのブロックもあればツールも用意されていて、画像生成だったりGoogleサーチなど様々な機能もありますので、1回で全て覚えるというのはなかなか大変だと思うんですけども、ぜひ動画を見返していただきつつ、簡単な処理から作りこんでいくことで、徐々にいろんな処理が作れるようになっていくと思いますので、ぜひ一回きりというわけではなくて、何度も見返していただければ幸いです。また、もしこの動画が分かりやすかったなどあれば、高評価、コメントなどもいただけると幸いです。引き続き、次のセクションでは外部知識について解説をしていきます。

***

### **ナレッジ（外部知識・RAG）の概要 (0:00 - 0:30)**
このセクションでは、社内文書などの外部知識を扱ってチャットボットを作る方法をご紹介いたします。外部知識のことをDifyではナレッジと呼んでいますので、ここではナレッジとしてご紹介しております。ナレッジは英語で知識という意味なんですけども、社内情報などの外部知識を与えて、生成AIからの返答に活用してもらうということになっております。一般的に生成AIの界隈ではRAGと呼ばれる仕組みになります。ラグはリトリーバル・オーグメンテッド・ジェネレーションという英語の略なんですけども、取得拡張生成、検索拡張生成というような意味になっております。

***

### **RAGの仕組み (0:30 - 1:10)**
で、簡単な流れをご紹介いたします。こちらラグの流れのイメージ図なんですけども、事前に外部知識を登録しておく必要があります。これも後ほどご紹介するんですけども、事前に外部知識を登録しておきます。これはカンペ、カンニングみたいなもので、事前に知っておきたい情報を登録しておきます。で、登録した上で、まずはユーザーがDifyに向けて質問をします。で、質問を受けましたら、まずはその情報があるかというのを検索します。外部知識に向けて探しまして、参考情報を引っ張ってきます。参考情報を引っ張ってきてから改めてユーザーが質問した内容と参考情報を関連情報くっつけた状態で、チャットGPTなどの生成AIに聞きます。で、こちらのチャットGPTやGoogleのGeminiなどの生成AIが回答を生成して、それをユーザー側に返答するというようなイメージになって、チャットGPTなどに確認する前にカンニングをしておくというのが特徴になっております。

***

### **資料の登録イメージ (1:10 - 1:47)**
続いて、このベクトルデータベースへの情報の登録方法も図解していますので、簡単にご紹介します。こちらはETLプロセスと呼ばれたりして、資料をアップロードして必要な情報を加工してからデータベースに登録するというような流れになってるんですけども、まずは資料をアップロードしますと。で、この資料をそのまんま扱うのではなくて、チャンクと呼ばれる塊ごとに分割します。500トークンだったり1000トークンだったり、こちらは設定項目があるんですけども、それぞれの分量に分割して、さらにそれをベクトル化します。ベクトルというのは複数の数字と思って頂ければいいんですけど、複数の数字、大量の数値としてガーっとこう変換するわけですね。で、この変換する際にOpenAIのAPI、こちらはエンベッティング、埋め込みというようなAPIがあるんですけども、こちらを使うことで数値化、ベクトル化することができます。で、ベクトル化、数値化したものをデータベースに保存するというような流れになっております。

***

### **RAGの活用例 (1:47 - 2:54)**
続いてRAGの使用例ということで、たくさん応用範囲ありえるんですけども、簡単なものをいくつかピックアップしております。分かりやすいところは社内向けのヘルプデスクの一次回答をさせるというのが分かりやすいかなと思います。事前に外部文章としてよくある質問や回答を作って登録しておくということですね。で、登録させておいて、これがカンニングの情報になりますので、事前に確認させるということですね。担当の代わりに返答を作ります。もし用意してる情報の中に回答がなかったら、人間のヘルプデスクに通知するということで、こちらはチャットフローの分岐なども組み合わせる必要がありますけども、こういったアプリを作ることができます。また社外向けに関しても流れとしては同じようなものなんですけども、万が一間違った情報などもお客様に返信するとよろしくないということで、返答メールの素案までは作ってもらって、最後は担当者が目視チェックしてから返信するということですね。1からメール作るよりはかなり時短になるんではなかろうかというようなアイデアもあったりします。あとは過去の提案や企業のニーズを登録しておいて営業の案件推進、資料作成をサポートするであるとか、マーケティングに活用するであったり、あとは若手向けの教育ですね。業界ごとの知識たくさんあると思いますので、それら社内データなどを登録しておいて、若手の知識を補うと、若手の知識や経験を補うということですね。で、案件によって必要な資料などあると思いますので、参考資料の提示、こちらの資料を見ておいてくださいなど、あと情報をもとに4択の問題を作るとみたいなこともできますので、応用範囲はかなり広いかな。社内申請の案内もヘルプデスクと似ておりますけども、申請の情報を先に登録しておけばチャットボットに案内してもらうということもできるかなというところでございます。

***

### **RAGの限界 (2:54 - 3:33)**
続いてRAGにできないこともありますので事前にご紹介いたします。ラグは事前にカンペ、カンニングの情報を登録しておく仕組みになりますので、登録しておくデータにない回答はできないという仕組みになっております。こちらは後から追加することもできるので、一旦作成して試しながら、よくある質問などが出てくると思いますので、回答なども随時追加していくとどんどん使いやすくなっていくということでございます。また100%の回答精度はどうしても難しいというところで、質問の表現だったり参照する内容が大量にあったりすると、なかなか100%思い通りになるかというのも難しいのかなというところであります。また、視覚的な要素、特にPDFなどで画像やグラフが入っているとこちらの理解は難しいかなと。数字として変換するんですけども、まだまだ画像やグラフの理解把握は難しい状況でございます。表に関しては以前はかなり難しいとされていたんですけども、徐々に改善されつつあるので、また追ってPDFのアップロード方法などは解説していきます。

***

### **RAGの精度向上策 (3:33 - 4:14)**
最後にRAGの精度向上ということて、まあ思ったような返答が来やすくなるためにはというような意味なんですけども、まず大事なのは資料を整備することとされています。事前にカンペ、カンニングをするということで、質問に対して回答しやすいような形式になっているかというのがそもそも重要になって、理想的にはQ&A形式でCSVになっていると返答として望ましい結果が来やすくなるとされています。社内情報全てをこのQ&A形式に置き換えるというのもなかなか大変だと思いますので、PDFのまんまアップロードする方法も後ほどご紹介いたします。またチャンクの分割のトークン設定などがありますので、追ってご紹介します。また検索方法も3種類あって、ハイブリッド検索が一番精度が高いと言われておりますので、これも追ってご紹介します。それと別のAPIを使うんですけども、リランク、再ランクといった手法もあって、これを使った方が精度が上がる場合もありますので、この機能も追ってご紹介いたします。ということで、次の動画から実際に外部知識をアップロードする方法をご紹介いたします。

***

### **ナレッジのセキュリティ (4:22 - 5:25)**
もしナレッジのセキュリティについて気になる方もいらっしゃると思いますので、こちらでご紹介いたします。安全だと考えられておりまして、その理由を3つ書いております。まず1つ目のDifyのナレッジでは暗号化が徹底されていて、データベースに情報を保存するんですけども、保存するタイミングですべての情報が暗号化されています。万が一流出したとしても、中身の解読が困難ですので、こちらで情報の安全性を担保しているというのもあります。続いて2つ目ですね。Difyはオープンソースの開発手法をとっております。不特定多数の開発者によって開発が進められています。で、開発を進めつつ、このコードは問題ないかということで常にチェックがかかっているような状態になりますので、もし不正な、悪意のある開発者がいたとしても、不正なコードが入りそうな場合であればチェックがかかります。このコードはいるのか、このコードは不要ではないかということでチェックがかかりますので、安全に開発が進められているというのが2つ目になります。3つ目、LLM側もAPIは機械学習に使わないということで明言しております。チャットGPTのOpenAIだったり、GeminiのGoogleなどですけども、API通信してそれらのLLMにアクセスする際は学習には使わないということで明言しているので安全だと考えられます。また、社内情報をアップロードするんですけども、手元のデータベースにデータを持たせたいという場合は、Web版ではなくてコミュニティ版を使うという選択肢もありますので、どうしても気になるようであればコミュニティ版もあって、こちらはまた別の講座用意しておりますので、追ってご紹介したいと思います。ということで、引き続きナレッジの登録方法などを解説していきます。

***

### **外部知識登録の流れ (5:49 - 6:14)**
絵を使って外部知識を登録する流れということで、今回は5つに分けて順を追ってご紹介いたします。まず1つ目はドキュメントを選択ということで、事前に扱いたい資料に関する話をさせていただきます。また、先に下の報を確認しておきますと、Web版の場合は1ファイルあたり最大15MBという容量制限があるというのと、アップロードは1つずつ選択という、有料プランの場合はまとめてアップロードできるんですが、無料プランの場合は1つずつ選ぶ必要があるというのと、ベクトルデータベースのサイズもプラン次第でサイズが変わりますので、フリープランの場合は5MBということになっております。

***

### **データの種類：構造化・非構造化 (6:14 - 9:23)**
続いてデータの種類ということで、大きく構造化データと非構造化データということで2種類分かれております。構造化データというのは、まあしっかり整理されているデータなんですけども、CSVや整理されたエクセルとしておりまして、理想はQ&A形式となっています。また、CSVの方がサイズが小さいので、CSVの方がたくさん登録できるということになります。続いて、非構造化データの方は整理されてないものなんですけども、テキストの他に音声、画像、動画なども非構造化データとされていて、今回は資料に特化して解説しますけども、PDFだったり、ワード、パワーポイント、メモ帳、整理されてないエクセルなどが対象になっていきます。まずは構造化データについて確認をしていきます。構造化データ、理想は旧形式と書いておりますけども、Amazonの研究チームより文章を一度Q&Aに変換する準備のフェーズを加えるとラグの精度が大幅に向上した。思っているような返答が返ってきやすくなったというような研究結果が論文として発表されております。PDFなどをそのままアップロードするよりも、一度ですね、整理して質問に対してどういう回答をしていくと望ましいのかを整理しておくという準備しておくというフェーズがとても重要になってきます。こちらは全て英語の論文にはなるんですけども、興味ある方はぜひご確認ください。この図にも簡単に書いてあるんですけども、ラグを扱う際には資料をそのままアップロードするんではなくて、チャンクという単位で分割してアップロード、データベースに保存していく流れになります。こちらは以前ご紹介したイメージ図なんですけども、資料をそのままアップロードするのではなくてチャンクごとに分けてからデータベースに登録するということをしていて、こちらを分割していく必要がありますと。実際その分割したイメージがこういった状態になります。チャンク分割例ということで、それぞれの塊の中に質問と回答例というの入っているんですけども、これも1つの塊の中に整理した質問と回答というのを入れておくと、チャンクに有効っていきやすいということですね、思っているような回答が返ってきやすいとされています。実際にどうやって作るかという話なんですけども、まずはExcelということでイメージ図を作っております。Excelで作る場合、1行目は見出しにする必要がありまして、こちら例のエクセル添付してますけども、1行目にナンバー、数字、ジャンル、質問と回答例と書いていて、この項目は自由に増やしていただいても削っていただいても大丈夫なんですけども、想定されるよくある質問とその回答例、返答例というのをそれぞれ作っておくということですね。で、一度エクセルで作っておいて、エクセルのまんまでも使えるんですけども、保存時にCSVとして出力しておくと、こちらの方が容量が小さくなります。個人的にはCSVにしておいた方がいいかなと思います。こちらはWindowsの場合のエクセルの添付してますけども、名前を付けて保存からこのファイル形式ですね。エクセルのままでもいいんですけど、CSVに変換した方が容量が小さくなるので、こちらをお勧めするというところでございます。Excelと同じく1行目は見出しになりまして、CSVは基本的にはコンマで区切ることが多いんですけども、コンマで区切ってナンバーとジャンル、質問と回答例というのがしっかり1行で収まっているということですね。Q&Aごとに改行されていて、こうしてあげると、先ほどのチャンクとして分割するのも分けやすいということになります。まあ量も小さくなるということですね。続いて非構造化データの方もご紹介します。こちらは情報が整理されてない、区切りが分かりづらい資料ということで、PDFなどですね。どうしても構造化データと比べると回答精度が下がる傾向があると言われております。以前はPDF内に表があると、表の中の数値を間違えて認識するなど、うまく情報が取得できないということも多くて、なかなか実戦的には使いづらいなという話もあったんですけども、最近は対策としてDifyではデフォルトで使われているんですけども、Unstructuredなどの外部サービスを使うことで、表の中の数字もかなり精度高く取得することができるようになっているという話でございます。こちらは外部サービスになるんですけども、Unstructuredというサービスを裏側で使われておりまして、この中のプロダクトの中にイメージのGIF動画のようなものがありましたので簡単に紹介します。以前はですね、こういった表を読み込ませると正しい数字が返ってこなかったと、数字を変えてしまっていたというのが、このUnstructuredを使うと正しく数字を抽出して表示することができるようになっているというようなイメージでございます。ということで構造化データと非構造化データと2種類のデータがあります。これを最初から作ってもいいんですけども、時間の都合もありますので、今回はこちらで用意したものがありますのでご紹介いたします。こちらはUdemyの受講画面のセクション1のレクチャー3、講座で扱っている資料ですね、という項目を作っているんですけども、この中に就業規則のCSVと不動産サンプルのエクセルというファイルを置いていておりまして、こちらこれら2つはAIで作ったものなんですけども、Q&A形式になっておりますので、これらをそれぞれダウンロードいただいて中身を確認していただくと分かりやすいかなと思います。まずはCSVの方、こちらはメモ帳などで開いていただくといいかなと思うんですけども、1行目が見出しがあって、それぞれコンマ区切りで質問と回答例が書かれているということですね。それとExcelの方も不動産サンプルということで、こちらもAIで作ったものですけども、1行目が見出しがあってナンバー、ジャンル、質問と回答例ということで整理しているパターンということです。それとPDFに関してはより実践的な内容ということで、厚労省の資料を添付しております。厚労省の資料ということで、こちらは適当に引っ張ってきているんですけども、URLもありますので、こちらからダウンロードしていただいてもいいですし、Udemyの方で添付しておりますのでダウンロードいただければということでございます。次の動画では実際に資料をアップロードしてチャンク分割など を かけ て いく こと に し ます 。

***

### **外部知識の登録とチャンク設定 (10:24 - 11:21)**
前回の動画でドキュメントに関する解説をしましたので、続いて実際にアップロードしてチャンク設定をしていく箇所についてご紹介いたします。まずは実際の画面を使って資料を選択する箇所を選んでいきます。こちらが実際の画面なんですけども、画面の上の方にスタジオをこれまで扱ってきましたけども、画面の上の方にナレッジという項目がありますので、こちらをクリックします。ナレッジをクリックしますと、これまで作ってきたナレッジ表示されるんですけども、左側のナレッジを作成という箇所をクリックしてください。そうするとデータソースの選択ということで3種類選ぶことができるんですけども、今回はテキストファイルになります。テキストファイルをアップロードということでCSV、エクセル、PDFなどをここから選んでいくということですね。ファイルをドラッグアンドドロップしてもいいですし、参照というリンクをクリックしてファイルを選ぶことができます。こちら前回もご紹介しましたけども、Udemyの中にCSVファイルありましたので事前にダウンロードいただいてからご対応いただければと思います。ダウンロードしている状態で参照を押しまして、ダウンロードの就業規則CSVから確認いたします。こちらを開くで選びますと、ファイルと容量767kbですかね。こちらが表示されていて次へを押します。次へを押しますといくつか設定項目がありまして、それぞれ解説が必要なので順を追ってご紹介します。

***

### **チャンク設定の詳細 (11:21 - 13:25)**
まずチャンク設定という箇所で自動とカスタムとあるんですけども、今回はカスタムの方に細かく調整できるできる方をクリックしておきます。そうするとセグメント識別子、最大チャンク長、チャンクのオーバーラップという項目がありますので、この辺を解説いたします。まず1つ目なんですけども、セグメント識別子というのがチャンクごとに分割する目印になります。Windowsの場合は円で改行、バックスラッシュのNで改行ということですね。Windowsの場合はバックスラッシュのN、Nは改行という意味になります。どういうことかというと、CSV見ていただくと分かると思うんですが、CSVの場合は1行質問と回答例があってここで改行されるわけですね。改行して次の情報、改行して次の情報ということが分かれていきますので、CSVの場合は改行ごとに情報が分かれるということですので、1つの改行をつけておけばいいかなというところです。少し注意なのがエクセル設定、エクセルの場合はセルの中で改行することもあると思います。こちらも回答例作ってますけども、回答例の中で改行していると、もしこのセグメント識別子を一つの改行としておくとここでも区切られてしまうんですね。回答例が分かれてしまって、思ったような返答にならない可能性が出てきますので、お勧めとしては改行を2回書いておくと、セルの中で改行されていたとしても、うまいこと一つのチャンクとしておけることができますので、エクセルだったりPDFで改行していても情報が続くという場合は改行2回など書いておくことをお勧めいたします。それと他にも設定項目ありましたけども、最大チャンク長というのが一塊の最大の文字数、実際はトークン数になるんですけども、こちらが短すぎると意味が不足する、長すぎると精度が下がる、回答精度が下がると言われております。Web版の設定幅は50から1000ということで、これより大きくは今のところ設定できない状態になっております。こちらは実際にアップロードする資料の文字数などで変わってくるんですけども、CSVやエクセルであれば500から1000のあたりにしておくといいのかなと確認とプレビューのかなとされております。で、非構造化データ、特に大きな表などがあって、その表を全て情報含める必要がある場合は1000よりも多い値で設定することもあり得るんですが、こちらはWeb版では現状設定不可となっておりますので、最大の1000にしておくといいかなというところでございます。それともう一つ、オーバーラップという項目もありまして、こちらはチャンクを重複させるという機能になっています。チャンクごとに分割はするんですけども、分割する際にどうしても文章が途中で切れてしまうということもありますので、次のチャンクと前のチャンクどれぐらい情報を重複させるか、多少見切れても認識できるように少し情報をかぶせるというような設定ができるようになっております。こちらは最大チャンク長の10%から25%推奨とされておりまして、例えば500であれば50、1000の場合は100から250ということで設定しておくといいかなと思います。分割できているかというのも確認しておくとよろしいかと思います。

***

### **チャンク設定の実演 (13:25 - 14:29)**
改めて実際の画面で確認していきます。セグメント識別子というのが、Macの場合はバックスラッシュのNとなっておりますが、Windowsの場合は円マークのNとなっていると思いますので、パソコンによってこの表示は変わってきます。また、もしエクセルなどでこの改行コード2回必要な場合は円マークのNを2回書いてあげるようにしてください。今回はMacということでバックスラッシュのNとしておきます。最大チャンク長は500、オーバーラップは10から25ということで、今回は50としておきます。また前処理ルールということで、連続するスペースや改行を置換する、すべてのURLやメールアドレス入っていたら削除するというチェックもありますので、今回はこのまま押しますが、必要に応じて変更してみてください。で、設定できましたら確認プレビューを押しますと、画面の右の方にチャンクごとに分割したプレビューを見ることができます。この中に質問と回答例が入っているのが理想的なので、しっかり入ってそうだというのを確認するようにしてみてください。もし思ったように分割できてなかったら、こちらのパラメータを変更していただければと思いますけども、例えば最大チャンク長をあえて短い50などにして確認プレビューとしてみますと、右側でプレビュー見れますけども、回答例が切れていて、正しく分割ができてないというのもパッと見で分かるかなと思います。このチャンク長短すぎると正しい意味が取得できませんので、500から1000あたりにしておくと無難かなと思います。あとは資料によって微調整かけてもいいかなというところで、500の50ですね。これで確認プレビューを押して、質問と回答がそれぞれ分かれてそうだということで、次の設定に移っていきます。

***

### **外部知識登録と設定項目の解説 (14:36 - 15:20)**
引き続き外部知識登録の流れを解説します。前回の動画でチャンク設定まではできておりますので、その後ですね、インデックス検索、埋め込み処理などを解説していきます。まずは実際の画面を確認しておきたいんですけども、前回チャンクの設定をしておりましたので、その下に進んでいきます。まずはじめにインデックスモードとして高品質と経済的と2種類から選ぶことができます。検索詳細設定を学ぶ方法についてはについてもナレッジの設定で変更できます。高品質なベクトルを生成し、そのベクトル表現に最も類似したテキストチャンクを検索します。この高品質モードを選んでいる状態で、その下に検索設定という箇所があります。で、この検索設定がベクトル検索と全文検索とハイブリッド検索ということで3種類ありますので、こちらを簡単にご紹介いたします。

***

### **検索設定の比較 (15:20 - 17:12)**
検索設定ということで3種類ありますと。まずベクトル検索なんですけども、こちらは問い合わせされている内容の意味を重視して検索するというのが特徴になっていて、最近の生成AIではこちらのベクトル検索で実施されることが多いです。ちょうど具体例もご紹介します。続いて全文検索は問い合わせに含まれるキーワードを重視して検索するということで、問い合わせ文章をキーワードごとに区切ってですね、そのキーワードがあれば表示するというような仕組みになっています。3つ目のハイブリッド検索はおすすめとついておりますが、ベクトル検索と全文検索どちらも実施するという検索方法になっています。おすすめとなっていて、基本的にはハイブリッド検索を実施した方が精度は上がると言われておりますけども、2つの検索方法を使うので多少コストが増えてきます。1円もかからないぐらいかなり安い金額で実施はできるんですが、もし金額が気になるであるとか大量の文章を扱う場合はベクトル検索に設定するという手もあるかなということでございます。ベクトル検索と全文検索の比較ということで、事前に内容を容認しております。こちらのCSVの中に病気休暇はどうように取得しますか、こちらのCSVの中に病気休暇はどうように取得しますか、という質問を読み込ませたんですけども、CSVの中に病気休暇をどうように取得しますか、という質問を読み込ませたんですけども、用意している質問と回答はあらかじめ用意しているんですけども、キーワードとしては病気休暇という風になっております。で、これを全文検索で拾えるかという話なんですけども、全文検索で病気休暇の方法を教えてとか書けば表示されるはずなんですが、病気のため休む場合の手続きについてということで、このキーワードを少し変えているということですね。病気休暇ではなくて病気のためということでキーワードを変えますと、全文検索の場合は入力のキーワードと同じ表現がない、同じキーワードがないので、CSVの内容ではなくて一般的な内容を返答してしまっているということになっております。対してベクトル検索の場合は質問としては同じなんですけども、この意味を汲み取ってですね、病気のため休むんだなということで、それに近しいものを選んで表示することができているということになりまして、キーワードぴったりの質問をするのも難しいので、基本的には返答しやすいようにハイブリッド検索の方が使いやすいとされております。で、どうやってこの意味が近い内容を返答しているかという話なんですけども、情報をベクトル化してベクトルデータベースに保存した後でですね。ですね、こちらは簡単な2次元の図にしているんですけども、コサインというのは高校の数学で習ったと思いますけども、角度をですね、2つないしま複数の情報があったとして、この角度が小さければ小さいほど意味が似ているという判定になって、先ほどの出力ができるようになっていると。コサイン類似度、角度が浅いと似ているということですね。他にもユークリッド距離という計算方法もあるんですが、Difyの場合はコサイン類似度で計算しているということになっております。

***

### **検索設定とインデックスモードの調整 (17:12 - 18:37)**
ということで、改めてDifyの画面に戻りますけども、インデックスモードは高品質にしておきます。検索設定3種類ありますけども、最も精度が高いとされているハイブリッド検索で今回は選ぶようにします。で、このハイブリッド検索しますとさらにウェイト設定とリランクモデルというものがあって、このリランクについては外部APIの登録が必要になります。なので今回はウェイト設定の方でご紹介することにします。そうするとさらに設定項目がありまして、ウェイト設定が見切れてますけど、セマンティックというのとキーワードということで、このパラメータを調整することができます。こちらはセマンティックは意味という意味なんですけども、ベクトル検索重視にするか、キーワードの方は全文検索重視にするか、どちらを重視しますかというところで調整することができます。今回は初期値ということでセマンティック0.7の設定で進めることにします。それとトップKとスコア閾値というものがありますので、こちらも確認しておきますと、トップKというのは出力される結果の数になります。数字が高いほど結果の数が増えるということで、デフォルト3だったと思いますけども、この数値を増やせば増やすほど結果の数ですね、出力される数が増えます。またスコア閾値という設定もありまして、こちらを有効にすると、数字が高いほど精度重視、関連性の高い情報のみを提供すると。数字が低いほどもっと幅広くですね、情報を提供するということで、こちらも出力内容を調整することができるようになっております。今回は特に設定はせず、そのままデフォルト値ですね、トップKは3としておいてスコア閾値はつけていないという状態で登録することにします。画面の下の方に推定チャンク数50となっておりますけども、保存して処理のボタンを押してあげます。そうするとナレッジが作成されましたということで、ナレッジ名、これまた後で編集できますけども、こちらの情報ができましたと。で、埋め込みの推定消費量と金額ですね。0.0005ドルなんで1円以下という価格になっておりますが、これで埋め込みすることができるということになっております。で、これで登録ができましたので、下の方にドキュメントに移動というボタンがありますので、こちらをクリックするとドキュメントの内容が見えます。

***

### **ナレッジの管理と設定 (18:37 - 19:53)**
少し分かりづらいんですけども、一旦ナレッジの方を見ますと、ナレッジ、ナレッジの中にナレッジが箱みたいなもので、こちらをクリックすると、ナレッジの中にドキュメントを複数登録することができるようになっております。またナレッジのメニューもありますので、次の動画で解説いたします。これまでの解説で資料をアップロードしてナレッジとして登録することができておりますので、引き続き続きを解説していきます。一旦画面の上の方に戻りましてナレッジをクリックすると、これは一度作ったナレッジが一覧で表示されますと。ナレッジはこちらをクリックしますと、ナレッジの箱の中に入っている資料ドキュメントを見ることができます。で、こちらは一つに限らずファイルを追加することもできます。で、先に実際のチャットボットを作った際の設定方法について確認したいんですけども、一つのチャットボットの中に複数のナレッジを設定することができます。こちらに画像添付しているんですけども、4つナレッジがあったとして、その中の2つを選んでいるというような選択することができるようになっています。で、もし複数ナレッジ選択されている場合は、ナレッジの説明という文章を設定することができるんですけども、こちらの文章を確認してどのナレッジを使えばいいかというのを判断されるようになっています。また、ナレッジは箱なんですけども、一つのナレッジの中に複数のドキュメントを登録はできます。登録はできるんですけども、ナレッジの説明はナレッジごと、箱ごとの説明になっていきますので、基本的には1ナレッジ1ドキュメントの方が管理しやすいのでこちらをお勧めいたします。もし全く別の資料をアップロードしたい場合はナレッジをもう一つ作るということですね。というのも踏まえつつ、改めて実際の画面を確認していきます。

***

### **ナレッジとドキュメントの編集 (19:53 - 22:38)**
画面の左側にドキュメントと検索テストと設定とありまして、ドキュメントは一つおすすめなんですけども、追加することもできますと。で、アクションとありまして、こちらのチェックボックスをつけるか使うかどうかですね、使うかどうかというチェックをかけることができます。またこの資料をクリックすると編集することができまして、名前も変えれるんですけども、この資料ごとですね、クリックしますと、この中身チャンクですけども、どういう分割になっているかというのを確認することができて、それぞれ有効無効ですね、かなり細かいですけども、設定したり削除したりすることもできるし、クリックしますと、このチャンクごとの内容だったり、関連するキーワード、文字数なども表示されています。画面の上の方にペンのマークで編集することもできまして、質問とか回答例ですね、この中身変えたい場合はキーワード追加などしたい場合は編集することができます。また画面の右の方にチャンクを追加という項目もありまして、こちらをクリックするとチャンクを追加、一括で追加するかということで、よくある質問追加することも簡単にできるようになっています。チャンクを追加の場合はこの内容が空っぽになっていて、基本的にはこれまでのチャンクとこの列ですね、ナンバー、ジャンル、質問、回答などはフォーマットを合わせておいた方がいいですので、もし新しいチャンクを作りたい場合はこれまでのチャンクを一旦コピーしてチャンクを追加して、この内容を修正すると質問と回答とかですね、このあたりを修正してキーワードも追加するようにしてみていただければというところでございます。また一括追加の場合はCSVを事前に作っておく必要がありますので、CSVを作ってアップロードするというところでございます。あと、メタデータという項目があって、この中に書籍なのかWebページなのか、ビジネスの資料なのかということで、さらに細かく設定することもできます。資料ごとにさらに細かい設定などをしたい場合はこちらで研究の資料だったり、要件定義書、市場分析、プロジェクト計画などということで設定することもできるかなと思っております。続いて画面の左側に検索テストという項目がありますので、こちらも確認しておきます。こちらは検索のテストなんですけども、文章を入力してどのチャンクが引っかかるかというのをテストするという項目になっております。事前に文章を作っておりましたので、こちらを貼り付けてですね、病気のための手続きということで、もしこういう文章がチャットボットに入ってきたらテストをしますと、このチャンクが引っかかっているということで、まあ思ったような回答例が引っかかっているかというのを確認することができます。またベクトル検索の場合はキーワードぴったりではなくてその意味ですね、意味の認識して意味が近しいものを引っ張ってきますので、この意味が合っているかというのも確認することができます。また上の方にハイブリッド検索ありますけども、検索方法を変更することもできるようになっています。というところですね。続いて設定の項目を見ますと、大きいところとしてナレッジ名とナレッジの説明ですね。ナレッジ名はチャットボットなどで選択する時にこの名前が表示されますので、分かりやすい名前に変更いただいてOKです。ナレッジの説明の方が先ほどもお伝えしましたですけども、ナレッジが複数あった際にどれを使うかという判断の目安になります。一旦こちらを空っぽにしますと、このナレッジに含まれる内容を説明してくださいという風に書いております。で、この良いナレッジの書き方というのがリンクはあるんですけども、中身がまだ表示されてない状態ですので、今のところもし一つのチャットボットの中に複数ナレッジを使う場合はこちらも書いてあげる必要があるということですね。これはもう資料の中身次第なのでとうとでも書けるんですけども、最大400文字となっておりまして、今回記入例ということでこういった文章を入れてもいいのかな。このナレッジには会社の就業規則に関する質問例と回答例が含まれています。具体的には下記のような内容ということで、入ってる内容をざーっと書いているような説明文にしているんですけども、もちろん就業規則に限らず、営業の資料であるとか、要件定義、市場分析などですね、目的とその内容をざーっと分かるところもこの文章も参考に登録していただければと思います。今回は初期値ということでセマンティック0.7の設定で進めることにします。それとトップKとスコア閾値というものがありますので、こちらも確認しておきますと、トップKというのは出力される結果の数になります。数字が高いほど結果の数が増えるということで、デフォルト3だったと思いますけども、この数値を増やせば増やすほど結果の数ですね、出力される数が増えます。またスコア閾値という設定もありまして、こちらを有効にすると、数字が高いほど精度重視、関連性の高い情報のみを提供すると、数字が低いほどもっと幅広くですね、情報を提供するということで、こちらも出力内容を調整することができるようになっております。今回は特に設定はせず、そのままデフォルト値ですね、トップKは3としておいて、スコア閾値はつけていないという状態で登録することにします。画面の下の方に推定チャンク数50となっておりますけども、保存して処理のボタンを押してあげます。そうするとナレッジが作成されましたということで、ナレッジ名、これまた後で編集できますけども、こちらの情報ができましたと。で、埋め込みの推定消費量と金額ですね。0.0005ドルなんで1円以下という価格になっておりますが、これで埋め込みすることができるということになっております。で、これで登録ができましたので、下の方にドキュメントに移動というボタンがありますので、こちらをクリックするとドキュメントの内容が見えます。少し分かりづらいんですけども、一旦ナレッジの方を見ますと、ナレッジ、ナレッジの中にナレッジが箱みたいなもので、こちらをクリックすると、ナレッジの中にドキュメントを複数登録することができるようになっております。またナレッジのメニューもありますので、次の動画で解説いたします。

***

### **ナレッジとドキュメントの管理 (19:00 - 20:35)**
これまでの解説で資料をアップロードしてナレッジとして登録することができておりますので、引き続き続きを解説していきます。一旦画面の上の方に戻りましてナレッジをクリックすると、これは一度作ったナレッジが一覧で表示されますと。ナレッジはこちらをクリックしますと、ナレッジの箱の中に入っている資料ドキュメントを見ることができます。で、こちらは一つに限らずファイルを追加することもできます。で、先に実際のチャットボットを作った際の設定方法について確認したいんですけども、一つのチャットボットの中に複数のナレッジを設定することができます。こちらに画像添付しているんですけども、4つナレッジがあったとして、その中の2つを選んでいるというような選択することができるようになっています。で、もし複数ナレッジ選択されている場合は、ナレッジの説明という文章を設定することができるんですけども、こちらの文章を確認してどのナレッジを使えばいいかというのを判断されるようになっています。また、ナレッジは箱なんですけども、一つのナレッジの中に複数のドキュメントを登録はできます。登録はできるんですけども、ナレッジの説明はナレッジごと、箱ごとの説明になっていきますので、基本的には1ナレッジ1ドキュメントの方が管理しやすいのでこちらをお勧めいたします。もし全く別の資料をアップロードしたい場合はナレッジをもう一つ作るということですね。というのも踏まえつつ、改めて実際の画面を確認していきます。画面の左側にドキュメントと検索テストと設定とありまして、ドキュメントは一つおすすめなんですけども、追加することもできますと。で、アクションとありまして、こちらのチェックボックスをつけるか使うかどうかですね、使うかどうかというチェックをかけることができます。またこの資料をクリックすると編集することができまして、名前も変えれるんですけども、この資料ごとですね、クリックしますと、この中身チャンクですけども、どういう分割になっているかというのを確認することができて、それぞれ有効無効ですね、かなり細かいですけども、設定したり削除したりすることもできるし、クリックしますと、このチャンクごとの内容だったり、関連するキーワード、文字数なども表示されています。画面の上の方にペンのマークで編集することもできまして、質問とか回答例ですね、この中身変えたい場合はキーワード追加などしたい場合は編集することができます。また画面の右の方にチャンクを追加という項目もありまして、こちらをクリックするとチャンクを追加、一括で追加するかということで、よくある質問追加することも簡単にできるようになっています。チャンクを追加の場合はこの内容が空っぽになっていて、基本的にはこれまでのチャンクとこの列ですね、ナンバー、ジャンル、質問、回答などはフォーマットを合わせておいた方がいいですので、もし新しいチャンクを作りたい場合はこれまでのチャンクを一旦コピーしてチャンクを追加して、この内容を修正すると質問と回答とかですね、このあたりを修正してキーワードも追加するようにしてみていただければというところでございます。

***

### **ナレッジの詳細設定とテスト (20:35 - 23:20)**
また一括追加の場合はCSVを事前に作っておく必要がありますので、CSVを作ってアップロードするというところでございます。あとメタデータという項目があって、この中に書籍なのか、Webページなのか、ビジネスの資料なのかということで、さらに細かく設定することもできます。資料ごとにさらに細かい設定などをしたい場合はこちらで研究の資料だったり、要件定義書、市場分析、プロジェクト計画などということで設定することもできるかなと思っております。続いて画面の左側に検索テストという項目がありますので、こちらも確認しておきます。こちらは検索のテストなんですけども、文章を入力してどのチャンクが引っかかるかというのをテストするという項目になっております。事前に文章を作っておりましたので、こちらを貼り付けてですね、病気のための手続きということで、もしこういう文章がチャットボットに入ってきたらテストをしますと、このチャンクが引っかかっているということで、まあ思ったような回答例が引っかかっているかというのを確認することができます。またベクトル検索の場合はキーワードぴったりではなくてその意味ですね、意味を認識して意味が近しいものを引っ張ってきますので、この意味が合っているかというのも確認することができます。また上の方にハイブリッド検索ありますけども、検索方法を変更することもできるようになっています。というところですね。続いて設定の項目を見ますと、大きいところとしてナレッジ名とナレッジの説明ですね。ナレッジ名はチャットボットなどで選択する時にこの名前が表示されますので、分かりやすい名前に変更いただいてOKです。ナレッジの説明の方が先ほどもお伝えしましたですけども、ナレッジが複数あった際にどれを使うかという判断の目安になります。一旦こちらを空っぽにしますと、このナレッジに含まれる内容を説明してくださいという風に書いております。で、この良いナレッジの書き方というのがリンクはあるんですけども、中身がまだ表示されてない状態ですので、今のところもし一つのチャットボットの中に複数ナレッジを使う場合はこちらも書いてあげる必要があるということですね。これはもう資料の中身次第なのでとうとでも書けるんですけども、最大400文字となっておりまして、今回記入例ということでこういった文章を入れてもいいのかな。このナレッジには会社の就業規則に関する質問例と回答例が含まれています。具体的には下記のような内容ということで、入ってる内容をざーっと書いているような説明文にしているんですけども、もちろん就業規則に限らず、営業の資料であるとか、要件定義、市場分析などですね、目的とその内容をざーっと分かるところもこの文章も参考に登録していただければと思います。今回は初期値ということでセマンティック0.7の設定で進めることにします。それとトップKとスコア閾値というものがありますので、こちらも確認しておきますと、トップKというのは出力される結果の数になります。数字が高いほど結果の数が増えるということで、デフォルト3だったと思いますけども、この数値を増やせば増やすほど結果の数ですね、出力される数が増えます。またスコア閾値という設定もありまして、こちらを有効にすると、数字が高いほど精度重視、関連性の高い情報のみを提供すると、数字が低いほどもっと幅広くですね、情報を提供するということで、こちらも出力内容を調整することができるようになっております。今回は特に設定はせず、そのままデフォルト値ですね、トップKは3としておいて、スコア閾値はつけていないという状態で登録することにします。画面の下の方に推定チャンク数50となっておりますけども、保存して処理のボタンを押してあげます。そうするとナレッジが作成されましたということで、ナレッジ名、これまた後で編集できますけども、こちらの情報ができましたと。で、埋め込みの推定消費量と金額ですね。0.0005ドルなんで1円以下という価格になっておりますが、これで埋め込みすることができるということになっております。で、これで登録ができましたので、下の方にドキュメントに移動というボタンがありますので、こちらをクリックするとドキュメントの内容が見えます。少し分かりづらいんですけども、一旦ナレッジの方を見ますと、ナレッジ、ナレッジの中にナレッジが箱みたいなもので、こちらをクリックすると、ナレッジの中にドキュメントを複数登録することができるようになっております。またナレッジのメニューもありますので、次の動画で解説いたします。これまでの解説で資料をアップロードしてナレッジとして登録することができておりますので、引き続き続きを解説していきます。一旦画面の上の方に戻りましてナレッジをクリックすると、これは一度作ったナレッジが一覧で表示されますと。ナレッジはこちらをクリックしますと、ナレッジの箱の中に入っている資料ドキュメントを見ることができます。で、こちらは一つに限らずファイルを追加することもできます。で、先に実際のチャットボットを作った際の設定方法について確認したいんですけども、一つのチャットボットの中に複数のナレッジを設定することができます。こちらに画像添付しているんですけども、4つナレッジがあったとして、その中の2つを選んでいるというような選択することができるようになっています。で、もし複数ナレッジ選択されている場合は、ナレッジの説明という文章を設定することができるんですけども、こちらの文章を確認してどのナレッジを使えばいいかというのを判断されるようになっています。また、ナレッジは箱なんですけども、一つのナレッジの中に複数のドキュメントを登録はできます。登録はできるんですけども、ナレッジの説明はナレッジごと、箱ごとの説明になっていきますので、基本的には1ナレッジ1ドキュメントの方が管理しやすいのでこちらをお勧めいたします。もし全く別の資料をアップロードしたい場合はナレッジをもう一つ作るということですね。というのも踏まえつつ、改めて実際の画面を確認していきます。画面の左側にドキュメントと検索テストと設定とありまして、ドキュメントは一つおすすめなんですけども、追加することもできますと。で、アクションとありまして、こちらのチェックボックスをつけるか使うかどうかですね、使うかどうかというチェックをかけることができます。またこの資料をクリックすると編集することができまして、名前も変えれるんですけども、この資料ごとですね、クリックしますと、この中身チャンクですけども、どういう分割になっているかというのを確認することができて、それぞれ有効無効ですね、かなり細かいですけども、設定したり削除したりすることもできるし、クリックしますと、このチャンクごとの内容だったり、関連するキーワード、文字数なども表示されています。画面の上の方にペンのマークで編集することもできまして、質問とか回答例ですね、この中身変えたい場合はキーワード追加などしたい場合は編集することができます。また画面の右の方にチャンクを追加という項目もありまして、こちらをクリックするとチャンクを追加、一括で追加するかということで、よくある質問追加することも簡単にできるようになっています。チャンクを追加の場合はこの内容が空っぽになっていて、基本的にはこれまでのチャンクとこの列ですね、ナンバー、ジャンル、質問、回答などはフォーマットを合わせておいた方がいいですので、もし新しいチャンクを作りたい場合はこれまでのチャンクを一旦コピーしてチャンクを追加して、この内容を修正すると質問と回答とかですね、このあたりを修正してキーワードも追加するようにしてみていただければというところでございます。また一括追加の場合はCSVを事前に作っておく必要がありますので、CSVを作ってアップロードするというところでございます。あとメタデータという項目があって、この中に書籍なのか、Webページなのか、ビジネスの資料なのかということで、さらに細かく設定することもできます。資料ごとにさらに細かい設定などをしたい場合はこちらで研究の資料だったり、要件定義書、市場分析、プロジェクト計画などということで設定することもできるかなと思っております。続いて画面の左側に検索テストという項目がありますので、こちらも確認しておきます。こちらは検索のテストなんですけども、文章を入力してどのチャンクが引っかかるかというのをテストするという項目になっております。事前に文章を作っておりましたので、こちらを貼り付けてですね、病気のための手続きということで、もしこういう文章がチャットボットに入ってきたらテストをしますと、このチャンクが引っかかっているということで、まあ思ったような回答例が引っかかっているかというのを確認することができます。またベクトル検索の場合はキーワードぴったりではなくてその意味ですね、意味を認識して意味が近しいものを引っ張ってきますので、この意味が合っているかというのも確認することができます。また上の方にハイブリッド検索ありますけども、検索方法を変更することもできるようになっています。というところですね。続いて設定の項目を見ますと、大きいところとしてナレッジ名とナレッジの説明ですね。ナレッジ名はチャットボットなどで選択する時にこの名前が表示されますので、分かりやすい名前に変更いただいてOKです。ナレッジの説明の方が先ほどもお伝えしましたですけども、ナレッジが複数あった際にどれを使うかという判断の目安になります。一旦こちらを空っぽにしますと、このナレッジに含まれる内容を説明してくださいという風に書いております。で、この良いナレッジの書き方というのがリンクはあるんですけども、中身がまだ表示されてない状態ですので、今のところもし一つのチャットボットの中に複数ナレッジを使う場合はこちらも書いてあげる必要があるということですね。これはもう資料の中身次第なのでどうとでも書けるんですけども、最大400文字となっておりまして、今回記入例ということでこういった文章を入れてもいいのかな。このナレッジには会社の就業規則に関する質問例と回答例が含まれています。具体的には下記のような内容ということで、入ってる内容をざーっと書いているような説明文にしているんですけども、もちろん就業規則に限らず、営業の資料であるとか、要件定義、市場分析などですね、目的とその内容をざーっと分かるところもこの文章も参考に登録していただければと思います。今回は初期値ということでセマンティック0.7の設定で進めることにします。それとトップKとスコア閾値というものがありますので、こちらも確認しておきますと、トップKというのは出力される結果の数になります。数字が高いほど結果の数が増えるということで、デフォルト3だったと思いますけども、この数値を増やせば増やすほど結果の数ですね、出力される数が増えます。またスコア閾値という設定もありまして、こちらを有効にすると、数字が高いほど精度重視、関連性の高い情報のみを提供すると、数字が低いほどもっと幅広くですね、情報を提供するということで、こちらも出力内容を調整することができるようになっております。今回は特に設定はせず、そのままデフォルト値ですね、トップKは3としておいて、スコア閾値はつけていないという状態で登録することにします。画面の下の方に推定チャンク数50となっておりますけども、保存して処理のボタンを押してあげます。そうするとナレッジが作成されましたということで、ナレッジ名、これまた後で編集できますけども、こちらの情報ができましたと。で、埋め込みの推定消費量と金額ですね。0.0005ドルなんで1円以下という価格になっておりますが、これで埋め込みすることができるということになっております。で、これで登録ができましたので、下の方にドキュメントに移動というボタンがありますので、こちらをクリックするとドキュメントの内容が見えます。少し分かりづらいんですけども、一旦ナレッジの方を見ますと、ナレッジ、ナレッジの中にナレッジが箱みたいなもので、こちらをクリックすると、ナレッジの中にドキュメントを複数登録することができるようになっております。またナレッジのメニューもありますので、次の動画で解説いたします。これまでの解説で資料をアップロードしてナレッジとして登録することができておりますので、引き続き続きを解説していきます。一旦画面の上の方に戻りましてナレッジをクリックすると、これは一度作ったナレッジが一覧で表示されますと。ナレッジはこちらをクリックしますと、ナレッジの箱の中に入っている資料ドキュメントを見ることができます。で、こちらは一つに限らずファイルを追加することもできます。で、先に実際のチャットボットを作った際の設定方法について確認したいんですけども、一つのチャットボットの中に複数のナレッジを設定することができます。こちらに画像添付しているんですけども、4つナレッジがあったとして、その中の2つを選んでいるというような選択することができるようになっています。で、もし複数ナレッジ選択されている場合は、ナレッジの説明という文章を設定することができるんですけども、こちらの文章を確認してどのナレッジを使えばいいかというのを判断されるようになっています。また、ナレッジは箱なんですけども、一つのナレッジの中に複数のドキュメントを登録はできます。登録はできるんですけども、ナレッジの説明はナレッジごと、箱ごとの説明になっていきますので、基本的には1ナレッジ1ドキュメントの方が管理しやすいのでこちらをお勧めいたします。もし全く別の資料をアップロードしたい場合はナレッジをもう一つ作るということですね。というのも踏まえつつ、改めて実際の画面を確認していきます。画面の左側にドキュメントと検索テストと設定とありまして、ドキュメントは一つおすすめなんですけども、追加することもできますと。で、アクションとありまして、こちらのチェックボックスをつけるか使うかどうかですね、使うかどうかというチェックをかけることができます。またこの資料をクリックすると編集することができまして、名前も変えれるんですけども、この資料ごとですね、クリックしますと、この中身チャンクですけども、どういう分割になっているかというのを確認することができて、それぞれ有効無効ですね、かなり細かいですけども、設定したり削除したりすることもできるし、クリックしますと、このチャンクごとの内容だったり、関連するキーワード、文字数なども表示されています。画面の上の方にペンのマークで編集することもできまして、質問とか回答例ですね、この中身変えたい場合はキーワード追加などしたい場合は編集することができます。また画面の右の方にチャンクを追加という項目もありまして、こちらをクリックするとチャンクを追加、一括で追加するかということで、よくある質問追加することも簡単にできるようになっています。チャンクを追加の場合はこの内容が空っぽになっていて、基本的にはこれまでのチャンクとこの列ですね、ナンバー、ジャンル、質問、回答などはフォーマットを合わせておいた方がいいですので、もし新しいチャンクを作りたい場合はこれまでのチャンクを一旦コピーしてチャンクを追加して、この内容を修正すると質問と回答とかですね、このあたりを修正してキーワードも追加するようにしてみていただければというところでございます。また一括追加の場合はCSVを事前に作っておく必要がありますので、CSVを作ってアップロードするというところでございます。あとメタデータという項目があって、この中に書籍なのか、Webページなのか、ビジネスの資料なのかということで、さらに細かく設定することもできます。資料ごとにさらに細かい設定などをしたい場合はこちらで研究の資料だったり、要件定義書、市場分析、プロジェクト計画などということで設定することもできるかなと思っております。続いて画面の左側に検索テストという項目がありますので、こちらも確認しておきます。こちらは検索のテストなんですけども、文章を入力してどのチャンクが引っかかるかというのをテストするという項目になっております。事前に文章を作っておりましたので、こちらを貼り付けてですね、病気のための手続きということで、もしこういう文章がチャットボットに入ってきたらテストをしますと、このチャンクが引っかかっているということで、まあ思ったような回答例が引っかかっているかというのを確認することができます。またベクトル検索の場合はキーワードぴったりではなくてその意味ですね、意味を認識して意味が近しいものを引っ張ってきますので、この意味が合っているかというのも確認することができます。また上の方にハイブリッド検索ありますけども、検索方法を変更することもできるようになっています。というところですね。続いて設定の項目を見ますと、大きいところとしてナレッジ名とナレッジの説明ですね。ナレッジ名はチャットボットなどで選択する時にこの名前が表示されますので、分かりやすい名前に変更いただいてOKです。ナレッジの説明の方が先ほどもお伝えしましたですけども、ナレッジが複数あった際にどれを使うかという判断の目安になります。一旦こちらを空っぽにしますと、このナレッジに含まれる内容を説明してくださいという風に書いております。で、この良いナレッジの書き方というのがリンクはあるんですけども、中身がまだ表示されてない状態ですので、今のところもし一つのチャットボットの中に複数ナレッジを使う場合はこちらも書いてあげる必要があるということですね。これはもう資料の中身次第なのでとうとでも書けるんですけども、最大400文字となっておりまして、今回記入例ということでこういった文章を入れてもいいのかな。このナレッジには会社の就業規則に関する質問例と回答例が含まれています。具体的には下記のような内容ということで、入ってる内容をざーっと書いているような説明文にしているんですけども、もちろん就業規則に限らず、営業の資料であるとか、要件定義、市場分析などですね、目的とその内容をざーっと分かるところもこの文章も参考に登録していただければと思います。をさーっとこうやって書いてあげることにします。続いて権限としてチーム開発ですね。もしやっていれば権限変えることもできます。今回は自分のみそのまんま設定します。埋め込みモデルということで、こちらOpenAIの埋め込みです。エンベッティングサンダージというのが今のところの最新のものになっておりますので、ここは自動的に設定されると思いますので、このままでOKです。検索設定もし変更したい場合は変更することもできますと。で、改めて保存を押しますと、画面の左の方にザッと説明が入っていたりしますけども、内容を登録することができるということですね。またナレッジを登録する際はベクトルデータベースの容量も影響してきますので、そちらも確認しておきます。画面右上のメニューから設定をクリックして請求の箇所にあるんですけども、請求の中にベクタースペースという項目があって、こちらが現在プロプランなんですが、フリーの場合は5メガになっていますので、こちらの容量も確認して、もし登録できない場合は容量の上限かかっている可能性もありますので、こちらも確認するようにしていただければということでございます。

***

### **ExcelとPDFの資料アップロード (23:20 - 24:14)**
これまでの解説でCSVファイルをナレッジとして登録するという作業をしましたので、続いてExcelファイルとPDFファイルについても簡単に補足解説いたします。流れとしては全く同じなんですけども、Difyのナレッジの箇所からナレッジを作成というボタンを押しまして、テキストファイルをアップロードで、今回はExcelの方ですね。不動産サンプルというのを選んであげます。開くで次へを押しますと、前回と同じようにチャンク設定、インデックスモードなどがありますので、前回はこのカスタムでやりましたけども、自動でもほぼ同じような設定になります。で、こちらで保存して処理をしてあげると、Excelの場合も同じようにナレッジが作成されましたと。で、ドキュメントに移動しますと、Excelのファイルが読み込まれているというのが分かります。続いてPDFの方も読み込ませることにします。ナレッジを作成、テキストファイルから参照で、今回は厚労省の調査ということで、PDFのファイルを選びます。こちら開くと次へと押しまして、チャンクの設定は今回は自動のままでいいかなと思います。こちらで保存して処理としてあげますと、ナレッジが作成されましたという表示になりますので、ドキュメントに移動して、それぞれのナレッジが作られているというのが確認できます。

***

### **ナレッジとチャットフローの連携 (24:14 - 26:10)**
外部知識をチャットボット、特にチャットフローで扱う方法をご紹介いたします。こちらは前回作成したチャットフローですね。画像生成と質問分類器などを組み合わせたものを使っていきます。で、今回は社内規定と製品情報について、それぞれ外部知識、ナレッジを読み込ませるようにしてみたいと思います。で、このブロックの中で知識取得というブロックがありまして、これを使うことで外部知識を読み込ませることができます。で、実際にやってみますと、まずこの質問分類器ですね。こちらに社内規定に関する質問、製品情報に関する質問というクラスを作っていましたので、まず社内規定に関する質問という箇所から線を引っ張ってあげまして、ブロックの追加で知識取得ですね。こちらのブロックを選んであげます。で、そうすると、この知識取得のブロックの設定項目が右側に出るんですけども、ナレッジというところで、ここでどのナレッジを使いますかというのを選ぶことができます。で、これまで3つ作ってきましたので、この就業規則のCSVの方を登録してあげますと、この社内規定に関する質問の場合は就業規則のCSVの内容を元に回答するということができるようになるということですね。で、出力変数として、コンテンツとドキュメントIDという2種類があるんですけども、基本的にはこのコンテンツですね。ドキュメントの内容の方を選んであげることになります。なので、この知識取得の後にLLMのブロックにつなげますと。で、このLLMのブロックの中で、このコンテキストという箇所に先ほどの変数を設定することができるので、スラッシュで知識取得のコンテンツというのを設定してあげれば、チャットGPTが知らない情報も事前に読み込ませてから回答するという流れになるということですね。で、同様に製品情報の方も設定していくことにします。こちら2番目のクラスから線を伸ばしまして、知識取得のブロックを追加しますと。で、ナレッジとしては今回は不動産サンプルですね。こちらの方を選んであげて、さらにその先でLLMのブロックですね。こちらも複製で作った方が早いかなと思いますので、複製で製品情報に関するLLMのブロックを付けてあげて、こちらの知識取得ブロックからも線を引くと。で、このLLMのコンテキストに知識取得のコンテンツですね。こちらを追加してあげれば、製品情報に関する質問が来た場合は不動産サンプルのエクセルの方の内容を元に回答するという流れを作ることができます。あとはこの先なんですけども、それぞれ回答につなげていくということなので、一旦この辺を削除しまして、社内規定の方はこちら、製品情報の方はこちらということで、それぞれ回答に流すようにしてあげることにします。今回集約のブロックは使わずにこのままでいいかなと思うんですけども、こちらも一度流れを確認しますと、まず開始ブロックがあって、選択肢画像は作らないということであれば質問分類器を通って、社内規定に関する質問であれば就業規則のCSVを読み込ませて回答するし、製品情報に関する質問であれば不動産サンプルのエクセルを読み込ませてから回答するということができるようになるということですね。で、実際に試す際には更新してアプリ実行ですね。こちらの方から確認していきたいと思います。

***

### **動作確認 (26:10 - 27:37)**
こちらがチャットフローサンプルのアプリの画面になります。相談相手と画像生成、製品の種類、年齢ということで、いくつか選択肢あるんですけども、今回のチャットフローの内容を見ると相談相手と画像生成だけですね。製品の種類と年齢は後から追加したんですけど、今回のフローでは使っていないので、この辺は選んでも選ばなくてもOKということにはなりますと。で、画像生成しないを選択して、相談相手も必須なので選びまして、スタートします。で、まず社内規定の方の質問で、病気で休む時の手続きを教えてという風に入力してチャットを開始しますと、社内規定に関する質問ということで、就業規則のCSVを読み込ませた内容の回答が返ってくるはずですと。こちら、引用としてファイル名とチャンクの番号も表示されるようになりましたので、こちらをクリックするとどの情報から引っ張ってきているかというのも分かるようになっています。続いて別の質問をしてみることにします。不動産の情報の質問で、例えば顧客の情報をどのように管理すればいいかという質問をしたとします。こちらは製品情報の方のクラスに進むはずなので、顧客の情報は社内のCRMシステムで一元管理していますということで、不動産のファイルの方ですね、不動産情報のエクセルの方から内容を引っ張ってきてくれているのが分かります。こちらも引用の箇所をクリックすると、どのチャンクから情報を引っ張ってきているかというのが分かるようになっています。ということで、今回はチャットフローと外部知識ですね、ナレッジを組み合わせる方法をご紹介いたしました。

***

### **PDF資料の取り込み (27:42 - 28:50)**
資料としてCSV、Excelファイルを読み込ませる方法をご紹介しましたので、PDFの資料についても触れておきます。こちらに厚労省が公開しているPDFの資料を例として持ってきております。こちらもCSV、Excelと同じ流れで、ナレッジを作成、テキストファイルから参照で、こちらですね。PDFのファイルを読み込んで次へを押すと、チャンク設定が自動かカスタムということで選ぶことができますので、今回はカスタムにしますと。で、PDFの場合、改行というのも自動で認識してくれるので、このまま進めてもいけると思うんですけども、もしPDFの中に表などがある場合は、また表の作り方によって改行が変わってくる可能性もあるので、プレビューでしっかり確認した方が良いかなというところと、PDFの場合は少しこの最大チャンク長を多めにしておいた方が読みやすいかなと思います。こちらも資料によるので一概には言えないんですけども、今回は1000としておきます。で、オーバーラップも少し増やしておいて、これで確認プレビューとしますと、このPDFのファイルも自動的にチャンクごとに分割されていて、PDFの場合、ヘッダーの情報なども入ってしまうので、この辺が少し使いづらいかなとは思いますが、読み込むことはできていると。で、その上で同じように保存して処理をしてあげると、PDFの資料もナレッジとして登録することができます。ドキュメントに移動して確認しますと、PDFのファイルが追加されているのが分かります。

***

### **複数資料の取り扱い (28:50 - 29:19)**
で、これまで3つの資料をアップロードしましたので、先ほどのチャットフローの方で、例えばこの質問分類器の社内規定に関する質問、こちらの箇所ですね。こちらのナレッジを複数登録することもできますので、就業規則と社会保障ですね。厚労省のPDF、2つを登録しておいて、その上でどっちを優先するかというのは、ナレッジの説明を元に判断されますので、こちらを調整していくということになります。今回は1つに戻しますけども、複数の資料を読み込ませて、質問の内容によって使う資料を切り替えるということもできますので、そういった設定もできますということをぜひ知っておいてください。

***

### **このセクションのまとめ (29:24 - 30:26)**
このセクションのまとめになります。このセクションでは、外部知識、ナレッジの概要や、ラグ、検索拡張生成の仕組みについて解説をしました。また、実際に外部知識を登録する際のチャンクの分割方法、インデックスの検索方法などの設定も解説いたしました。Difyを使うと、これまでプログラミングが必須であったこの外部知識の読み込みというのがかなり簡単に行えるようになるというのが大きな特徴の一つになっております。その上で、CSVやExcelなど構造化されているデータの方が回答の精度が上がりますし、非構造化データのPDFなどでも表の読み取りの精度も徐々に改善されてきております。さらに、Difyのチャットフローなどの機能と組み合わせることで、社内規定や製品情報など、それぞれの情報ごとに外部知識を読み込ませてから回答するといったように、複数の資料を組み合わせて扱うこともできますので、ぜひこの講座で使った資料なども参考に、皆さんの身の回りにある社内規定や製品情報など、外部知識として登録してチャットボットを作るという作業にも取り組んでいただければと思います。また、この講座がもし分かりやすかったなどありましたら、高評価や口コミなどもいただければ幸いです。次のセクションでは、この講座のまとめとして締めくくりたいと思います。

***

### **講座のまとめ (30:31 - 31:49)**
この講座のまとめになります。この講座では、ノーコード、ローコードで生成AIアプリを開発できるDifyの基本的な使い方や考え方、チャットボットの作り方をご紹介いたしました。Difyを使うと、これまでプログラミングが必須であった外部知識の読み込み、ラグの仕組みがかなり簡単に実装できるようになります。また、複数の生成AI、GPTやGeminiなどを組み合わせた複合AIシステムという考え方も取り入れられていて、チャットフローで様々なツールと連携して、複数のLLMを組み合わせることで複雑な処理をノーコード、ローコードで実現できるようになっています。これからもますます生成AIの進化と普及は進んでいくと思いますし、今回ご紹介した複合AIシステム、外部知識の読み込み、ラグの仕組みというのは、これからのAIアプリ開発でますます重要になってくると考えられます。講座で学んだ知識を活かして、ぜひ皆さんのビジネスやプロジェクトでDifyを活用してみてください。また、今回の講座がもし分かりやすかったなどありましたら、高評価や口コミなどをいただけると今後の活動の励みになります。また、分かりにくかった点などありましたらお気軽にQ&Aからご質問いただければ幸いです。それでは、この度は講座を受講いただき誠にありがとうございました。またどこかでお会いできることを楽しみにしております。

-----

### **複数のナレッジの作成 (0:00 - 1:11)**

現在はナレッジを1つだけ登録している状態になっておりまして、せっかくなので他の資料も1つか用意しておりますので、こちらを使ってナレッジを複数作ってみることにします。用意している資料はUdemy視聴画面セクション1のレクチャー3の中にPDFやExcelなどを用意しておりまして、今回は不動産サンプルExcelというのと、厚労省のPDF2つですね。こちらを事前にダウンロードしておいていただければと思います。で、ダウンロードをいただきましたら改めてナレッジの作成から確認していきます。まずはテキストファイルということで、参照を押してダウンロードのExcelから確認することにします。不動産sample.xlsxを開く。Excelを選んで次へ押します。で、テキストの前処理とクリーニング。チャンク設定。チャンク設定がカスタムですね。これでまずは確認&プレビューを押しますと、こちらはExcelの方を確認いただくとわかるんですけども、セルの中で改行しているパターンとして作っておりまして、ABCドライブに保存されています。のあとも回答としては繋がっているけれど、ABCドライブでここでも区切られているということですね。で、区切られている場合はセグメント識別子のこの改行のコードを2回書いてあげると、うまくチャンクで分割することができます。このABCドライブの後ですね。こちらWindowsの場合は円マークになると思いますので、こちらは注意してください。Macで円マークでも問題なく割れてますかね。のプレビューをしながら確認してみてください。で、インデックスは高品質にしておいてハイブリッドのウェイトですね。このあたりの設定はこのままで進めることにして保存して処理しまして埋め込み少し時間かかりますけども完了したら使えるようになります。で、続きましてナレッジのPDFの方もアップロードしてみることにします。ナレッジを選んでナレッジを作成ですね。

-----

### **PDFナレッジの作成とチャンク設定 (1:11 - 2:42)**

ナレッジを作成。テキストファイルをアップロードということで、まずは厚労省社会保障意識調査のPDFを選んでアップロードすることにします。こちらはサイズが1メガほどなのでまだ余力あると思います。で、チャンクの設定をカスタムにしまして、セグメント識別子は念のため改行2回としておきます。で、PDFは非構造化データになりまして、基本的にはチャンク少し大きめの方が良いとされておりますので、今回は、ま、最大1000なので1000としておきます。と、オーバーラップの箇所も10%から25%なんですけども、少し大きめの250としておくことにします。これで確認&プレビューをしまして、画面の右の方でプレビューが表示されまして、こういうふうに分割しているというのを確認することができます。もっと細かい確認については登録した後ですね、確認することもできます。続きまして、インデックスは高品質のハイブリッドのウェイト設定ということで設定項目そのまま保存することにします。で、少しサイズありますので時間かかりますけども、埋め込みが終われば使うことができます。今47%ですね。OKです。ともう1つPDF用意してますのでナレッジを確認してナレッジを作成を押してあげまして、テキストファイルの厚労省の表ですね。表の方も開いてアップロードしてみます。こちらは0.1メガ小さいファイルになってます。でカスタムを選んでセグメントは念のため2回としておいて、PDFは非構造化データということで少し大きめの設定にしておくことにします。にします。これで確認&プレビューとしますと、こちらはPDFの方を確認してみますとA4サイズで1ページですね。表の中に数字が入ってるような資料になっていて、以前はこの表の中の数字の取得というのが難しかったんですけども、最近はかなり向上していますので、こちらも追って確認したいと思います。チャンクの分割も2つになっていますが、もっと精度を上げたいと思ったような回答が返ってこない場合はこの辺の調整も必要になってくるというところですけども、まずはこのまま進めることにします。で、インデックスモードは高品質でハイブリッドのウェイト設定ですね。こちらに変更しまして、埋め込みが終われば使えるようになるということでございます。また前回もご紹介しましたけども、ナレッジごとに検索テストができますので、例えば厚労省呼称のPDFの方をクリックして検索テストを押してみます。

-----

### **ナレッジの検索テスト (2:42 - 3:32)**

TESTしてみます。こちらは個人年金の情報などが入っていたので、加入してない理由を教えてと事前に用意していたんですけども、これでテストしますと、これに関連するチャンクが表示されていると思います。思ったような返事が返ってきているかというのを確認することができます。また、この検索テストの注意なんですけども、表などで出力することはできないようになっていて、一旦戻りますけども、厚労省の表サンプルですね。こちらをクリックして検索テストを押しまして、こちらが元のPDFなんですけども、被保護世帯数保護停止中を含むの情報を表で出力してと仮に書いたとしますと、この検索テストとしては表で出力ということはできなくて、対応するチャンクが引っかかってきますので、表で出力結果など確認する場合は実際にチャットボットを作ってですね、どういうふうに表示されるかという確認が必要になってくるというところでございます。ということで、複数の情報をアップロードできましたので、続いてこのナレッジを使ったチャットボットを作って出力の確認をしてみることにします。

-----

### **外部知識付きチャットボット（基本）の作成 (3:32 - 5:21)**

外部知識を備えたチャットボット。これまでの解説でCSVやエクセル、PDFなどの資料をアップロードして外部知識として使える状態にしましたので、改めて外部知識を備えたチャットボットを簡単に作ってみることにします。外部知識付きチャットボット。チャットボット（基本）。コンテキストに追加。チャットフロー・知識取得ブロック。このチャットボットの作り方として少しおさらいになりますけども、チャットボットの基本とチャットフローと2種類ありますので、まずは簡単な方ということで、チャットボットの基本の方から確認していくことにします。こちらは設定方法としては簡単でコンテキストという場所がありまして、こちらにナレッジを設定してあげればOKとなっております。また、このコンテキストの中に検索設定という箇所もあるんですけど、こちらは以前は2種類選択肢があったんですが、2024年の9月に片方の設定が廃止予定となってますので、現在はマルチパスリトリーバル、複数のテキストを取得して結果を選択するという方法のみになっておりますので、この辺も踏まえて実際に設定していくことにします。で、設定しましたら、外部知識が使われているかどうかというので確認するということで、こちらは事前に確認して画像を貼っているんですけども、資料元の厚生労働省の資料ですね。で確認すると、外部知識が使われているかどうかができます。ラグありの場合ですね、外部知識を踏まえて回答する場合、資料にもとづいて回答するし、情報元も記載することができます。で、ラグがない場合、こちらは無料で使えるChatGPTで試してますけども、無難な回答を出し、情報元も不明というような違いがありますので、厚労省のチャットを入力してみてみることにします。ということで、実際にチャットボットの基本から作っていくことにします。こちらDifyの画面ですけども、画面の左のSTUDIOから左側のアプリを作成。こちらの画面ですけども、画面の上のSTUDIOから左側のアプリを作成。最初から作成ですね。チャットボットの基本で作っていくことにします。名前は何でもいいんですけども、今回はRAGのチャットボット基本のTESTという名前で作ってみることにします。説明アイコンは変更いただいてもOKです。これで作成をしますと、チャットボット基本の画面が表示されますと。で、画面の真ん中あたりですね、こちらにコンテキストという項目が最初から表示されているんで、こちらの追加のボタンを押しますと、これまでアップロードしているナレッジを選ぶことができます。こちらにコンテキストという項目が最初から表示されているんで、こちらの追加のボタンを押しますと、これまでアップロードしているナレッジを選ぶことができます。どれもハイブリッド検索ですけども、今回は社会保障のPDFですね。こちらを選んで設定することにします。で、もしこの複数選んだ場合は、ナレッジの説明なども影響してきますので、ナレッジの説明もしっかり書いておく方が望ましいということにはなりますが、今回は1つだけPDFを貼り付けることにします。で、貼り付けましたら、もうこれでもうこの外部知識を使える状態になっていて、特にこの手順の方でもですね、変数などは表示されません。これはチャットフローの場合は設定が必要なんですが、チャットボットの場合は特にこちらに書く必要もないので、この状態で使うことができます。念のため更新を押しつつ、先ほどの資料にもあった内容を書いてみますけども、個人年金に加入してない理由を教えてということで聞いてみることにします。

-----

### **チャットボットの動作確認と比較 (5:21 - 6:40)**

そうしますと、この文章自体は生成AIのモデルですね。今回はGPT-4o-miniを使っておりますけども、文章はこれを使うけども、外部知識としてこのPDFを渡していますので、その内容がざーっとこう表示されているということになります。また引用ということで情報元も表示できていると。こちらについては、このチャットの機能ですね。チャットの機能の中に引用帰属ありますので、こちらをつけたり消したりすれば表示非表示も変わるというところでございます。で、先ほどの文章を無料版のChatGPTの方でも試してみることにします。こちらは無料版ですね。こちらで同じ文章を表示しますと、外部知識などは覚えさせていない状態ですので、無難な内容ですね。資金不足、将来の不確実性など、もっともらしい回答は出てくるけれど、どこから情報持ってきているかわからないということになりますので、社内情報などの外部知識を読み込ませることで回答のクオリティも上げれるし、信頼度も上がるということになります。また、表で出力されるかというのも念のため確認してみたいので、コンテキストの追加から厚労省の表のPDFも選んで2つ選択している状態にしておくことにします。で、表の確認なんですけども、こちらが元のPDFですけども、被保護世帯数保護停止中を含む箇所がありますので、こちらをコピーしまして、被保護世帯数保護停止中を含む情報を表で出力してくださいということで聞いてみることにします。そうすると、表でですね、こういった情報が出てきますと。で、こちらの情報を確認しますけども、令和6年3月が165万379ということで、表の方もですね、165万379としっかり情報が取得できているということです。こちらの情報を確認しますけども、令和6年3月が165万379ということで、表の方もですね、165万379としっかり情報が取得できているということです。令和5年3月の情報ですね。164万7327というのもこちらの情報を取得できているというのが分かります。この表の中の数字を取得するというのが以前は難しかったんですけども、かなり改善できていますので、しっかり出力されているかというのも確認しつつ、チャットボットのこの元の資料にも組み込んでみていただければと思います。

-----

### **チャットフローへの外部知識の組み込み (6:40 - 7:42)**

外部知識付きチャットボット。チャットボット（基本）。コンテキストに追加。チャットフロー・知識取得ブロック。引き続き外部知識を備えたチャットボットの作り方を解説していきます。前回チャットボット基本の方を解説しまして、こちらは簡単なんですけども、チャットフローに組み込むこともできますので、チャットフローの組み込み方、設定方法を解説していきます。チャットフロー知識取得ブロック。LLMの前に「知識取得」ブロックを配置。ナレッジを設定。このチャットフローに関しては、知識取得ブロックというものが専用でありますので、このブロックを使ってこの中にナレッジを設定するという方法になります。チャットフローの知識取得ブロックですね。この知識取得ブロックは基本的にはLLMの前に配置する必要がありまして、また追って実際の画面上でも確認していきます。チャットフロー LLMブロック。LLMブロックのコンテキストに「知識取得」ブロックのresult変数を設定。プロンプトに追記する必要がある（/キーで選択項目が表示できる）。で、このブロックを配置しましたらナレッジを設定ということで、いくつかアップロードしてますけども、その中からナレッジを選びますと。続きまして、LLMブロックの中にコンテキストという箇所があります。こちらで知識取得ブロックのリザルト変数を設定するということで、このLLMブロックの前に知識取得がくっついていて、こちらの出力ですね、出力変数でリザルトとなっていますので、入ってきたものをそのまま設定してあげると。さらにチャットフローの場合はプロンプトに書いてあげる必要がありまして、こちらにイメージ図書いてますけども、システムの箇所にコンテキストを踏まえて回答してくださいと書いています。このコンテキストという箇所は、スラッシュキー押しましたら選択項目表示できますので、スラッシュキーを押してしっかりと選んであげるという必要がありますので、まずはこの辺を踏まえつつ実際に設定してみることにします。

-----

### **チャットフローでのRAG設定実践 (7:42 - 9:30)**

こちらが実際の画面のSTUDIOですね。チャットボット基本やりましたので、続いてアプリを作成。最初から作成、チャットボットのチャットフローの方ですね。で、名前は何でもいいんですけども、RAGのチャットフローのテストという名前でおくことにします。で、アイコン説明などはお好みで変更いただければと思いますけども、このまま作成するを押して進めることにします。そうしますと、1から開始ブロックとLLMブロックと回答ブロックというブロックがくっついておりますと。で、先ほどご説明したんですけども、LLMブロックの前に知識取得ブロックを組み込む必要があるので、この先にカーソル合わせる形でブロックを追加してみてください。そうしますと、ブロックの中に知識取得というブロックがありますので、こちらを選んであげますと、まず設定項目見ますとクエリ変数というのが必須.query.stringになっていて、これはチャットの入力欄ですね。ユーザーが入力してくる文字になりますが、入ってますと。で、ナレッジの箇所がプラスボタンを押しますと、以前の動画で解説したPDFなりExcel、CSVなどを選ぶことができますので、今回は厚生省社会保障のPDFを選んでおきます。選びましたら出力変数の方も見ておきますと、result Array[Object]、こちらがアレイというのは配列なんですけども、複数の情報をですね、まとめて渡すようになっています。知識取得ブロックからLLMブロックにつなぎまして、モデルは今回はGPT-4o-miniを選んでおりますと。続いてコンテキストですね。こちらにコンテキストとして知識をインポートできますと書いてありますけども、こちらをクリックしますと、このブロックの上流で流れている変数、こちらにコンテキストとして知識をインポートできますと書いてありますけども、こちらをクリックしますと、このブロックの上流で流れている変数が表示されるんですけども、知識取得ブロックのリザルトという変数が選べるようになっているということで、こちらをクリックします。そうしますと、オレンジの文字で書いてあるので分かりやすいんですけども、コンテキスト機能を有効にするにはプロンプトにコンテキスト変数を入力してくださいということでメッセージが出ますと。このシステムの箇所にですね、こちらにスラッシュのキーを押してあげますと、コンテキストという内容が表示されますので、これを入れればOKです。この後の文章は自由に設定することができるんですけども、コンテキストを踏まえて回答してくださいというような内容で、システムとしては設定しつつ、ユーザーの方は実際にチャットで入力される文字になりますけども、外部知識を踏まえて回答ができるようしておりおりますということです。で、そのまま回答のブロックを見ますと、LLMのテキストということで、これはLLMからの出力ですよね。出力変数がテキストが出てきてますので、それを回答ブロックで設定しているといういうことになります。ここまで設定できましたらプレビューをして動作確認することにします。文章は資料に沿った内容になりますけれども、個人年金に加入してない理由を教えてということで入力してみますと、このワークフローがざーっと流れつつ返答が返ってきますと。

-----

### **チャットフローの動作確認と応用 (9:30 - 10:54)**

で、返答が返ってきますと。また下の方に引用ですよね。PDFこの資料をもとに回答しているというのがわかるようになっています。もしこの引用を消したいという場合は、画面上の機能の箇所を押して機能を追加。この引用と帰属という箇所を消せば、この項目も消えますと。ということろで、チャットフローの中に外部知識を設定する場合は、LLMブロックの前ですね。LLMの前に知識取得ブロックを置いて、この中でナレッジを複数設定できますけども、設定してからLLMのコンテキストですね、ここで設定しないとうまく情報を取得できませんので、もしうまくいかない場合はこの辺りにしっかり情報入っているかというのも確認するようにしてください。チャットフロー 該当なし時に分岐。開始ブロック→質問分類器ブロック。社会保障関係の質問→知識取得→LLM→回答。上記以外の質問→回答2ブロック。回答2ブロック、ex)適切な回答がありませんので、こちらにご連絡くださいxxx@test.com。以前もご紹介しておりますが、チャットフローの中では様々なブロックがあらかじめ用意されていて、ブロックを組み合わせることで処理を分岐させるということもできますので、今回は簡単な例をご紹介いたします。まず開始ブロックがあって、そのまま知識取得ブロックを繋いでいるんですけども、その前に質問分類器ブロックをかませて、今回は社会保障関係の資料を扱ってますので、社会保障に関連する質問なのかどうかというのをLLMに判断してもらおうと。で、そうであればナレッジを使ってLLM使って回答するけど、全く関係ない質問が来た場合は別の処理ですね。回答ブロック2の方に渡して適切な回答がありませんのでこちらにご連絡くださいということで文章を返すようなフローを作ってみることにします。条件分岐することで適切な質問に適切なナレッジを使うということもできますし、知識取得やLLMというのは生成AI使いますので多少なりお金もかかりますので、全く関係ない質問であればこれらの機能も使わないというような処理の流れになります。

-----

### **質問分類器を使ったチャットフローの構築 (10:54 - 12:24)**

実際にDifyでも試してみることにします。こちらが前回作成した開始ブロックがあって、知識取得のブロックがあってLLM回答という流れになっているんですけども、今回の場合は開始ブロックのすぐ後ですね。こちらに質問分類器で条件分岐させることにします。入力変数は入ってくる文字ですね。で、モデルはGPT-4o-mini今回は使います。で、設定する内容なんですけども、社会保障に関する質問なのかどうかということですね。それと上記以外の質問ということでクラスを分けまして、この文章がこれらに当てはまるのかというのを生成AIの方で判断してもらいます。で、まず社会保障に関するものであれば知識取得LLM回答ということで前回と同じフローに流すんですけども、社会保障に関係ない内容が来た場合はブロック追加の回答ですね。回答2となってますけども、こちらに線を引っ張って適切な回答がありませんので、こちらにご連絡くださいということで簡単な文章を書きます。実際に業務で扱う際は連絡先であるとか、回答がなかった時の処理の流れ、担当者名なども書いてあげると親切だとは思いますけども、今回は簡単な例ということでこういった文章を作っておきます。で、流れを作りましたら動作確認ということでプレビューのボタンを押し、まして、社会保障に関係ない質問ということなので、例えば今日の天気を教えてとかですね。チャットは自由に入力できますので、こちらを流しますと、社会保障には関係ない質問なので知識取得やLLMのフローではなくて下の方ですね。すぐに回答を返すというような処理もできたりします。実践的にはこの開始ブロックの中に入力フィールドということで使いやすいと思うんですけども、選択肢をいくつか用意しておいて、その選択肢なのかどうかというので質問分類器なりIF ELSEをかませて処理を分けて適切なナレッジを選んでからLLM返答させるとしてあげると、望ましい返答が返ってきやすくなると思いますので、これはどういう情報を返答させるかということで色々作り方あると思いますので、ぜひ知識取得ブロックの前に質問分類器やIF ELSEブロックもかませてどんな処理にするとスムーズに動くかというのもぜひ色々試してみてください。

-----

### **その他の機能（Rerankの解説） (12:24 - 13:36)**

その他の機能。その他の機能ということで、これまで解説していなかった機能について補足いたします。Rerank（再順位付け）。出力された結果を専用モデルを使い並び替える。より適した文書が検索結果の上位に表示されやすくなる。Cohere社のRerankモデルが有名。[https://cohere.com/](https://cohere.com/)。特徴：多言語対応、長文の処理能力、多様なデータ形式、ハルシネーション対策 etc...。今回は裏ランクになります。裏なので再順位付けと呼ばれております。こちらはハイブリッド検索などで社内文章などを検索する際に出てきた情報を専用のモデルを使って並び替えることで、より適した文章ですね、1回目に検索した文章からさらに順番を入れ替えて、より適した文章が検索結果の上位に表示されやすくなるというような仕組みになっていて、有名なところとしてコーヒーアー社のランクモデルがございます。こちらはコーヒーアーのブログにあったイメージ図なんですけども、ベクトルデータベースに情報が入っているチャットボットなどで質問しますと検索がかけまして順位が付きますけども、そこからさらにランクで順位付けをして順位を向上させるというような仕組みになっており、このコーヒーアー社のランクモデルの特徴ということで、多言語対応、長文の処理能力、多様なデータ形式、ハルシネーション対策ですね、生成AIが嘘をついてしまうということが以前から問題になっているんですけども、その対策としても有効とされております。Rerank（再順位付け）。設定する場合はGoogleかGitHubアカウントでログイン必要。トライアルは無料で試す事ができる（Rerank3（1千検索あたり2ドル））。管理画面 -\> Billing & Usage。クレジットカード登録（Payment）。金額の上限設定可能（Spending Limit）。この後、筆者のサービスを扱うためには、これら外部サービスに登録する必要があるので、設定する場合はGoogleのアカウントかGitHubのアカウントでログインが必要になります。で、ログインしましたらトライアルは無料で試すことができますので、興味ある方はぜひ試していただければというところです。もしプロダクションで実際に扱う場合は1検索あたり2ドルということでかなり安い金額になっていると思いますけども、トライアルフリー版とプロダクション製品版という種類があります。

-----

### **Cohereアカウントの作成とAPIキー取得 (13:36 - 14:44)**

続いて実際にコーヒーアー社のサイトを表示してログイン方法やAPIキーの取得方法を解説いたします。まずはAPIのキーが発行必要なんですけども、こちらがコーヒーアーのウェブサイトになります。で、右上にトライナウというボタンがありますので、こちらをクリックしますとGoogleかGitHubでログインする必要があって、今回はGoogleでログインすることにします。僕の方では既に別のアカウントでログインしているので、また別のですね、Gmailを設定することにします。設定しましたらコーヒー屋にログインということで次へを押します。名前の設定が必要なようなので、自分の名前を入れまして、こちらはニュースなどですね。アップデート情報などチェックは入れても入れなくてもOKということでコンティニューを押します。で、あなたの役割はということって、今回はソフトウェアエンジニアを選択してコンティニューをします。で、コーヒー屋でどんなことをやりたいかということで、お好きなものを選んでいただければと思いますが、今回は検索に関することなのでセマンティックサーチ、そしてサブミットを押すことにします。そうするとこちらがダッシュボードですね。管理画面になりまして、APIを発行したいんですけども、APIキーを押しますと、下の方にトライアルキーとありますので、こちらの目のマークですね。こちらをクリックしてその隣にコピーするボタンがありますので、コピーしてあげますと、こちらがトライアルのAPIキーになりますので、コピーしたらDifyの設定が必要になりますけども、右上のアイコンの設定モデルプロバイダーの中にコーヒー屋がありますので、コーヒー屋のセットアップですね。APIキーを先ほどトライアル発行されているものを保存してあげると、コーヒー屋のAPIキーの箇所が緑色になっています。

-----

### **DifyでのRerankモデル設定 (14:44 - 15:43)**

こちらを設定しましたら、改めて実際の画面のナレッジに影響しますのでナレッジの箇所を見ていきます。以前にPDFなどアップロードしましたので、こちらを選びまして、設定の箇所ですね。で、下の方に下がりますと、ハイブリッド検索の箇所でウェイト設定これまで設定しておりましたけども、この隣にランクモデルが選べるようになっております。で、こちらがコーヒー屋のランクモデルですね。こちらをクリックしますと選択肢がありまして、マルチリンガルというのが多言語ですね。多言語の例の3というのが今のところ一番新しいので、こちらで保存してあげるとして検索して順位付けして、さらに精度が高くなるという風になっております。実際にはチャットボットを運用しながら抽出結果が精度上がっているかというのを確認する必要はありますけども、トライアルでもできますので、もっと精度を高めたいという場合は、このランクモデルも検討いただければというところでございます。それと、今回トライアルで登録してますけども、もし本番でも扱うという場合は、左の方にビリングというページがありまして、このペイメントですね。クレジットカードの登録ができるというのと、スペンディングリミットというのが上限設定ですよね。上限設定をすることもできますので、カード登録などされる場合はこのあたりもチェックして、優勢時の時に使われている金額も確認できるし、請求書も確認できるということになっておりますので、もっと検索結果の精度を高めたいという場合は、こちらのコーヒー屋のランクモデルも検討してみてください。

-----

### **社内チャットボット構築・運用のポイント (15:43 - 17:15)**

社内で構築・運用するために。目的・用途・使うユーザーの想定。目的実現のためにどんな社内情報が必要か。データの準備・整理（できるだけQ\&A形式）（ベクトルDBのサイズに収まるか）。UIの設計（使いやすさ・選択肢など）。プロンプト・チャットフローの設計。運用・メンテナンス（ログの確認・データの更新）。セキュリティ・費用の把握。実際に社内でチャットボットを構築して運用するために検討しておきたいことをまとめと書いておりますので、ご紹介いたします。まずは社内チャットボットを作る目的だったり、使う用途だったり、誰が使うんだというのをはっきりと決める必要があります。その目的実現のためにはどんな社内情報が必要なのかというのも、データを整理したり準備したりする必要が出てきます。以前もご紹介しましたけども、できるだけQ\&A形式で、またベクトルデータベースのサイズも考えると、できるだけCSVで軽量化した状態で登録する方が望ましいので、この辺のデータの準備、整理などをやっていく必要があります。またUIの設計と書いてますけども、実際のチャットフローを使うと会話開始時に選択肢など作ることができますので、できるだけ使いやすく、たくさん文章を入れなくても選択肢選ぶだけでかなりチャットの文章量を減らすことができますので、選択肢もぜひ検討してみてください。また、プロンプト生成AIに投げる文章だったり、チャットフローの設計ですね。外部知識に関係ない質問であれば質問分類器やIF ELSEで分岐させるということも大事になってきます。また実際にチャットボットを運用しだしますと、ログの確認でどういうやりとりが多いのか、いいね！されたやりとりだったり、いろんな情報を確認することができますし、データを更新していくことで、さらに使われるチャットボットにすることができます。一回作って終わりではなく少しずつ改善し、結果的に社内の工数削減にもつながっていきます。また、費用もですね、生成AIどんどん安くはなっておりますが、タダではないので、こちらも定期的に確認するというのと、今回の講座としてはセキュリティ関係の話あまりなかったですけども、もし悪意のあるユーザーからの攻撃とかですね、そういったものもあり得るので、しっかりと確認しておきたいところでございます。チャットボットは1回作って終わりではなくて少しずつ改善していくと、どんなやり取りされているかというのとデータの更新していくことでどんどん効果が上がっていて、実際に使われるようにもなるし、工数削減にもつながっていきますので、社内でどんな業務をチャットボットにすると便利になりそうだというのをぜひ話し合って、小さく試していただいて一回作って終わりではなく少しずつ改善し、UP、どんどん改善していただければと思います。またこちらの講座でも質問随時受け付けておりますので、こういうことができないのかという質問もしありましたらお気軽にご連絡いただければと思います。

-----

### **講座リリース後の新機能紹介 (17:15 - 18:05)**

講座リリース 〜 2024/11。会話のターン数を記録 sys.dialogue\_count。回答ブロックにボタン表示。並列処理（パラレルフロー）。ファイルアップロード機能。フォーム表示。このセクションでは、講座リリース後にDifyに追加された機能の中で特に便利だと思った機能に絞ってご紹介させていただきたいと思っております。Difyは本当に活発なアプリケーションになっていて、どんどん新しい機能が増えておりますので、定期的に新しいコンテンツも追加していきたいと思っております。今回の収録としては講座リリースから2024年の11月現在に追加された機能の中で、特に気になった機能ですね、便利な機能をご紹介させていただきます。まずは会話のターン数を記録する機能が追加されました。これは会話が1回目なのか2回目なのか10回目なのかということで、何回目というのを変数記録するようになりましたので、1回目と2回目で処理を分けたいという際にはとても便利な機能です。これはまた後ほどチャットフローでご紹介させていただきます。続いて回答ブロックにボタンを表示させる機能が追加された。これもですね、後ほどチャットフローでご紹介させていただきます。他にも並列処理の機能だったり、ファイルアップロードの機能だったり、会話の途中でフォームを表示するという機能が追加されております。まずは上2つについてまとめてチャットフローも使って解説をしていきます。

-----

### **2回目以降の処理変更の要望 (18:05 - 18:44)**

2回目以降は処理を変えたい。1回目の会話。2回目の会話。前に話した内容は覚えていてほしい。返答に問題がないか確認したい。追加で聞いてほしい。今回の要望なんですけども、2回目以降は処理を変えたいということで、こちらに簡単なイメージ図を作っておりますけども、まずはユーザーが1回目の会話をしますと入力しまして開始ブロックからいろいろあって回答ブロックまで流れるというのが1回の処理になりますけども、1度回答ブロックまで終わった後で、さらにですね、2回目以降の会話をしたとした時に、また開始ブロックからスタートするんですね。この流れとしてはこれまでと同じなんですけど、1回目と2回目以降で、例えば前に話した内容は覚えていて欲しかったり、返答に問題がないか確認したいなと。この回答ブロックによってざーっと回答が出てくるんですけど、それが問題ないかというのを念のため確認したいというご要望もあったりします。また、もちろん追加で聞いてほしいという要望もありますので、2回目以降ですね、処理の内容を変える必要があって、これまでのDifyだと少し難しい内容だったんですけど、今回追加された機能を使うと簡単に実現することができますので、こちらをご紹介させていただきたいと思います。

-----

### **チャットボットの想定と注意点 (18:44 - 19:17)**

想定。お問い合わせ窓口（パソコンの相談）。※解説をシンプルにするためナレッジは扱っていません。エラー対応もしておりません。回答ブロックのボタン。[https://github.com/langgenius/dify/pull/9876](https://www.google.com/search?q=https://github.com/langgenius/dify/pull/9876)。今回の解説の想定なんですけども、お問い合わせ窓口のチャットボットというのを想定しております。内容は何でもいいんですけど、パソコンのつもりで作っております。注意として解説をシンプルにするためにナレッジの機能は扱っていないというのと、エラー対応しておりませんので予めご了承いただければと思います。また回答ブロックにボタンを追加するという方法をご紹介するんですけど、Difyのマニュアルに見当たらなかったので、こちらはDifyのGitHubのページになるんですけど、こちらを見ていただくと、このボタンの作り方の解説が載っていたりします。すべて英語にはなるんですけど、このあたりのコードですとかテンプレートブロックを使って設定しますので、もっとしっかり把握されたい方はこちらのページも見ていただければと思っております。というところで、これがチャットフローのサンプルになります。

-----

### **チャットフローのサンプル解説 (19:17 - 20:45)**

チャットフローのサンプル。まずは簡単に流れを解説したいんですけども、今回は解説の都合上ですね、会話1回目かどうかという分岐を持たせるためにIF文を噛ませています。これで会話が1回目かどうかというのを判定をかけています。1回目の場合は今回は顧客IDを入力してもらうような流れを想定してるんですけども、顧客IDを入力してもらって一旦回答ブロックまで繋げると、これで1回目のやりとりは終了になります。で、こちらで顧客IDを入力して確認しましたら、お問い合わせありがとうございます。どのようなご相談でしょうか。ということで2回目の会話に繋がるようになっています。一旦回答が返ってきますので、相談内容を入力すると、また開始ブロックですね。開始ブロックからスタートするんですけど、次は会話が2回目になりますので1回目ではないということで下のIFブロックに流れていきます。こちらはまた後ほどご紹介するんですけども、初めはですね、下の方の流れに行きます。相談の内容を追加ということで、パソコンの調子が悪いとか具体的な内容を書いてあげましたら相談の内容を記憶しておきたいということで会話変数に追加するブロックを噛ませております。こちらで会話変数に追記しまして、入力された相談内容にもとづいてLLMで回答を作ります。ここは本当はナレッジなど使った方がいいんですけど、今回は割愛いたします。回答を作りましたら、テンプレートの方でこちらは回答の内容と解決したらボタンを押して欲しいというような内容を作っています。で、その内容がそのまま回答ブロックで表示されます。もし解決のボタンが押されたら、また開始ブロックに戻るんですけども、開始ブロックに戻り、次は会話3回目になりますので、こちらはIF ELSEボタンを押したら解決したという文字が飛ぶようになっているので、解決したのであれば終了の挨拶ということで、3回のやり取りでそれぞれ処理を変えることができるというような想定で作っております。処理の流れ。1、初回は顧客IDを入力会話変数に保存。2、2回目以降やり取り、お悩み事は会話変数に追加。3、回答ブロックで「解決した」ボタンが押されたら終了。もしざーっと書いているんですけども、初回は顧客IDを入力して会話変数に保存する。2回目以降はやり取りします。お悩み事は会話変数に追加していくと回答ブロックの下のボタンが押されたらおしまい。ということで、実際にチャットフローの方もご確認いただきたいと思います。

-----

### **チャットフローの実践デモ (20:45 - 22:50)**

こちらが事前に作っているチャットフローになります。先に確認しておきますと画面の右上に会話変数というボタンがありまして、こちらをクリックすると会話変数ですね。今回は顧客IDと相談の内容ということで2つの情報を記録するようにしております。続いて画面右上の機能からですね、この中に会話の開始という機能がありまして、始めですね、一番最初に表示させたい内容を書いています。今回はまず初めに顧客IDを入力してくださいということで、一番初めはこの文字が表示するようにしていると会話が表示されましたら、顧客IDが入力される想定ですので、このパラメータ抽出ですね。パラメータ抽出機能で顧客IDを抜き出してほしいということで書いております。でIDを抜き出しましたら会話変数に登録ですね。こちらはブロックとしては変数代入というブロックになるんですけど、このブロックを使うことで会話変数に上書きすることができて、ずっと記憶していくことができるということです。で、会話変数登録しましたら一旦回答ブロックに渡しまして、顧客IDは何々ですね。お問い合わせありがとうございます。どのようなご相談でしょうかということで改めて回答なんですけど、こちらで相談内容を書いてほしいというような文言を書いております。で、相談者が相談内容を書きましたら改めて開始ブロックに行くんすけども、開始ブロックの中にですね、このダイアログカウントというものがありまして、まして会話のターン数になります。今何回目の会話なんだということで、こちらが1回目の会話そうでないかということでIF ELSEブロックを使って分岐をかけています。で、分岐させましたら、一旦この解決は飛ばしまして、相談の内容ですね。こちらは相談の内容を追加するということで、これも会話変数に追加してますね。会話変数、これは配列になるんですけど、どんどん相談内容が追加されていくような仕組みになっています。追加しましたらLLMで質問に対して回答してほしいと。で、ユーザーの方で質問内容なんですけども、こちらは会話変数ですね。これまで相談内容がまとめて入っていますので、これをまるっと渡してこれに対して回答を作ります。たら一旦テンプレートに渡して整形してあげます。入力変数はこの回答ですね。回答を渡しまして回答をざっと書きますと。で、その下のお悩みは解決できましたでしょうか。もし解決した場合は解決したのボタンを押してくださいということで文字で伝えておりますけども、こちらがボタンのタグになるんですけど、このボタンを押すと解決したという文字が渡るようになります。こちらはデータメッセージという設定値があって、ここに書いた文言がそのまま次の会話として渡るようになっています。もし解決してない場合はお悩みの内容を追記してくださいということで、別の悩みを追加されれば改めてやりとりされるということです。このボタンを押しましたら解決したという文字が入力されますので、また開始ブロックに行ってIF ELSEで1回目ではないので下のブロックに行って入力した文字が解決したとぴったり同じの場合は終了のご挨拶ということでここでやりとりはおしまいというような流れで組んでおります。

-----

### **プレビューでの動作確認 (22:50 - 24:02)**

実際にプレビューを見てみますと、まず初めにこちらの文言が出てきますね。顧客IDを入力してくださいということで、ここは適当に123など入力することにします。ボットと話す。そうすると1つ目ですね。1つ目は顧客IDの登録になりますので登録しましたと。で、どんな相談なんだということですね、パソコンが起動しないとかですね、適当に相談内容を書いてみます。そうすると今回は会話としては2回目になるので、下の方のフローですね。下の方のフローに流れていくとLLMがざーっと回答を返してくれていると。で、もし解決してなかったらこの続きができるわけですね。パソコンの電源が入らないとか、まあその相談内容をさらに追加してあげれば、LLMが回答を作ってくれますと。で、回答を作りましたら、お悩みは解決できましたでしょうか。もし解決した場合は「解決した」のボタンを押してください。解決した場合はボタンを押してほしいということで書いてましたので、こちらのボタンを押すと解決したという文字が会話がまたスタートしまして、ウェルスでうまくいってありがとうございます。また何かあればご連絡をお願いします。ということで、チャットボットの内容によっては1回で終わらない場合もあって2回3回ですね。回数を重ねるパターンもよくありますので、その際に今何回目の会話なんだと1回目かどうかというので処理を分岐させたり、ボタンを作っておいてボタンが押されたかどうかで処理を分岐させると思いますので、新しい機能になりますがぜひこういった機能も活用してみてください。今回の解説で扱ったチャットフローをDSLファイルとしてダウンロードできるようしております。こちらは追加情報セクションの中の2回目以降の会話で処理を変える（会話ターン数・回答ブロックボタン）ということでレクチャー作っておりまして、こちらにリソースとしてDSLファイルを置いておりますので、ご自身の環境で動作確認されたい場合はこちらからダウンロードしてインポートして動作確認してみていただければと思います。

***

### **フォーム表示機能の紹介 (0:00 - 0:15)**
前回の解説で現在何回目の会話なんだというのを記録する機能と、回答ブロックにボタン表示する機能をご紹介しました。続いてフォーム表示なんですけれど、このフォーム表示は前回のボタン表示と動き的には同じような流れになるので、簡単にご紹介だけさせていただきたいと思います。

***

### **フォーム表示の技術的解説 (0:15 - 0:50)**
こちらもGitHubの方に関連情報がありますので、まずはこちらのページを見させていただきたいんですけど、下の方に行きますと、こちらが設定する方法ですね。少し細かくなるので今回は割愛しようかと思っているんですけど、テンプレートブロックを作ってフォームタグですね、こちらはHTMLのタグを書くことになるんですけど、XMLのタグを書いて、ボタンブロックを表示することができると入力して、その情報を2回目以降の会話の開始として使うことができると。また、このフォームのデータフォーマットという箇所がテキストとJSON形式というものを選べるようになっていますので、こちらがJSON形式です。少し細かくなるので、もしご要望あればもう少ししっかり解説していただきたいと思いますけども、今のところはここまでとさせていただきたいと思います。こちらがフォーム表示ですね。

***

### **ファイルアップロード機能の概要と制限 (0:50 - 1:37)**
続きましてファイルアップロードの機能はとても便利ですし出番も多いと思いますのでご紹介いたします。こちらは2024年の10月頃に追加された機能になって、以前は画像のみアップロードできていたんですけど、ファイル全般対応することになっています。大きな種類としてはドキュメント、テキスト、PDF、CSV、オフィス関係のExcel、Word、PowerPointなどですね。ドキュメントもあれば画像もあれば、音声もあれば映像もあるということで複数の種類のファイルをアップロードすることができるようになっています。それぞれ上限の容量が決まっているのと少し試してですね思ったようにうまく動かないところもあったので事前にご紹介しますと、まず音声の箇所はWAVファイルのみ対応ですね。MP3やM4Aは対応か？と書いてあるんですけど、実際に試すとエラーが出てしまいましたので収録時点としてはこのWAVファイルで試すことにいたします。それと映像もアップロードはできるんですけど、映像から文字起こしというのが現状できませんでしたので、おいおいこちらも機能がアップデートされるのを期待したいなというところでございます。というところで今回はドキュメントと画像と音声のWAVファイルですね。この3つのパターンで実際に簡単なチャットフローを作って動作確認したいと思います。

***

### **ファイルアップロードの想定用途 (1:37 - 2:08)**
想定用途と書いてありますけども、音声WEBファイルをアップロードした場合は文字起こしですね。文字起こしする場合は専用の音声認識できるモデルを設定する必要があって、例えばGPT-4o-audio-previewなどですね、オーディオと入ってますので、こちらは音声認識できるモデルになるんですけど、こちらを設定する必要があります。また画像に関してはビジョンですね。ビジョン画像を認識できるようにしておく必要があります。こちらは画像を解説したり、同じような画像を生成したい場合にプロンプトを作ると。この画像を作るためのプロンプトを作ってくれみたいな指示をすることができます。それとテキストは一般的なチャットGPTでよく行われているようなPDFの要約翻訳、またナレッジの代わりに使うということも考えられるというところです。

***

### **ファイルアップロードの方法2種と音声ファイル準備 (2:08 - 3:19)**
続いてファイルをアップロードする方法が大きく2種類あるのでご紹介いたします。1つ目は開始ブロックに入力フィールドを追加する。開始ブロックにファイルのアップロードのボタンを追加するという作り方になります。こちらの場合は会話ブロックに変数を1つ追加しましてどのファイルタイプを受け付けるかというのも設定します。また追ってご紹介します。それとチャットフローで動かす場合はチャットの入力ボックスが下の方に表示されるんですけど、そちらにファイルアップロードの機能を追加するということもできますのでご紹介いたします。チャットの入力ボックスに表示させたい場合は右上の機能ボタンがあるんですけど、機能ボタンを押しましてファイルアップロードという項目が増えていますので、こちらを有効にしますと。さらに設定からどのファイルタイプをサポートするかということでサポートになってますけども、どのファイルタイプをアップロードできるかということと、あとはファイルの数ですね、ファイルの数だったりを設定することもできるようになっております。まずは音声アップロードから試していきたいと思います。先ほどもお伝えしましたけれど、収録時点ではWEBファイルのみ対応というところでございます。もしMP3しか持ってないとかですね、WAVファイルに変換する方法がわからないという場合がありましたらGoogleで検索していただくといいんですけど、例えばMP3からWAVですね。WAV変換と検索していただきますと変換するサービスが色々ありまして、例えばこちらのコンバーターですね、こちらを選びますとMP3からWAVへの変換ですね。こちらの選択肢を選んで好きな拡張子に変換することができるのでMP3しかないという場合はこちらで変換もしてみていただければというところでございます。それと、こちらで事前に簡単なファイルになるんですけど、WAVファイルをUdemyの受講画面に添付しておきますので、必要な方はこちらからダウンロードいただければと思います。

***

### **音声アップロードのセットアップ (3:19 - 3:52)**
ファイル自体は簡単な内容にしてるんですが、音声アップロードのテストです。というような音声を2回収録した簡単な音声ファイルを用意しておりますので、こちらを使ってもOKというところでございます。それとアップロードしましたらLLMモデルを使ってその解析をする必要があります。先ほどもお伝えしましたけれど、音声の場合はオーディオプレビューなどですね、音声対応のモデルを選んでいただきます。またLLMのブロック内の下の方にビジョンという項目がありまして、こちらを有効にして音声ファイルを指定してあげることで音声ファイル認識できますので、この辺も合わせて実際に画面を表示しながら確認したいと思います。

***

### **チャットフローでのファイルアップロード設定 (3:52 - 5:21)**
こちらがチャットフロー初期画面ですね。特に何もブロック繋がってない状態なんですけど、この状態から始めたいと思います。まず初めに右上の機能から押しますかね。右上の機能を押しましたら、この中にファイルアップロードという項目があって、オンオフ切り替えることができます。オンにして設定のボタンを押しますと、アップロードするファイルのタイプ、ローカルのファイルかURLか。まあ、クラウド上にあるのであればパソコンからアップロードするのか両方ですね。両方とも対応します。アップロードファイルの数ですね。こちらは1にしておこうかなと思います。で、サポートされたファイルタイプということでいくつか選べますので、こちらで保存していただきますと保存をしましたらプレビュー見ていただくとわかると思うんですけど、プレビューを押してボットと話すという入力ボックスがあるんですけど、こちらの右の方にクリップのマークアイコンが表示されていて、こちらをクリックすることでファイルを選ぶことができるようになるということです。機能から設定すると、このチャットボックス欄にクリップのアイコンができるようになります。続きまして開始ブロックの方も確認しておきます。開始ブロックの入力フィールドですね。こちらでプラスボタンを押しますと、以前と少しレイアウトが変わってるんですけど、単一ファイル、ファイルリストということで1つのファイルか複数のファイルかというのを選ぶことができます。今回は単一ファイルということにしておきます。変数名ラベル名設定必要なんですけれど、アップロードファイルということにしておきますと、ファイルタイプも今回はドキュメントと画像と音声3つ試したいということで3つまとめてチェックしておいて必須として保存しておくことにします。開始ブロックとしてはOKですね。こちらでアプリを更新したいんですけど、回答ブロックも必要ということで一旦そのままつけますかね。これで更新してテスト、更新しましてプレビューを押しますと画面の上の方にアップロードファイルということでこちらからフォームからアップロードすることもできるようになっているということですね。実際にアプリを実行してみるとわかるんですけど、初めの段階でアップロードするかスタートチャットをしてから添付するかということで段階があるということになります。

***

### **音声ファイルの文字起こし実践 (5:21 - 6:33)**
というところで実際に音声のアップロードしてみたいんですけれど、開始ブロックがあってこの次にLLMブロックをつなげてあげることにします。LLMで先ほどもお伝えしたんですけど、音声を認識できるモデルにする必要があるので、まずはモデルを変更する必要があって、今回はGPT-4o-audio-previewというモデルに設定することにします。これで音声認識できます。で、続いて少し分かりづらいんですけれど、このブロックの下の方にビジョンという箇所がありまして、こちらをオンにして先ほどアップロードされてくるファイルを選んであげる必要があります。アップロードファイルという名前にしましたので、こちらでビジョンの箇所に設定してあげるのが少し分かりづらいので、こちらを設定するようにしてください。システムプロンプトに関しては、添付の音声データを文字起こししてとかですね。このあたりの文章を書いてあげることにします。で、回答ブロックを改めてスラッシュを押してLLMのテキストですね。文字起こししたものを表示するということで、これでOKになっています。これで一旦更新をしまして、改めてプレビューからいきますかね。プレビューで画面の上の方のボタンですね。こちら開始ブロックで設定したものになりますけれど、こちらでローカルアップロードして事前に作っておいたWebファイルですね。Webファイルを添付してあげますと、チャットフローの場合は何かしら情報を入れる必要がありますので、1など入力して実行することにします。そうすると音声を認識して文字起こしですね。音声アップロードのテストですという音声になっていたので、音声の通り文字起こしができているということになります。用途としてはお客様とのミーティングを録音しておいて後で文字起こしをしたいというときにはとても便利な機能になると思いますので、もしそういったシチュエーションがあればぜひ試してみてください。

***

### **画像アップロードと解説の実践 (6:33 - 8:16)**
画像アップロード。LLMブロック GPT-4o-mini。ブロック内のビジョンを有効にし、画像ファイルを指定。プロンプト例、添付の画像データを日本語で解説して。引き続きファイルアップロードの解説になります。続いては画像アップロードとテキストのアップロードについて簡単にご紹介させていただきます。はじめに画像アップロードについてご紹介いたします。こちらは構成としては前回と同じような流れなんですけれど、LLMブロックのモデルですね。モデルがオーディオ認識ではなくて画像を認識できるものを設定していただければというところで今回はGPT-4o-miniを選択してあげるとコスパのいいモデルになるというところでございます。で、LLMブロック内のビジョンを有効にして画像ファイルを指定というところで、こちらは前回の音声と同じ設定になります。アップロードしましたらプロンプト例として添付の画像データを日本語で解説してというような内容を書いてあげることにします。というところで実際にフローを見ていきます。こちらは前回の音声アップロードの際のチャットフローになりますけども、開始ブロックにアップロードの変数が一つあって、この中で単一ファイルで画像や音声が選んでるという状態でございます。続いてLLMブロックなんですけれど、こちらのモデルを変更する必要があるということですね。こちらを今回はGPT-4o-miniのモデルということで変更してあげることにします。で下の方に行きましてビジョンの箇所で画像認識することができるので、こちらを選んでアップロードファイル変数ですね。こちらを選んであげますと。でシステムプロンプトですけども添付の画像を日本語で説明してとか解説してなど簡単なプロンプトで試みることにします。で、回答ブロックですね。こちらはLLMで解説した内容が表示されるということで、こちらも一旦更新しましてプレビューから画像を選んであげることにします。ボタンを押して適当に画像を選んであげます。で画像を選んだらボットと話すで、123とかですね適当に入力しますけれど、こちらで実行するとチャットフローが走って画像認識してそれの文章ですね解説してくれると。この画像は水彩画スタイルで描かれた風景です。中央に立つ人物が分岐する道に向かって両手を広げています。背景には美しい夕焼けが広がり、緑豊かな自然が描かれており、選択肢の象徴としての意味合いを持っているようです。全体的に希望や選択の自由を感じさせる印象があります。とこちらですね。こちらの画像の解説をしてくれているというような流れで、これを英語にして画像生成のAIに投げるとこれに近い画像を作るということもできたりしますので、画像から一旦文字に起こして、文字からもう一度別の画像を作るなんてこともできたりしますので、興味ある方はぜひやってみていただければというところでございます。

***

### **テキストファイルのアップロードと要約 (8:16 - 10:02)**
それともう一つですね、テキストをアップロードするというのが実際の一番使うと思うんですけど、テキストをアップロードする際は、もう一つ追加のブロックがあります。テキスト抽出ツールというブロックが追加されているんですけど、こちらをかますことでテキストファイルから文章を抜き出すことができるようになっています。なのでPDFをアップロードする際にはこのブロックも必須になると。こちらをかませて文章を抜き取ってLLMに投げることができるようになります。もう一つですねリスト処理というブロックも追加されたんですけど、こちらは複数ファイルがある際に活用するということで少し操作が難しくなるので今回は割愛させていただきたいんですけど、もしPDFとJPEGファイルなど同時に複数同時にアップロードして処理したいという場合はこちらのブロックも出番が出てくるかなというところですね。今回はこのテキスト抽出ツールの方でご紹介させていただきます。開始ブロックは変えなくてOKなんですけれど、今回はPDFがアップロードされるという想定で考えたいと思います。アップロードされましたら先ほどご紹介いたしましたけども、テキスト抽出ツールというブロックが新たに追加になってますのでこちらを選んであげてください。入力変数ということで渡ってくる情報を選びますけども、今回はアップロードファイルですね。こちらをアップロードしましたら、出力として文字情報が抽出されることになりますので、LLMなどで使ってあげればいいということになります。このLLMの方も今回はビジョンは使わなくていいので一旦カットしますかね。で、システム一つ足しましてユーザーの方にしますかね。ユーザーの方でスラッシュをつけてテキスト抽出ツールのテキストとしてあげるとPDFでアップロードした内容が文字起こしされたものがこちらに入ってくるということになりますので、ユーザーが入力した情報を要約してというような想定で書いておくことにします。モデルはGPT-4o-miniですね。回答ブロックは変えずにLLMのテキストですね。要約した内容が表示されるはずです。ということでこちらも一旦更新しましてプレビューからPDFを選びたいんですけども、こちらは以前のセクションでご紹介していた厚労省の社会保障意識調査PDFをアップロードしてみることにします。こちらを選びまして123などで実行としますとPDFがアップロードされて文章が抜き取られて、要約して回答ブロックとしてざーっと表示されるというところで、実際のところはPDFなどをアップロードして要約なり翻訳なりするということが多いと思いますけども、ファイルアップロードの機能は本当に便利ですのでぜひ実際に手を動かして試してみてください。

***

### **並列処理（パラレルフロー）の概要 (10:02 - 10:26)**
今回の講座収録後にリリースされた新機能の紹介をさせていただいております。続いては並列処理パラレルフローについて簡単にご紹介をいたします。並列処理ということで文字通り直列ではなくて並列で同時に処理をさせることができるようになりました。こちら簡単な例なんですけれど、開始ブロックから2つのLLMにつなげてそれぞれで処理をかけると。それぞれで処理をかけましたらテンプレートブロックが便利なんですけれど、こちらで処理をまとめてまとめたものを回答として表示するということができるようになりました。

***

### **並列処理の用途例とサンプル解説 (10:26 - 11:11)**
並列処理の用途例ということで3つ書いておりますけれど、例えば複数のLLMに確認するGPTだけではなくて、ClaudeやGeminiに並列で同時に確認してその内容を統合であるとか、複数の画像を同時に、例えば3枚同時に生成するということもできたりしますし、複数の情報をパラメータ抽出してそれぞれの会話変数に登録するということもできたりします。今回は一番下のこのパラメータ抽出と会話変数に登録というところでご紹介させていただきたいと思います。こちらが並列処理のサンプルなんですけれど、開始ブロックから1つではなくてですね2つのルートに分かれてそれぞれ別のことを作業させると。今回の場合は入力情報として顧客名と相談内容ということで、パソコンの相談をまた想定しているんですけれど、顧客名と相談内容をそれぞれ入力された情報から抽出して会話変数に登録しつつ、相談内容についてはLLMで回答を作り、その後でテンプレートブロックを使って結合していると。で、いると結合しつつ表示内容も整えてから回答ブロックで表示するというような流れで簡単なフローを作っておりますので実際に画面でも確認させていただきたいと思います。

***

### **パラレルフローの構築と操作方法 (11:11 - 12:44)**
こちらが並列処理パラレルフローを組んだフローになりますね。この並列処理パラレルフローに関しては、作り方としては本当に簡単で、開始ブロックがありますけども、開始ブロックからプラスボタンを押して何かしらブロックをつけると、特に意識せずとも並列で処理ができるような構成になります。今LLMブロックを1つつけたんですけど、自動的に3つですね、パラレルラインと表示されていますけども開始ブロックから3つ繋がっているような状態でございます。作るのは簡単なんですけれど、削除したり修正したりというのが少し分かりづらいのでご紹介しておきますと、もしこの今追加したブロックを削除したいとなった場合は、一旦ですね、手元の開始ブロックの方を選んでいただきますと、開始ブロックの画面の下の方に次のステップということでこの開始ブロックから繋がっているブロックが表示されるんですね。現在は3つ表示されているので3つありますけども、LLMの2の方ですね、こちらの右の点3つのアイコンをクリックしますと変更切る削除ということで項目が分かれていて、例えば切るの箇所を押しますと、この接続されていた線が消えるんですね。線が消えて自由に動かすことができるようになりますので、もし思ったようなルートでなかったりこの流れを作り直したいと思った場合は、接続されている1つ前のブロックですね。接続されている1つ前のブロックを選んでいただいて切るといいのかなというところでございます。もう一度繋げてみますけども、切るだったりあと削除押しますとこのブロック自体が消えますね。追加する方法はこうで、続きまして、LLMで何かしら処理が終わったとしましたら、これを好きなブロックにつなげることができます。LLMにも繋げれますし、テンプレートにも繋げれますし、基本的にはテンプレートブロックでまとめるのがわかりやすいんではないかなと思うんですけど、こうやってあげるとですね、ちょっとこのレイアウトを調整しないと見づらいかもしれないんですが、こうやって3つの流れをフローを一つにまとめるということもできたりします。先ほどと同じように、もしこのブロックルートは不要だとなった場合は、LLM自体を消していただいてもいいかなと思います。こちらを削除しまして、こうですね。先ほどの最初の状態に戻っていると思いますけども、こうしましょうかね。で、変数などが変わっていると動作が怪しくなるので変数大丈夫だよねというのも念のため確認していただければというところです。

***

### **パラレルフローの実践デモ (12:44 - 14:16)**
簡単な処理の流れをご紹介しますと、こちらも会話変数登録してまして、会話変数の中でお客様の名前とコンテンツ相談内容が入ってくると記録ということにしております。スタートがありまして、まず初めにこちらの2つのブロックなんですけども、パラメータ抽出ですね、文章が入ってきてその中から必要なものを抽出するブロックになります。今回はお客様の名前ですね。顧客名と相談内容をそれぞれ抽出すると、会話変数に登録したいということで、こちらは変数代入ブロックですね。これを使うことで会話変数に登録することができます。と登録しましたら相談内容の方だけLLMを使って相談内容に真摯に回答してということで簡単なプロンプトを組んでますけれども、これで回答が生成されます。生成されましたら2つに分かれていたフローをテンプレートブロックでまとめることができるので、テンプレートブロックは引数たくさん設定できるとても使いやすいブロックだなと思ったりします。今回はお客様の情報はこれ会話変数そのまま入れてますけども、会話変数に入れた情報を表示して、下のほうで相談内容の回答ですね、回答を書いて、最後に回答ブロックでその内容を表示するというような構成にしております。一つだけではなくて複数の並列で同時に処理したいなんてこともよくありますので、こちらの機能もとても便利だなという風に思います。というところで改めてプレビューを押しますかね。今回は顧客名を青木として相談内容をパソコンが動かないとかですね、自由記入にしてもらって先ほどのパラメータ抽出でそれぞれ抽出してもらうと、現在このパラレルフローで同時並行で流れているんですけど、ここですね。青木様からいただきました内容ということで、こちらは顧客名がしっかり取得できているのがわかると思います。で下の方はLLMで作った回答になりますので、実際はここからさらに、問題が解決したボタンなどを作ってあげて、解決しなかったら2回目の回答に行くなどですね、さらに複雑なフローを作ってあげると実践的なチャットボットができると思いますけども、このパラレルフローに関しては、処理する内容によってかなり応用範囲が広いので、ぜひご自身の作りたいチャットボットを想定していただいて、並列で処理したいものがあればこのパラレルフローもぜひ活用してみていただければ幸いです。